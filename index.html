<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>3D Project Setup Questionnaire</title>
  <link rel="stylesheet" href="styles.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
  <header>
    <h1>3D Project Setup Questionnaire</h1>
    <p>Help us create your customized 3D setup guide</p>
    <div style="margin-top: 1rem;">
      <button onclick="showCustomerDatabase()" class="next-btn" style="background: #667EEA; padding: 0.5rem 1rem; font-size: 0.875rem;">📊 Customer Database</button>
      <button onclick="exportAllCustomers()" class="next-btn" style="background: #6b7280; padding: 0.5rem 1rem; font-size: 0.875rem; margin-left: 0.5rem;">📥 Export All</button>
    </div>
  </header>

  <main>
    <!-- Progress Bar -->
    <div style="margin-bottom: 2rem;">
      <div class="progress-bar">
        <div class="progress-fill" id="progressFill" style="width: 0%;"></div>
      </div>
    </div>
    

    <!-- Step 1: Company Information -->
    <section id="step1-section" class="questionnaire-step">
      <h2>🏢 Company Information</h2>
      <div class="form-group">
        <label for="clientWebsite">Company Website *</label>
        <input type="url" id="clientWebsite" placeholder="https://www.yourcompany.com" required />
        <button type="button" onclick="analyzeWebsite()" class="next-btn" style="background:#667EEA; padding: 0.5rem 1rem; font-size: 0.875rem; margin-top: 0.5rem;">🔍 Analyze Website (Optional)</button>
        <div id="websiteAnalysis" class="info-box info" style="display: none; margin-top: 1rem;">
          <h4>🔍 Website Analysis</h4>
          <div id="analysisContent"></div>
        </div>
      </div>
      <div class="form-group">
        <label for="existingConfig">Existing 3D Configuration Link (Optional)</label>
        <input type="url" id="existingConfig" placeholder="https://yourcompany.com/product-configurator" />
        <p style="font-size:14px;color:#6b7280;margin-top:4px;">Paste a link to your current 3D configurator to help us understand your existing setup</p>
        <button type="button" onclick="analyzeExistingConfig()" class="next-btn" style="background:#667EEA; padding: 0.5rem 1rem; font-size: 0.875rem; margin-top: 0.5rem;">🔧 Analyze Configuration (Optional)</button>
        <div id="configAnalysis" class="info-box info" style="display: none; margin-top: 1rem;">
          <h4>🔧 Configuration Analysis</h4>
          <div id="configAnalysisContent"></div>
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label for="companyName">Company Name *</label>
          <input type="text" id="companyName" placeholder="e.g., Atletica Gym" required />
        </div>
        <div class="form-group">
          <label for="industry">Industry *</label>
          <select id="industry" required onchange="updateProjectSuggestions()">
            <option value="">Select Industry</option>
            <option value="fitness-equipment">Fitness Equipment</option>
            <option value="furniture">Furniture</option>
            <option value="automotive">Automotive</option>
            <option value="jewelry">Jewelry</option>
            <option value="electronics">Electronics</option>
            <option value="fashion">Fashion</option>
            <option value="home-garden">Home & Garden</option>
            <option value="beauty-cosmetics">Beauty & Cosmetics</option>
            <option value="sports-recreation">Sports & Recreation</option>
            <option value="industrial-machinery">Industrial Machinery</option>
            <option value="medical-devices">Medical Devices</option>
            <option value="other">Other</option>
          </select>
        </div>
      </div>
      <div id="projectSuggestions" class="info-box info" style="display: none; margin-top: 1rem;">
        <h4>💡 Suggested Project Descriptions</h4>
        <div id="suggestionsContent"></div>
      </div>
      <div class="form-group">
        <label for="projectDescription">Brief description of your project *</label>
        <textarea id="projectDescription" placeholder="e.g., Interactive configurator for gym equipment with material customization" required></textarea>
        <div style="display: flex; gap: 0.5rem; margin-top: 0.5rem;">
          <button type="button" onclick="generateSmartDescription()" class="next-btn" style="background: #667EEA; padding: 0.5rem 1rem; font-size: 0.875rem;">🤖 Generate Smart Description</button>
          <button type="button" onclick="updateProjectSuggestions()" class="next-btn" style="background: #6b7280; padding: 0.5rem 1rem; font-size: 0.875rem;">💡 Show Suggestions</button>
        </div>
      </div>
      <div id="customerLoadedInfo" class="info-box success" style="display: none; margin-bottom: 1rem;">
        <h4>✅ Customer Data Loaded</h4>
        <p>You can now either regenerate the guide, continue through the questionnaire, or jump directly to your customized documentation.</p>
        <div style="margin-top: 1rem;">
          <button class="next-btn" onclick="regenerateGuide()" style="background:#00D4AA; margin-right: 0.5rem;">🔄 Regenerate Guide</button>
          <button class="next-btn" onclick="goToDocumentation()" style="background:#22c55e; margin-right: 0.5rem;">📖 Go to Documentation Preview</button>
          <button class="next-btn" onclick="nextStep(1, 2)" style="background:#667EEA;">📝 Continue Questionnaire</button>
        </div>
      </div>
      
      <div class="form-row">
        <button class="next-btn" onclick="nextStep(1, 2)">Next</button>
      </div>
    </section>

    <!-- Step 2: Configuration Type -->
    <section id="step2-section" class="questionnaire-step hidden">
      <h2>🎯 Configuration Type & Approach</h2>
      <div class="form-group">
        <label>What type of 3D configuration do you need? *</label>
        <div class="checkbox-group">
          <div class="checkbox-item">
            <input type="radio" name="configType" id="config-photorealistic" value="photorealistic" onchange="updateRenderEngineOptions()">
            <label for="config-photorealistic">Photorealistic Configuration (V-Ray rendering)</label>
          </div>
          <div class="checkbox-item">
            <input type="radio" name="configType" id="config-interactive" value="interactive" onchange="updateRenderEngineOptions()">
            <label for="config-interactive">Interactive 3D Configuration (Real-time rendering)</label>
          </div>
          <div class="checkbox-item">
            <input type="radio" name="configType" id="config-mixed" value="mixed" onchange="updateRenderEngineOptions()">
            <label for="config-mixed">Mixed Approach (Both photorealistic and interactive)</label>
          </div>
        </div>
        <p style="font-size:14px;color:#6b7280;margin-top:8px;">Choose the primary approach for your 3D configuration needs</p>
      </div>
      
      <div id="renderEngineSection" class="form-group" style="display: none;">
        <label for="renderEngine">What rendering engine do you use? *</label>
        <select id="renderEngine">
          <option value="">Select Render Engine</option>
          <option value="V-Ray">V-Ray (Recommended for Threekit)</option>
          <option value="Arnold">Arnold</option>
          <option value="Redshift">Redshift</option>
          <option value="Octane">Octane</option>
          <option value="Cycles">Cycles (Blender)</option>
          <option value="Eevee">Eevee (Blender)</option>
          <option value="Standard">Standard/Default</option>
          <option value="Other">Other</option>
        </select>
        <p style="font-size:14px;color:#6b7280;margin-top:4px;">V-Ray is recommended for best Threekit compatibility and photorealistic results</p>
      </div>
      
      <div class="form-row">
        <button class="next-btn" onclick="prevStep(2, 1)" style="background:#6b7280">Previous</button>
        <button class="next-btn" onclick="nextStep(2, 3)">Next</button>
      </div>
    </section>

    <!-- Step 3: 3D Software -->
    <section id="step3-section" class="questionnaire-step hidden">
      <h2>🛠️ 3D Software & Tools</h2>
      <div class="form-group">
        <label for="3dSoftware">What 3D software do you primarily use? *</label>
        <select id="3dSoftware" required>
          <option value="">Select Software</option>
          <option value="Autodesk 3ds Max">Autodesk 3ds Max</option>
          <option value="Blender">Blender</option>
          <option value="Autodesk Maya">Autodesk Maya</option>
          <option value="Cinema 4D">Cinema 4D</option>
          <option value="Modo">Modo</option>
          <option value="Houdini">Houdini</option>
          <option value="Other">Other</option>
        </select>
      </div>
      
      <div class="form-group">
        <label for="experienceLevel">What's your experience level with 3D modeling?</label>
        <select id="experienceLevel">
          <option value="">Select Experience Level</option>
          <option value="beginner">Beginner (0-1 years)</option>
          <option value="intermediate">Intermediate (1-3 years)</option>
          <option value="advanced">Advanced (3-5 years)</option>
          <option value="expert">Expert (5+ years)</option>
        </select>
      </div>
      <div class="form-row">
        <button class="next-btn" onclick="prevStep(3, 2)" style="background:#6b7280">Previous</button>
        <button class="next-btn" onclick="nextStep(3, 4)">Next</button>
      </div>
    </section>

    <!-- Step 4: Project Requirements -->
    <section id="step4-section" class="questionnaire-step hidden">
      <h2>🎯 Project Requirements</h2>
      <div class="form-group">
        <label>What features do you need for your project? (check all that apply) *</label>
        <div class="checkbox-group">
          <div class="checkbox-item">
            <input type="checkbox" id="req-configurator" value="Product configurator with multiple options">
            <label for="req-configurator">Product configurator with multiple options</label>
          </div>
          <div class="checkbox-item">
            <input type="checkbox" id="req-materials" value="Material customization">
            <label for="req-materials">Material customization</label>
          </div>
          <div class="checkbox-item">
            <input type="checkbox" id="req-animation" value="Interactive animations">
            <label for="req-animation">Interactive animations</label>
          </div>
          <div class="checkbox-item">
            <input type="checkbox" id="req-mobile" value="Mobile optimization">
            <label for="req-mobile">Mobile optimization</label>
          </div>
          <div class="checkbox-item">
            <input type="checkbox" id="req-ar" value="AR compatibility">
            <label for="req-ar">AR compatibility</label>
          </div>
          <div class="checkbox-item">
            <input type="checkbox" id="req-performance" value="High performance requirements">
            <label for="req-performance">High performance requirements</label>
          </div>
          <div class="checkbox-item">
            <input type="checkbox" id="req-vr" value="VR experience">
            <label for="req-vr">VR experience</label>
          </div>
          <div class="checkbox-item">
            <input type="checkbox" id="req-ecommerce" value="E-commerce integration">
            <label for="req-ecommerce">E-commerce integration</label>
          </div>
        </div>
      </div>
      <div class="form-group">
        <label for="targetPlatform">What's your target platform? *</label>
        <select id="targetPlatform" required>
          <option value="">Select Platform</option>
          <option value="webgl">WebGL (Web browser)</option>
          <option value="mobile-app">Mobile App</option>
          <option value="ar-ios">AR (iOS)</option>
          <option value="ar-android">AR (Android)</option>
          <option value="vr-headset">VR Headset</option>
          <option value="multiple">Multiple platforms</option>
        </select>
      </div>
      <div class="form-group">
        <label for="customRequirements">Any specific requirements or constraints?</label>
        <textarea id="customRequirements" placeholder="e.g., Must work on older devices, specific file size limits, integration with existing systems..."></textarea>
      </div>
      <div class="form-row">
        <button class="next-btn" onclick="prevStep(3, 2)" style="background:#6b7280">Previous</button>
        <button class="next-btn" onclick="nextStep(4, 5)">Next</button>
      </div>
    </section>

    <!-- Step 5: Asset Organization -->
    <section id="step5-section" class="questionnaire-step hidden">
      <h2>📁 Asset Organization & Workflow</h2>
      <div class="form-group">
        <label for="assetOrganization">How do you plan to organize your 3D assets? *</label>
        <select id="assetOrganization" required>
          <option value="">Select Organization Method</option>
          <option value="Separated by component">Separated by component (recommended for configurators)</option>
          <option value="Separated parts by materials">Separated parts by materials</option>
          <option value="Single combined meshes">Single combined meshes (simpler setup)</option>
          <option value="Mixed approach">Mixed approach (some combined, some separated)</option>
        </select>
      </div>
      <div class="form-group">
        <label for="materialApproach">How will you handle materials and textures? *</label>
        <select id="materialApproach" required>
          <option value="">Select Material Approach</option>
          <option value="Use existing materials from DCC">Use existing materials from DCC</option>
          <option value="Create new materials in Threekit">Create new materials in Threekit</option>
          <option value="Mix of both approaches">Mix of both approaches</option>
        </select>
      </div>
      <div class="form-group">
        <label for="namingConvention">What naming convention do you prefer for objects and materials? *</label>
        <div style="display: flex; gap: 0.5rem; margin-bottom: 0.5rem;">
          <select id="namingConventionSelect" onchange="applyNamingConvention()" style="flex: 1;">
            <option value="">Select Recommended Convention</option>
            <option value="ProductType_PartName">ProductType_PartName (Official Threekit Standard)</option>
            <option value="Product_Part_Material">Product_Part_Material (Simple)</option>
            <option value="Category_Component_Material">Category_Component_Material (Hierarchical)</option>
            <option value="Brand_Product_Part">Brand_Product_Part (Brand-focused)</option>
            <option value="custom">Custom (Enter your own)</option>
          </select>
          <button type="button" onclick="showNamingExamples()" class="next-btn" style="background: #6b7280; padding: 0.5rem 1rem; font-size: 0.875rem;">Examples</button>
        </div>
        <input type="text" id="namingConvention" placeholder="e.g., ProductType_PartName" required />
        <div id="namingExamples" class="info-box info" style="display: none; margin-top: 1rem;">
          <h4>📝 Naming Convention Examples</h4>
          <div id="examplesContent"></div>
        </div>
      </div>
      <div class="form-group">
        <label for="polygonCount">What's your typical polygon count per product?</label>
        <select id="polygonCount">
          <option value="">Select Polygon Count</option>
          <option value="low">Low (under 5k triangles)</option>
          <option value="medium">Medium (5k-50k triangles)</option>
          <option value="high">High (50k-200k triangles)</option>
          <option value="very-high">Very High (200k+ triangles)</option>
        </select>
      </div>
      
      <!-- Screenshot Upload Section -->
      <div class="form-group">
        <div class="checkbox-item">
          <input type="checkbox" id="includeScreenshots" onchange="toggleScreenshotSection()">
          <label for="includeScreenshots">📸 I want to share reference images of my 3D model structure</label>
        </div>
        <p style="font-size:14px;color:#6b7280;margin-top:8px;">Upload up to 12 screenshots showing how your models are organized (e.g., Weight Sets, Benches, Accessories as separate objects)</p>
      </div>

      <div id="screenshotSection" class="form-group" style="display: none;">
        <label>📸 Reference Images</label>
        <p style="font-size:14px;color:#6b7280;margin-bottom:1rem;">
          Paste screenshots showing how your 3D models are organized. Click on the paste area and press Ctrl+V (or Cmd+V on Mac) to paste from clipboard.
        </p>
        
        <div id="screenshotSlots">
          <!-- Screenshot slot 1 -->
          <div class="screenshot-slot" id="slot1">
            <div class="paste-area" id="pasteArea1" tabindex="0">
              <p style="margin-bottom: 0.5rem;">📋 Click here and press Ctrl+V to paste image</p>
              <p style="font-size:12px;color:#888;">Or drag & drop an image file</p>
            </div>
            <img id="preview1" class="screenshot-preview" style="display:none; max-width: 100%; margin-top: 0.5rem; border-radius: 8px;">
            <input type="text" id="caption1" placeholder="Add a description (e.g., 'Weight Sets separated by type')" style="display:none; margin-top:0.5rem; width: 100%; padding: 0.5rem; border: 2px solid #e2e8f0; border-radius: 8px;">
            <button type="button" onclick="removeScreenshot(1)" class="next-btn" style="display:none; margin-top:0.5rem; background:#ef4444; padding: 0.5rem 1rem;" id="removeBtn1">Remove Image</button>
          </div>
          
          <!-- Screenshot slot 2 -->
          <div class="screenshot-slot" id="slot2" style="display:none; margin-top:1.5rem;">
            <div class="paste-area" id="pasteArea2" tabindex="0">
              <p style="margin-bottom: 0.5rem;">📋 Click here and press Ctrl+V to paste another image</p>
              <p style="font-size:12px;color:#888;">Or drag & drop an image file</p>
            </div>
            <img id="preview2" class="screenshot-preview" style="display:none; max-width: 100%; margin-top: 0.5rem; border-radius: 8px;">
            <input type="text" id="caption2" placeholder="Add a description" style="display:none; margin-top:0.5rem; width: 100%; padding: 0.5rem; border: 2px solid #e2e8f0; border-radius: 8px;">
            <div style="margin-top:0.5rem; display: flex; gap: 0.5rem;">
              <button type="button" onclick="removeScreenshot(2)" class="next-btn" style="display:none; background:#ef4444; padding: 0.5rem 1rem; flex: 1;" id="removeBtn2">Remove Image</button>
              <button type="button" onclick="hideSlot(2)" class="next-btn" style="background:#6b7280; padding: 0.5rem 1rem; flex: 1;">Hide Slot</button>
            </div>
          </div>
          
          <!-- Screenshot slot 3 -->
          <div class="screenshot-slot" id="slot3" style="display:none; margin-top:1.5rem;">
            <div class="paste-area" id="pasteArea3" tabindex="0">
              <p style="margin-bottom: 0.5rem;">📋 Click here and press Ctrl+V to paste another image</p>
              <p style="font-size:12px;color:#888;">Or drag & drop an image file</p>
            </div>
            <img id="preview3" class="screenshot-preview" style="display:none; max-width: 100%; margin-top: 0.5rem; border-radius: 8px;">
            <input type="text" id="caption3" placeholder="Add a description" style="display:none; margin-top:0.5rem; width: 100%; padding: 0.5rem; border: 2px solid #e2e8f0; border-radius: 8px;">
            <div style="margin-top:0.5rem; display: flex; gap: 0.5rem;">
              <button type="button" onclick="removeScreenshot(3)" class="next-btn" style="display:none; background:#ef4444; padding: 0.5rem 1rem; flex: 1;" id="removeBtn3">Remove Image</button>
              <button type="button" onclick="hideSlot(3)" class="next-btn" style="background:#6b7280; padding: 0.5rem 1rem; flex: 1;">Hide Slot</button>
            </div>
          </div>
          
          <!-- Screenshot slot 4 -->
          <div class="screenshot-slot" id="slot4" style="display:none; margin-top:1.5rem;">
            <div class="paste-area" id="pasteArea4" tabindex="0">
              <p style="margin-bottom: 0.5rem;">📋 Click here and press Ctrl+V to paste another image</p>
              <p style="font-size:12px;color:#888;">Or drag & drop an image file</p>
            </div>
            <img id="preview4" class="screenshot-preview" style="display:none; max-width: 100%; margin-top: 0.5rem; border-radius: 8px;">
            <input type="text" id="caption4" placeholder="Add a description" style="display:none; margin-top:0.5rem; width: 100%; padding: 0.5rem; border: 2px solid #e2e8f0; border-radius: 8px;">
            <div style="margin-top:0.5rem; display: flex; gap: 0.5rem;">
              <button type="button" onclick="removeScreenshot(4)" class="next-btn" style="display:none; background:#ef4444; padding: 0.5rem 1rem; flex: 1;" id="removeBtn4">Remove Image</button>
              <button type="button" onclick="hideSlot(4)" class="next-btn" style="background:#6b7280; padding: 0.5rem 1rem; flex: 1;">Hide Slot</button>
            </div>
          </div>
          
          <!-- Screenshot slot 5 -->
          <div class="screenshot-slot" id="slot5" style="display:none; margin-top:1.5rem;">
            <div class="paste-area" id="pasteArea5" tabindex="0">
              <p style="margin-bottom: 0.5rem;">📋 Click here and press Ctrl+V to paste another image</p>
              <p style="font-size:12px;color:#888;">Or drag & drop an image file</p>
            </div>
            <img id="preview5" class="screenshot-preview" style="display:none; max-width: 100%; margin-top: 0.5rem; border-radius: 8px;">
            <input type="text" id="caption5" placeholder="Add a description" style="display:none; margin-top:0.5rem; width: 100%; padding: 0.5rem; border: 2px solid #e2e8f0; border-radius: 8px;">
            <div style="margin-top:0.5rem; display: flex; gap: 0.5rem;">
              <button type="button" onclick="removeScreenshot(5)" class="next-btn" style="display:none; background:#ef4444; padding: 0.5rem 1rem; flex: 1;" id="removeBtn5">Remove Image</button>
              <button type="button" onclick="hideSlot(5)" class="next-btn" style="background:#6b7280; padding: 0.5rem 1rem; flex: 1;">Hide Slot</button>
            </div>
          </div>
          
          <!-- Screenshot slot 6 -->
          <div class="screenshot-slot" id="slot6" style="display:none; margin-top:1.5rem;">
            <div class="paste-area" id="pasteArea6" tabindex="0">
              <p style="margin-bottom: 0.5rem;">📋 Click here and press Ctrl+V to paste another image</p>
              <p style="font-size:12px;color:#888;">Or drag & drop an image file</p>
            </div>
            <img id="preview6" class="screenshot-preview" style="display:none; max-width: 100%; margin-top: 0.5rem; border-radius: 8px;">
            <input type="text" id="caption6" placeholder="Add a description" style="display:none; margin-top:0.5rem; width: 100%; padding: 0.5rem; border: 2px solid #e2e8f0; border-radius: 8px;">
            <div style="margin-top:0.5rem; display: flex; gap: 0.5rem;">
              <button type="button" onclick="removeScreenshot(6)" class="next-btn" style="display:none; background:#ef4444; padding: 0.5rem 1rem; flex: 1;" id="removeBtn6">Remove Image</button>
              <button type="button" onclick="hideSlot(6)" class="next-btn" style="background:#6b7280; padding: 0.5rem 1rem; flex: 1;">Hide Slot</button>
            </div>
          </div>
          
          <!-- Screenshot slot 7 -->
          <div class="screenshot-slot" id="slot7" style="display:none; margin-top:1.5rem;">
            <div class="paste-area" id="pasteArea7" tabindex="0">
              <p style="margin-bottom: 0.5rem;">📋 Click here and press Ctrl+V to paste another image</p>
              <p style="font-size:12px;color:#888;">Or drag & drop an image file</p>
            </div>
            <img id="preview7" class="screenshot-preview" style="display:none; max-width: 100%; margin-top: 0.5rem; border-radius: 8px;">
            <input type="text" id="caption7" placeholder="Add a description" style="display:none; margin-top:0.5rem; width: 100%; padding: 0.5rem; border: 2px solid #e2e8f0; border-radius: 8px;">
            <div style="margin-top:0.5rem; display: flex; gap: 0.5rem;">
              <button type="button" onclick="removeScreenshot(7)" class="next-btn" style="display:none; background:#ef4444; padding: 0.5rem 1rem; flex: 1;" id="removeBtn7">Remove Image</button>
              <button type="button" onclick="hideSlot(7)" class="next-btn" style="background:#6b7280; padding: 0.5rem 1rem; flex: 1;">Hide Slot</button>
            </div>
          </div>
          
          <!-- Screenshot slot 8 -->
          <div class="screenshot-slot" id="slot8" style="display:none; margin-top:1.5rem;">
            <div class="paste-area" id="pasteArea8" tabindex="0">
              <p style="margin-bottom: 0.5rem;">📋 Click here and press Ctrl+V to paste another image</p>
              <p style="font-size:12px;color:#888;">Or drag & drop an image file</p>
            </div>
            <img id="preview8" class="screenshot-preview" style="display:none; max-width: 100%; margin-top: 0.5rem; border-radius: 8px;">
            <input type="text" id="caption8" placeholder="Add a description" style="display:none; margin-top:0.5rem; width: 100%; padding: 0.5rem; border: 2px solid #e2e8f0; border-radius: 8px;">
            <div style="margin-top:0.5rem; display: flex; gap: 0.5rem;">
              <button type="button" onclick="removeScreenshot(8)" class="next-btn" style="display:none; background:#ef4444; padding: 0.5rem 1rem; flex: 1;" id="removeBtn8">Remove Image</button>
              <button type="button" onclick="hideSlot(8)" class="next-btn" style="background:#6b7280; padding: 0.5rem 1rem; flex: 1;">Hide Slot</button>
            </div>
          </div>
          
          <!-- Screenshot slot 9 -->
          <div class="screenshot-slot" id="slot9" style="display:none; margin-top:1.5rem;">
            <div class="paste-area" id="pasteArea9" tabindex="0">
              <p style="margin-bottom: 0.5rem;">📋 Click here and press Ctrl+V to paste another image</p>
              <p style="font-size:12px;color:#888;">Or drag & drop an image file</p>
            </div>
            <img id="preview9" class="screenshot-preview" style="display:none; max-width: 100%; margin-top: 0.5rem; border-radius: 8px;">
            <input type="text" id="caption9" placeholder="Add a description" style="display:none; margin-top:0.5rem; width: 100%; padding: 0.5rem; border: 2px solid #e2e8f0; border-radius: 8px;">
            <div style="margin-top:0.5rem; display: flex; gap: 0.5rem;">
              <button type="button" onclick="removeScreenshot(9)" class="next-btn" style="display:none; background:#ef4444; padding: 0.5rem 1rem; flex: 1;" id="removeBtn9">Remove Image</button>
              <button type="button" onclick="hideSlot(9)" class="next-btn" style="background:#6b7280; padding: 0.5rem 1rem; flex: 1;">Hide Slot</button>
            </div>
          </div>
          
          <!-- Screenshot slot 10 -->
          <div class="screenshot-slot" id="slot10" style="display:none; margin-top:1.5rem;">
            <div class="paste-area" id="pasteArea10" tabindex="0">
              <p style="margin-bottom: 0.5rem;">📋 Click here and press Ctrl+V to paste another image</p>
              <p style="font-size:12px;color:#888;">Or drag & drop an image file</p>
            </div>
            <img id="preview10" class="screenshot-preview" style="display:none; max-width: 100%; margin-top: 0.5rem; border-radius: 8px;">
            <input type="text" id="caption10" placeholder="Add a description" style="display:none; margin-top:0.5rem; width: 100%; padding: 0.5rem; border: 2px solid #e2e8f0; border-radius: 8px;">
            <div style="margin-top:0.5rem; display: flex; gap: 0.5rem;">
              <button type="button" onclick="removeScreenshot(10)" class="next-btn" style="display:none; background:#ef4444; padding: 0.5rem 1rem; flex: 1;" id="removeBtn10">Remove Image</button>
              <button type="button" onclick="hideSlot(10)" class="next-btn" style="background:#6b7280; padding: 0.5rem 1rem; flex: 1;">Hide Slot</button>
            </div>
          </div>
          
          <!-- Screenshot slot 11 -->
          <div class="screenshot-slot" id="slot11" style="display:none; margin-top:1.5rem;">
            <div class="paste-area" id="pasteArea11" tabindex="0">
              <p style="margin-bottom: 0.5rem;">📋 Click here and press Ctrl+V to paste another image</p>
              <p style="font-size:12px;color:#888;">Or drag & drop an image file</p>
            </div>
            <img id="preview11" class="screenshot-preview" style="display:none; max-width: 100%; margin-top: 0.5rem; border-radius: 8px;">
            <input type="text" id="caption11" placeholder="Add a description" style="display:none; margin-top:0.5rem; width: 100%; padding: 0.5rem; border: 2px solid #e2e8f0; border-radius: 8px;">
            <div style="margin-top:0.5rem; display: flex; gap: 0.5rem;">
              <button type="button" onclick="removeScreenshot(11)" class="next-btn" style="display:none; background:#ef4444; padding: 0.5rem 1rem; flex: 1;" id="removeBtn11">Remove Image</button>
              <button type="button" onclick="hideSlot(11)" class="next-btn" style="background:#6b7280; padding: 0.5rem 1rem; flex: 1;">Hide Slot</button>
            </div>
          </div>
          
          <!-- Screenshot slot 12 -->
          <div class="screenshot-slot" id="slot12" style="display:none; margin-top:1.5rem;">
            <div class="paste-area" id="pasteArea12" tabindex="0">
              <p style="margin-bottom: 0.5rem;">📋 Click here and press Ctrl+V to paste another image</p>
              <p style="font-size:12px;color:#888;">Or drag & drop an image file</p>
            </div>
            <img id="preview12" class="screenshot-preview" style="display:none; max-width: 100%; margin-top: 0.5rem; border-radius: 8px;">
            <input type="text" id="caption12" placeholder="Add a description" style="display:none; margin-top:0.5rem; width: 100%; padding: 0.5rem; border: 2px solid #e2e8f0; border-radius: 8px;">
            <div style="margin-top:0.5rem; display: flex; gap: 0.5rem;">
              <button type="button" onclick="removeScreenshot(12)" class="next-btn" style="display:none; background:#ef4444; padding: 0.5rem 1rem; flex: 1;" id="removeBtn12">Remove Image</button>
              <button type="button" onclick="hideSlot(12)" class="next-btn" style="background:#6b7280; padding: 0.5rem 1rem; flex: 1;">Hide Slot</button>
            </div>
          </div>
        </div>
        
        <!-- Add More Images Button -->
        <button type="button" id="addMoreImagesBtn" onclick="showNextImageSlot()" class="next-btn" style="background:#667EEA; margin-top: 1rem; display: none;">
          ➕ Add More Images
        </button>
      </div>
      
      <div class="form-row">
        <button class="next-btn" onclick="prevStep(5, 4)" style="background:#6b7280">Previous</button>
        <button class="next-btn" onclick="nextStep(5, 6)">Next</button>
      </div>
    </section>

    <!-- Step 6: Export & Texture Settings -->
    <section id="step6-section" class="questionnaire-step hidden">
      <h2>🎨 Export & Texture Settings</h2>
      <div class="form-group">
        <label for="exportFormat">Preferred Export Format *</label>
        <select id="exportFormat" required>
          <option value="">Select Export Format</option>
          <option value="FBX">FBX (Recommended for Threekit)</option>
          <option value="GLB/GLTF">GLB/GLTF (Web optimized)</option>
          <option value="USDZ">USDZ (iOS AR only)</option>
          <option value="OBJ">OBJ (Fallback option)</option>
        </select>
        <p style="font-size:14px;color:#6b7280;margin-top:4px;">FBX is recommended for best Threekit compatibility and feature support</p>
      </div>
      
      <div class="form-group">
        <label>Texture Requirements *</label>
        <div class="checkbox-group">
          <div class="checkbox-item">
            <input type="checkbox" id="tex-diffuse" value="Diffuse/Albedo maps" checked>
            <label for="tex-diffuse">Diffuse/Albedo maps</label>
          </div>
          <div class="checkbox-item">
            <input type="checkbox" id="tex-normal" value="Normal maps">
            <label for="tex-normal">Normal maps</label>
          </div>
          <div class="checkbox-item">
            <input type="checkbox" id="tex-bump" value="Bump maps">
            <label for="tex-bump">Bump maps</label>
          </div>
          <div class="checkbox-item">
            <input type="checkbox" id="tex-roughness" value="Roughness/Metallic maps">
            <label for="tex-roughness">Roughness/Metallic maps</label>
          </div>
          <div class="checkbox-item">
            <input type="checkbox" id="tex-ao" value="Ambient Occlusion (AO) maps">
            <label for="tex-ao">Ambient Occlusion (AO) maps</label>
          </div>
          <div class="checkbox-item">
            <input type="checkbox" id="tex-emission" value="Emission maps">
            <label for="tex-emission">Emission maps</label>
          </div>
          <div class="checkbox-item">
            <input type="checkbox" id="tex-alpha" value="Alpha/Transparency maps">
            <label for="tex-alpha">Alpha/Transparency maps</label>
          </div>
        </div>
      </div>

      <div class="form-group">
        <label for="textureFormat">Texture Format Preference *</label>
        <select id="textureFormat" required>
          <option value="">Select Texture Format</option>
          <option value="PNG">PNG (Recommended for alpha channels)</option>
          <option value="JPEG">JPEG (Smaller file size, no alpha)</option>
          <option value="Mixed">Mixed (PNG for alpha, JPEG for others)</option>
        </select>
        <p style="font-size:14px;color:#6b7280;margin-top:4px;">PNG for textures with transparency/alpha, JPEG for standard textures</p>
      </div>

      <div class="form-group">
        <label for="textureResolution">Texture Resolution *</label>
        <select id="textureResolution" required>
          <option value="">Select Resolution</option>
          <option value="512">512x512 (Low quality, fast loading)</option>
          <option value="1024">1024x1024 (Standard quality)</option>
          <option value="2048">2048x2048 (High quality, recommended)</option>
          <option value="4096">4096x4096 (Ultra high quality)</option>
        </select>
      </div>

      <div class="form-group">
        <label for="uvMapping">UV Mapping Strategy *</label>
        <select id="uvMapping" required>
          <option value="">Select UV Strategy</option>
          <option value="uv0-only">UV0 only (Standard mapping)</option>
          <option value="uv0-uv1">UV0 + UV1 (UV0 for diffuse, UV1 for AO - Threekit recommended)</option>
          <option value="uv0-uv1-uv2">UV0 + UV1 + UV2 (Advanced multi-channel)</option>
        </select>
        <p style="font-size:14px;color:#6b7280;margin-top:4px;">UV0 is default for diffuse textures, UV1 is typically used for AO maps in Threekit</p>
      </div>

      <div class="form-group">
        <label for="lightingSetup">Lighting and Shading Approach *</label>
        <select id="lightingSetup" required>
          <option value="">Select Lighting Approach</option>
          <option value="pbr-hdr">PBR with HDR (Recommended for Threekit)</option>
          <option value="hdr-only">HDR lighting only</option>
          <option value="threekit-scene">Threekit scene lighting (Simple assets only)</option>
          <option value="pbr">PBR (Physically Based Rendering)</option>
          <option value="traditional">Traditional (Diffuse + Specular)</option>
          <option value="mixed">Mixed approach</option>
        </select>
        <p style="font-size:14px;color:#6b7280;margin-top:4px;">HDR lighting provides better material accuracy and realistic lighting in Threekit. Scene lighting in Threekit is only recommended for simple assets due to performance considerations.</p>
      </div>

      <div class="form-row">
        <button class="next-btn" onclick="prevStep(6, 5)" style="background:#6b7280">Previous</button>
        <button class="next-btn" onclick="nextStep(6, 7)">Next</button>
      </div>
    </section>

    <!-- Step 7: Training Focus Selection -->
    <section id="step7-section" class="questionnaire-step hidden">
      <h2>🎓 Training Focus Selection</h2>
      <p>Select the Threekit training modules that are most relevant to your project. This will help us provide targeted learning resources.</p>
      
      <div class="form-group">
        <label>Who will be doing the configuration on the Threekit platform? *</label>
        <div class="radio-group">
          <label class="radio-label">
            <input type="radio" name="configurator" value="threekit-team" required>
            <span class="radio-mark"></span>
            Threekit Team - We'll handle the platform configuration
          </label>
          <label class="radio-label">
            <input type="radio" name="configurator" value="customer-team" required>
            <span class="radio-mark"></span>
            Our Team - We'll configure the platform ourselves
          </label>
          <label class="radio-label">
            <input type="radio" name="configurator" value="collaborative" required>
            <span class="radio-mark"></span>
            Collaborative - We'll work together on the configuration
          </label>
        </div>
      </div>
      
      <div class="form-group">
        <label>Which areas would you like to focus on? (Select all that apply)</label>
        <div class="checkbox-group">
          <label class="checkbox-label">
            <input type="checkbox" name="trainingModules" value="basic-renders">
            <span class="checkmark"></span>
            Basic Renders - Learn fundamental rendering concepts
          </label>
          <label class="checkbox-label">
            <input type="checkbox" name="trainingModules" value="catalog-setup">
            <span class="checkmark"></span>
            Catalog Setup - Configure products and variants
          </label>
          <label class="checkbox-label">
            <input type="checkbox" name="trainingModules" value="pricing-configuration">
            <span class="checkmark"></span>
            Pricing Configuration - Set up dynamic pricing
          </label>
          <label class="checkbox-label">
            <input type="checkbox" name="trainingModules" value="rules-logic">
            <span class="checkmark"></span>
            Rules & Logic - Create conditional behaviors
          </label>
          <label class="checkbox-label">
            <input type="checkbox" name="trainingModules" value="data-tables">
            <span class="checkmark"></span>
            Data Tables - Manage product data efficiently
          </label>
          <label class="checkbox-label">
            <input type="checkbox" name="trainingModules" value="dimensions-annotations">
            <span class="checkmark"></span>
            Dimensions & Annotations - Add measurement displays
          </label>
          <label class="checkbox-label">
            <input type="checkbox" name="trainingModules" value="stages-workflow">
            <span class="checkmark"></span>
            Stages & Workflow - Organize configuration steps
          </label>
          <label class="checkbox-label">
            <input type="checkbox" name="trainingModules" value="metadata-management">
            <span class="checkmark"></span>
            Metadata Management - Organize product information
          </label>
          <label class="checkbox-label">
            <input type="checkbox" name="trainingModules" value="proxy-materials">
            <span class="checkmark"></span>
            Proxy Materials - Optimize material performance
          </label>
          <label class="checkbox-label">
            <input type="checkbox" name="trainingModules" value="image-annotations">
            <span class="checkmark"></span>
            Image Annotations - Add interactive image overlays
          </label>
        </div>
      </div>
      
      <div class="form-row">
        <button class="next-btn" onclick="prevStep(7, 6)" style="background:#6b7280">Previous</button>
        <button class="next-btn" onclick="nextStep(7, 8)">Next</button>
      </div>
    </section>

    <!-- Step 8: Contact & Generate Guide -->
    <section id="step8-section" class="questionnaire-step hidden">
      <h2 style="display: flex; align-items: center; gap: 1rem; flex-wrap: wrap;">
        <img src="https://www.threekit.com/hubfs/Logos%20and%20Trademarks/threekit_logo_black.svg" alt="Threekit" style="height: 28px; width: auto;" />
        <span>📞 Contact Information & Generate Guide</span>
      </h2>
      <div class="form-row">
        <div class="form-group">
          <label for="contactName">Your Name *</label>
          <input type="text" id="contactName" placeholder="e.g., John Smith" required />
        </div>
        <div class="form-group">
          <label for="contactEmail">Email Address *</label>
          <input type="email" id="contactEmail" placeholder="e.g., john@company.com" required />
        </div>
      </div>
      <div class="form-group">
        <label for="additionalNotes">Any additional notes or questions?</label>
        <textarea id="additionalNotes" placeholder="Any specific concerns, questions, or additional information..."></textarea>
      </div>
      <div class="form-row">
        <button class="next-btn" onclick="prevStep(8, 7)" style="background:#6b7280">Previous</button>
        <button class="next-btn" onclick="previewGuide()" style="background:#00D4AA">Generate My Custom Guide</button>
      </div>
    </section>

    <!-- Results Section -->
    <section id="results-section" class="questionnaire-step hidden">
      <h2>✅ Your Customized Tech Spec is Ready!</h2>
      <div id="guideContent" class="guide-content">
        <!-- Generated guide content will appear here -->
      </div>
      <div class="form-row">
        <button class="next-btn" onclick="updateCurrentGuide()" style="background:#00D4AA">🔄 Update Guide</button>
        <button class="next-btn print-visible" onclick="printGuide()" style="background:#22c55e">📄 Export to PDF</button>
        <button class="next-btn" onclick="exportAsHTML()" style="background:#3b82f6">🌐 Export as HTML</button>
        <button class="next-btn" onclick="downloadConfig()" style="background:#2563eb">📊 Download Data (CSV + JSON)</button>
        <button class="next-btn" onclick="debugGuideContent()" style="background:#f59e0b; font-size: 0.8rem;">🔍 Debug Content</button>
        <button class="next-btn" onclick="startOver()" style="background:#6b7280">🔄 Start Over</button>
      </div>
    </section>
  </main>

  <!-- Customer Database Modal -->
  <div id="customerDatabaseModal" class="modal" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <h2>📊 Customer Database</h2>
        <span class="close" onclick="closeCustomerDatabase()">&times;</span>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label for="customerSearch">Search Customers:</label>
          <input type="text" id="customerSearch" placeholder="Search by company name or website..." onkeyup="filterCustomers()">
        </div>
        <div id="customerList" class="customer-list">
          <!-- Customer list will be populated here -->
        </div>
        <div class="form-row" style="margin-top: 1rem;">
          <button class="next-btn" onclick="loadSelectedCustomer()" style="background:#22c55e">Load Selected Customer</button>
          <button class="next-btn" onclick="deleteSelectedCustomer()" style="background:#ef4444">Delete Selected</button>
          <button class="next-btn" onclick="closeCustomerDatabase()" style="background:#6b7280">Close</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    let currentStep = 1;
    const totalSteps = 8;

    function nextStep(current, next) {
      console.log(`🚀 Attempting to go from step ${current} to step ${next}`);
      
      // Validate current step
      if (!validateStep(current)) {
        console.log(`❌ Step ${current} validation failed, staying on current step`);
        return;
      }

      console.log(`✅ Step ${current} validation passed, proceeding to step ${next}`);

      // Hide current step
      const currentSection = document.getElementById(`step${current}-section`);
      if (currentSection) {
        currentSection.classList.add('hidden');
        console.log(`👁️ Hidden step ${current} section`);
      } else {
        console.log(`❌ Could not find step ${current} section`);
      }
      
      // Show next step
      const nextSection = document.getElementById(`step${next}-section`);
      if (nextSection) {
        nextSection.classList.remove('hidden');
        console.log(`👁️ Showed step ${next} section`);
      } else {
        console.log(`❌ Could not find step ${next} section`);
      }
      
      // Update progress bar
      updateProgressBar(next);
      
      // Scroll to top
      window.scrollTo(0, 0);
      console.log(`🎉 Successfully navigated to step ${next}`);
    }

    function prevStep(current, prev) {
      // Hide current step
      document.getElementById(`step${current}-section`).classList.add('hidden');
      
      // Show previous step
      document.getElementById(`step${prev}-section`).classList.remove('hidden');
      
      // Update progress bar
      updateProgressBar(prev);
      
      // Scroll to top
      window.scrollTo(0, 0);
    }

    function validateStep(step) {
      console.log(`🔍 Validating step ${step}`);
      const requiredFields = document.querySelectorAll(`#step${step}-section input[required], #step${step}-section select[required]`);
      console.log(`📋 Found ${requiredFields.length} required fields in step ${step}`);
      let isValid = true;

      requiredFields.forEach((field, index) => {
        console.log(`🔍 Field ${index + 1}: ${field.id || field.name} = "${field.value}"`);
        if (!field.value.trim()) {
          console.log(`❌ Field ${field.id || field.name} is empty`);
          field.style.borderColor = '#ef4444';
          isValid = false;
        } else {
          console.log(`✅ Field ${field.id || field.name} is valid`);
          field.style.borderColor = '#e2e8f0';
        }
      });

      // Check if at least one requirement is selected in step 4 (project requirements)
      if (step === 4) {
        const checkboxes = document.querySelectorAll('#step4-section input[type="checkbox"]:checked');
        console.log(`📋 Found ${checkboxes.length} checked checkboxes in step 4`);
        if (checkboxes.length === 0) {
          console.log('❌ No project requirements selected');
          alert('Please select at least one project requirement.');
          isValid = false;
        } else {
          console.log('✅ Project requirements selected');
        }
      }
      
      // Check if at least one training module is selected in step 7
      if (step === 7) {
        const trainingCheckboxes = document.querySelectorAll('#step7-section input[name="trainingModules"]:checked');
        console.log(`📋 Found ${trainingCheckboxes.length} training modules selected in step 7`);
        if (trainingCheckboxes.length === 0) {
          console.log('❌ No training modules selected');
          alert('Please select at least one training module to focus on.');
          isValid = false;
        } else {
          console.log('✅ Training modules selected');
        }
      }

      console.log(`🎯 Step ${step} validation result: ${isValid ? 'VALID' : 'INVALID'}`);
      return isValid;
    }


    function updateProgressBar(step) {
      const progress = (step / totalSteps) * 100;
      document.getElementById('progressFill').style.width = `${progress}%`;
    }

    function previewGuide() {
      console.log('👁️ Preview Guide clicked');
      
      if (!validateStep(7)) {
        console.log('❌ Step 7 validation failed');
        return;
      }

      console.log('✅ Step 7 validation passed');

      // Collect all form data
      const formData = collectFormData();
      console.log('📋 Form data collected for preview:', formData);
      
      // Generate client configuration
      const clientConfig = generateClientConfig(formData);
      console.log('⚙️ Client config generated for preview:', clientConfig);
      
      // Show results in preview mode
      console.log('👁️ Calling showResults with preview=true');
      showResults(clientConfig, true);
    }

    function generateCustomGuide() {
      console.log('📝 Generate Custom Guide clicked');
      
      // Validate Step 1 at minimum (company info)
      if (!validateStep(1)) {
        alert('Please fill in all required Company Information fields.');
        return;
      }
      
      // If we're on Step 8, validate it
      const step8Visible = !document.getElementById('step8-section').classList.contains('hidden');
      if (step8Visible && !validateStep(8)) {
        alert('Please fill in your contact information.');
        return;
      }

      // Fill in default values for any missing steps
      fillDefaultValuesForDocumentation();

      // Collect all form data
      const formData = collectFormData();
      
      // Save customer to database
      saveCustomerToDatabase(formData);
      
      // Generate client configuration
      const clientConfig = generateClientConfig(formData);
      
      // Update progress to 100%
      updateProgressBar(8);
      
      // Hide all steps
      document.querySelectorAll('.questionnaire-step').forEach(step => {
        step.classList.add('hidden');
      });
      
      // Show results
      showResults(clientConfig);
      
      console.log('✅ Guide generated successfully');
    }

    function updateCurrentGuide() {
      console.log('🔄 Update Current Guide clicked');
      
      // Collect all form data (using current values)
      const formData = collectFormData();
      
      // Update customer in database
      saveCustomerToDatabase(formData);
      
      // Generate client configuration
      const clientConfig = generateClientConfig(formData);
      
      // Regenerate guide content in place
      const guideContent = document.getElementById('guideContent');
      guideContent.innerHTML = generateGuideHTML(clientConfig);
      
      // Scroll to top of guide
      guideContent.scrollIntoView({ behavior: 'smooth', block: 'start' });
      
      console.log('✅ Guide updated successfully');
      
      // Show a brief confirmation message
      const resultsTitle = document.querySelector('#results-section h2');
      const originalTitle = resultsTitle.textContent;
      resultsTitle.textContent = '✅ Guide Updated Successfully!';
      resultsTitle.style.color = '#00D4AA';
      
      setTimeout(() => {
        resultsTitle.textContent = originalTitle;
        resultsTitle.style.color = '';
      }, 2000);
    }

    function collectFormData() {
      const requirements = [];
      document.querySelectorAll('input[type="checkbox"]:checked').forEach(checkbox => {
        requirements.push(checkbox.value);
      });

      const textureRequirements = [];
      document.querySelectorAll('#step5-section input[type="checkbox"]:checked').forEach(checkbox => {
        textureRequirements.push(checkbox.value);
      });

      const trainingModules = [];
      document.querySelectorAll('input[name="trainingModules"]:checked').forEach(checkbox => {
        trainingModules.push(checkbox.value);
      });

      // Get configuration type
      const configType = document.querySelector('input[name="configType"]:checked');
      
      // Get configurator
      const configurator = document.querySelector('input[name="configurator"]:checked');
      
      return {
        companyName: document.getElementById('companyName').value,
        industry: document.getElementById('industry').value,
        projectDescription: document.getElementById('projectDescription').value,
        clientWebsite: document.getElementById('clientWebsite').value,
        existingConfig: document.getElementById('existingConfig').value,
        configType: configType ? configType.value : '',
        '3dSoftware': document.getElementById('3dSoftware').value,
        renderEngine: document.getElementById('renderEngine').value,
        experienceLevel: document.getElementById('experienceLevel').value,
        requirements: requirements,
        targetPlatform: document.getElementById('targetPlatform').value,
        customRequirements: document.getElementById('customRequirements').value,
        assetOrganization: document.getElementById('assetOrganization').value,
        materialApproach: document.getElementById('materialApproach').value,
        namingConvention: document.getElementById('namingConvention').value,
        polygonCount: document.getElementById('polygonCount').value,
        exportFormat: document.getElementById('exportFormat').value,
        textureRequirements: textureRequirements,
        textureFormat: document.getElementById('textureFormat').value,
        textureResolution: document.getElementById('textureResolution').value,
        uvMapping: document.getElementById('uvMapping').value,
        lightingSetup: document.getElementById('lightingSetup').value,
        contactName: document.getElementById('contactName').value,
        contactEmail: document.getElementById('contactEmail').value,
        additionalNotes: document.getElementById('additionalNotes').value,
        trainingModules: trainingModules,
        configurator: configurator ? configurator.value : '',
        screenshots: screenshots, // Save screenshots with customer data
        includeScreenshots: document.getElementById('includeScreenshots').checked
      };
    }

    function generateClientConfig(formData) {
      // Generate client ID from company name
      const clientId = formData.companyName.toLowerCase().replace(/[^a-z0-9]/g, '-').replace(/-+/g, '-').replace(/^-|-$/g, '');
      
      // Use selected export format or determine based on software and platform
      let exportFormat = formData.exportFormat || 'FBX';
      if (!formData.exportFormat) {
        if (formData['3dSoftware'] === 'Blender' || formData.targetPlatform === 'webgl') {
          exportFormat = 'GLB/GLTF';
        } else if (formData.targetPlatform === 'ar-ios') {
          exportFormat = 'USDZ';
        }
      }

      // Determine polygon limit based on selection
      const polygonLimits = {
        'low': 5000,
        'medium': 50000,
        'high': 200000,
        'very-high': 500000
      };
      const polygonLimit = polygonLimits[formData.polygonCount] || 50000;

      // Determine texture format recommendations
      let textureFormatRecommendation = 'PNG';
      if (formData.textureFormat === 'JPEG') {
        textureFormatRecommendation = 'JPEG (no alpha channels)';
      } else if (formData.textureFormat === 'Mixed') {
        textureFormatRecommendation = 'PNG for alpha channels, JPEG for others';
      }

      return {
        // Internal data for Threekit team (CSV export)
        internalData: {
          clientId: clientId,
          clientName: formData.companyName,
          industry: formData.industry,
          clientWebsite: formData.clientWebsite,
          existingConfig: formData.existingConfig,
          projectDescription: formData.projectDescription,
          contactName: formData.contactName,
          contactEmail: formData.contactEmail,
          '3dSoftware': formData['3dSoftware'],
          renderEngine: formData.renderEngine,
          experienceLevel: formData.experienceLevel,
          targetPlatform: formData.targetPlatform,
          customRequirements: formData.customRequirements,
          additionalNotes: formData.additionalNotes,
          submissionDate: new Date().toISOString()
        },
        // Client-facing data (PDF export)
        clientData: {
          clientName: formData.companyName,
          industry: formData.industry,
          projectDescription: formData.projectDescription,
          projectType: formData.targetPlatform === 'webgl' ? 'webgl-configurator' : 'webgl-viewer',
          knownInfo: {
            '3dSoftware': formData['3dSoftware'],
            'exportFormat': exportFormat,
            'assetOrganization': formData.assetOrganization,
            'materialApproach': formData.materialApproach,
            'targetPlatform': formData.targetPlatform,
            'renderEngine': formData.renderEngine,
            'experienceLevel': formData.experienceLevel
          },
          textureSettings: {
            requirements: formData.textureRequirements,
            format: formData.textureFormat,
            resolution: formData.textureResolution,
            uvMapping: formData.uvMapping,
            lightingSetup: formData.lightingSetup
          },
          setupGuide: {
            focus: `${formData.industry} ${formData.targetPlatform === 'webgl' ? 'webgl-configurator' : 'webgl-viewer'}`,
            keyRequirements: formData.requirements,
            customRequirements: formData.customRequirements,
            exportSettings: {
              format: exportFormat,
              units: 'Centimeters',
              scaleFactor: 1.0,
              includeMaterials: true,
              includeTextures: true,
              polygonLimit: polygonLimit
            },
            materialGuidance: {
              namingConvention: formData.namingConvention || 'ProductType_PartName',
              textureRequirements: textureFormatRecommendation,
              textureResolution: `${formData.textureResolution}x${formData.textureResolution}`,
              uvMappingStrategy: formData.uvMapping,
              lightingApproach: formData.lightingSetup
            },
            specialInstructions: formData.additionalNotes
          }
        }
      };
    }

    function showResults(clientConfig, isPreview = false) {
      console.log('📊 showResults called with isPreview:', isPreview);
      
      // Hide current step
      document.getElementById('step7-section').classList.add('hidden');
      
      // Show results
      document.getElementById('results-section').classList.remove('hidden');
      
      // Generate guide content using client-facing data only
      console.log('📝 Generating guide content with clientData:', clientConfig.clientData);
      
      let guideContent = '';
      try {
        guideContent = generateGuideContent(clientConfig.clientData);
        console.log('📄 Generated guide content length:', guideContent.length);
      } catch (error) {
        console.error('❌ Error generating guide content:', error);
        guideContent = `
          <div class="info-box error">
            <h2>❌ Error Generating Guide</h2>
            <p>There was an error generating your customized guide. Please try again.</p>
            <p><strong>Error:</strong> ${error.message}</p>
          </div>
        `;
      }
      
      const guideContentElement = document.getElementById('guideContent');
      if (guideContentElement) {
        guideContentElement.innerHTML = guideContent;
        console.log('✅ Guide content set in DOM');
      } else {
        console.log('❌ Guide content element not found');
      }
      
      // Update results section title and buttons based on mode
      const resultsTitle = document.querySelector('#results-section h2');
      const resultsButtons = document.querySelector('#results-section .form-row');
      
      console.log('🎯 Results title element:', resultsTitle);
      console.log('🎯 Results buttons element:', resultsButtons);
      
      if (isPreview) {
        console.log('👁️ Setting preview mode - isPreview is true');
        console.log('🎯 Results title element found:', !!resultsTitle);
        console.log('🎯 Results buttons element found:', !!resultsButtons);
        
        if (resultsTitle) {
          resultsTitle.textContent = '👁️ Preview Your Customized Tech Spec';
          console.log('✅ Preview title set');
        } else {
          console.log('❌ Results title element not found');
        }
        
        if (resultsButtons) {
          resultsButtons.innerHTML = `
            <button class="next-btn" onclick="goBackToStep1()" style="background:#6b7280">← Back to Edit</button>
            <button class="next-btn" onclick="generateFinalGuide()" style="background:#22c55e">✅ Generate Final Guide</button>
          `;
          console.log('✅ Preview buttons set');
        } else {
          console.log('❌ Results buttons element not found');
        }
      } else {
        console.log('✅ Setting final mode - isPreview is false');
        if (resultsTitle) {
          resultsTitle.textContent = '✅ Your Customized Tech Spec is Ready!';
        }
        if (resultsButtons) {
          resultsButtons.innerHTML = `
            <button class="next-btn print-visible" onclick="printGuide()" style="background:#22c55e">📄 Export to PDF</button>
            <button class="next-btn" onclick="exportAsHTML()" style="background:#3b82f6">🌐 Export as HTML</button>
            <button class="next-btn" onclick="downloadConfig()" style="background:#2563eb">📊 Download Data (CSV + JSON)</button>
            <button class="next-btn" onclick="debugGuideContent()" style="background:#f59e0b; font-size: 0.8rem;">🔍 Debug Content</button>
            <button class="next-btn" onclick="startOver()" style="background:#6b7280">🔄 Start Over</button>
          `;
        }
      }
      
      // Update progress to 100%
      updateProgressBar(8);
      
      // Scroll to top
      window.scrollTo(0, 0);
    }

    function getLightingDisplayName(lightingSetup) {
      const displayNames = {
        'pbr-hdr': 'PBR with HDR (Recommended for Threekit)',
        'hdr-only': 'HDR lighting only',
        'threekit-scene': 'Threekit scene lighting (Simple assets only)',
        'pbr': 'PBR (Physically Based Rendering)',
        'traditional': 'Traditional (Diffuse + Specular)',
        'mixed': 'Mixed approach'
      };
      return displayNames[lightingSetup] || 'Standard lighting setup';
    }

    function getLightingDetails(lightingSetup) {
      const details = {
        'pbr-hdr': [
          'Use HDR environment maps for realistic lighting and material accuracy',
          'Best for photorealistic renders and accurate material representation',
          'Recommended for most Threekit projects',
          'Provides consistent lighting across different viewing angles'
        ],
        'hdr-only': [
          'Use HDR environment maps for lighting without full PBR workflow',
          'Good balance between quality and simplicity',
          'Suitable for projects that need realistic lighting but simpler materials',
          'Faster to set up than full PBR workflow'
        ],
        'threekit-scene': [
          'Use Threekit\'s built-in scene lighting system',
          '⚠️ Only recommended for simple assets due to performance considerations',
          'Best for basic product displays with minimal complexity',
          'Avoid for complex configurators with many parts or high polygon counts',
          'Consider this approach for mobile-optimized experiences'
        ],
        'pbr': [
          'Use PBR materials with standard lighting setup',
          'Good for projects that need material accuracy without HDR complexity',
          'Suitable for most web-based configurators',
          'Balances quality with performance'
        ],
        'traditional': [
          'Use traditional diffuse + specular materials',
          'Simplest approach, fastest to set up',
          'Good for basic product visualization',
          'May not provide the most realistic results'
        ],
        'mixed': [
          'Combine PBR and traditional materials based on asset complexity',
          'Use PBR for main products, traditional for simple accessories',
          'Good for complex projects with varying detail levels',
          'Requires careful planning for consistent results'
        ]
      };
      return (details[lightingSetup] || ['Use standard lighting setup']).map(item => `<li>${item}</li>`).join('');
    }

    function categorizeFeatures(requirements) {
      const threeDFeatures = [];
      const frontendFeatures = [];
      
      // Define feature categories
      const threeDCategories = [
        'Size Selection', 'Weight Stack Options', 'Accessory Combinations', 
        'Color Variants', 'Modular Components', 'Material Swapping',
        'Texture Variations', 'Model Variations', 'Component Switching',
        'Part Replacement', 'Assembly Options', 'Configuration Options'
      ];
      
      const frontendCategories = [
        'E-Commerce Integration', 'Shopping Cart', 'Product Comparison',
        'Wishlist', 'User Accounts', 'Payment Processing',
        'Inventory Management', 'Order Management', 'Customer Support',
        'Analytics', 'SEO Optimization', 'Mobile Responsiveness',
        'API Integration', 'Third-party Services', 'Social Media Integration'
      ];
      
      // Categorize each requirement
      requirements.forEach(req => {
        if (threeDCategories.some(category => req.includes(category))) {
          threeDFeatures.push(req);
        } else if (frontendCategories.some(category => req.includes(category))) {
          frontendFeatures.push(req);
        } else {
          // Default to 3D if it's not clearly frontend
          threeDFeatures.push(req);
        }
      });
      
      return {
        threeD: threeDFeatures.length > 0 ? threeDFeatures : ['Basic 3D visualization'],
        frontend: frontendFeatures.length > 0 ? frontendFeatures : ['Web integration and user interface']
      };
    }

    function generateWorkflowRecommendations(config) {
      const requirements = config.setupGuide.keyRequirements || [];
      const targetPlatform = config.knownInfo.targetPlatform;
      const configType = config.knownInfo.configType || 'interactive';
      const renderEngine = config.knownInfo.renderEngine;
      
      let recommendations = [];
      
      // Basic Visualization recommendations
      if (targetPlatform === 'webgl' || targetPlatform === 'ar-ios' || targetPlatform === 'ar-android') {
        recommendations.push({
          title: 'Basic Visualization Setup',
          description: 'Essential setup for interactive 3D experiences',
          link: 'https://community.threekit.com/learn/workflows/basic-visualization',
          icon: '🎮'
        });
      }
      
      // Text Personalization
      if (requirements.some(req => req.toLowerCase().includes('text') || req.toLowerCase().includes('personalization'))) {
        recommendations.push({
          title: 'Text Personalization',
          description: 'Set up text customization features',
          link: 'https://community.threekit.com/learn/workflows/text-personalization',
          icon: '✏️'
        });
      }
      
      // Image Upload Personalization
      if (requirements.some(req => req.toLowerCase().includes('image') || req.toLowerCase().includes('upload'))) {
        recommendations.push({
          title: 'Image Upload Personalization',
          description: 'Configure image upload and customization',
          link: 'https://community.threekit.com/learn/workflows/image-upload-personalization',
          icon: '📸'
        });
      }
      
      // Template Assets
      if (requirements.some(req => req.toLowerCase().includes('template') || req.toLowerCase().includes('preset'))) {
        recommendations.push({
          title: 'Template Assets',
          description: 'Use pre-built templates for faster setup',
          link: 'https://community.threekit.com/learn/workflows/template-assets',
          icon: '📋'
        });
      }
      
      // Camera Transition Animation
      if (requirements.some(req => req.toLowerCase().includes('animation') || req.toLowerCase().includes('camera'))) {
        recommendations.push({
          title: 'Camera Transition Animation',
          description: 'Set up smooth camera transitions',
          link: 'https://community.threekit.com/learn/workflows/camera-transition-animation',
          icon: '🎬'
        });
      }
      
      // Performance Guidelines (always include for webgl)
      if (targetPlatform === 'webgl') {
        recommendations.push({
          title: 'Performance Guidelines',
          description: 'Optimize for web performance',
          link: 'https://community.threekit.com/learn/workflows/best-practices/performance-guidelines',
          icon: '⚡'
        });
      }
      
      // Camera Setup for photorealistic
      if (configType === 'photorealistic' || renderEngine === 'V-Ray') {
        recommendations.push({
          title: 'Camera Set-up Best Practices',
          description: 'Professional camera setup for photorealistic renders',
          link: 'https://community.threekit.com/learn/workflows/best-practices/camera-set-up-best-practices',
          icon: '📷'
        });
      }
      
      // Shadows and AO for complex lighting
      if (config.textureSettings.lightingSetup === 'pbr-hdr' || config.textureSettings.lightingSetup === 'hdr-only') {
        recommendations.push({
          title: 'Shadows with AO & SSAO',
          description: 'Advanced shadow and ambient occlusion setup',
          link: 'https://community.threekit.com/learn/workflows/best-practices/usage-of-shadows-with-ao-ssao',
          icon: '🌑'
        });
      }
      
      if (recommendations.length === 0) {
        return '';
      }
      
      return `
        <div style="background: #f0f9ff; border: 1px solid #0ea5e9; border-radius: 8px; padding: 1rem; margin-top: 1rem;">
          <h4 style="margin: 0 0 0.5rem 0; color: #0c4a6e; display: flex; align-items: center;">
            <span style="margin-right: 0.5rem;">🎯</span>
            Recommended Workflows for Your Project
          </h4>
          <p style="margin: 0 0 1rem 0; color: #0369a1; font-size: 14px;">
            Based on your selections, here are the specific Threekit workflows you should follow:
          </p>
          <div class="workflow-grid">
            ${recommendations.map(rec => generateEmbeddedWorkflowContent(rec, config)).join('')}
          </div>
        </div>
      `;
    }

    function generateEmbeddedWorkflowContent(workflow, config) {
      const workflowContent = getWorkflowContent(workflow.title, config);
      
      return `
        <div style="background: white; border: 1px solid #e2e8f0; border-radius: 8px; padding: 1.5rem; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
          <div style="display: flex; align-items: center; margin-bottom: 1rem;">
            <div style="font-size: 24px; margin-right: 1rem;">${workflow.icon}</div>
            <div>
              <h3 style="margin: 0; color: #1f2937; font-size: 18px;">${workflow.title}</h3>
              <p style="margin: 0.25rem 0 0 0; color: #6b7280; font-size: 14px;">${workflow.description}</p>
            </div>
          </div>
          
          ${workflowContent}
          
          <div style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid #e5e7eb;">
            <a href="${workflow.link}" target="_blank" style="color: #0ea5e9; text-decoration: none; font-size: 14px; font-weight: 500; display: inline-flex; align-items: center;">
              📖 View Complete Guide on Community →
            </a>
          </div>
        </div>
      `;
    }

    function getWorkflowContent(workflowTitle, config) {
      const targetPlatform = config.knownInfo.targetPlatform;
      const software = config.knownInfo['3dSoftware'];
      const lightingSetup = config.textureSettings.lightingSetup;
      
      switch(workflowTitle) {
        case 'Basic Visualization Setup':
          return `
            <div style="background: #f8fafc; padding: 1rem; border-radius: 6px; margin-bottom: 1rem;">
              <h4 style="margin: 0 0 0.5rem 0; color: #374151; font-size: 16px;">🎮 Interactive 3D Setup</h4>
              <p style="margin: 0 0 1rem 0; color: #6b7280; font-size: 14px;">
                Set up your 3D model for interactive viewing in web browsers using WebGL technology.
              </p>
              
              <div style="display: grid; gap: 0.75rem;">
                <div style="display: flex; align-items: flex-start;">
                  <div style="background: #3b82f6; color: white; width: 20px; height: 20px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 0.75rem; font-size: 12px; font-weight: bold; flex-shrink: 0;">1</div>
                  <div>
                    <strong style="color: #1f2937; font-size: 14px;">Model Preparation</strong>
                    <p style="margin: 0.25rem 0 0 0; color: #6b7280; font-size: 13px;">
                      Ensure your 3D model is optimized for web viewing. Keep polygon count under ${config.setupGuide.exportSettings.polygonLimit.toLocaleString()} triangles per object.
                    </p>
                  </div>
                </div>
                
                <div style="display: flex; align-items: flex-start;">
                  <div style="background: #3b82f6; color: white; width: 20px; height: 20px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 0.75rem; font-size: 12px; font-weight: bold; flex-shrink: 0;">2</div>
                  <div>
                    <strong style="color: #1f2937; font-size: 14px;">Upload to Threekit</strong>
                    <p style="margin: 0.25rem 0 0 0; color: #6b7280; font-size: 13px;">
                      Upload your ${config.knownInfo['exportFormat']} file to <a href="https://preview.threekit.com" target="_blank" style="color: #3b82f6;">preview.threekit.com</a> for testing and configuration.
                    </p>
                  </div>
                </div>
                
                <div style="display: flex; align-items: flex-start;">
                  <div style="background: #3b82f6; color: white; width: 20px; height: 20px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 0.75rem; font-size: 12px; font-weight: bold; flex-shrink: 0;">3</div>
                  <div>
                    <strong style="color: #1f2937; font-size: 14px;">Configure Interactions</strong>
                    <p style="margin: 0.25rem 0 0 0; color: #6b7280; font-size: 13px;">
                      Set up rotation, zoom, and pan controls. Configure material switching and part visibility.
                    </p>
                  </div>
                </div>
                
                <div style="display: flex; align-items: flex-start;">
                  <div style="background: #3b82f6; color: white; width: 20px; height: 20px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 0.75rem; font-size: 12px; font-weight: bold; flex-shrink: 0;">4</div>
                  <div>
                    <strong style="color: #1f2937; font-size: 14px;">Embed in Website</strong>
                    <p style="margin: 0.25rem 0 0 0; color: #6b7280; font-size: 13px;">
                      Use the Threekit Player to embed your interactive 3D model into your website.
                    </p>
                  </div>
                </div>
              </div>
              
              <div style="background: #ecfdf5; padding: 0.75rem; border-radius: 6px; border-left: 3px solid #10b981; margin-top: 1rem;">
                <p style="margin: 0; font-size: 13px; color: #065f46;">
                  <strong>💡 Pro Tip:</strong> Test your model on different devices and browsers to ensure optimal performance across all platforms.
                </p>
              </div>
            </div>
          `;
          
        case 'Performance Guidelines':
          return `
            <div style="background: #fef3c7; padding: 1rem; border-radius: 6px; margin-bottom: 1rem;">
              <h4 style="margin: 0 0 0.5rem 0; color: #92400e; font-size: 16px;">⚡ Web Performance Optimization</h4>
              <p style="margin: 0 0 1rem 0; color: #a16207; font-size: 14px;">
                Optimize your 3D assets for fast loading and smooth interaction in web browsers.
              </p>
              
              <div style="background: #f0f9ff; padding: 0.75rem; border-radius: 6px; border-left: 3px solid #0ea5e9; margin-bottom: 1rem;">
                <p style="margin: 0; font-size: 13px; color: #0c4a6e;">
                  <strong>📚 Reference:</strong> Based on <a href="https://community.threekit.com/learn/workflows/best-practices/performance-guidelines" target="_blank" style="color: #0ea5e9; text-decoration: none;">Threekit's Performance Guidelines</a>
                </p>
              </div>
              
              <div style="display: grid; gap: 0.75rem;">
                <div style="background: white; padding: 0.75rem; border-radius: 6px; border-left: 3px solid #10b981;">
                  <strong style="color: #065f46; font-size: 14px;">Asset Optimization</strong>
                  <ul style="margin: 0.5rem 0 0 0; padding-left: 1.5rem; color: #047857; font-size: 13px;">
                    <li>Optimize models for web delivery</li>
                    <li>Use efficient topology and geometry</li>
                    <li>Test performance across different devices</li>
                    <li>Monitor loading times in Threekit platform</li>
                  </ul>
                </div>
                
                <div style="background: white; padding: 0.75rem; border-radius: 6px; border-left: 3px solid #8b5cf6;">
                  <strong style="color: #5b21b6; font-size: 14px;">Texture Best Practices</strong>
                  <ul style="margin: 0.5rem 0 0 0; padding-left: 1.5rem; color: #7c3aed; font-size: 13px;">
                    <li>Use appropriate texture resolutions for web</li>
                    <li>Optimize file formats (JPEG for non-alpha, PNG for alpha)</li>
                    <li>Compress textures for faster loading</li>
                    <li>Test on various screen densities</li>
                  </ul>
                </div>
                
                <div style="background: white; padding: 0.75rem; border-radius: 6px; border-left: 3px solid #f59e0b;">
                  <strong style="color: #92400e; font-size: 14px;">Web Performance</strong>
                  <ul style="margin: 0.5rem 0 0 0; padding-left: 1.5rem; color: #a16207; font-size: 13px;">
                    <li>Optimize for mobile and desktop browsers</li>
                    <li>Use efficient UV mapping (UV0 for diffuse, UV1 for AO)</li>
                    <li>Minimize material complexity</li>
                    <li>Test loading performance in Threekit</li>
                  </ul>
                </div>
              </div>
              
              <div style="background: #fef2f2; padding: 0.75rem; border-radius: 6px; border-left: 3px solid #ef4444; margin-top: 1rem;">
                <p style="margin: 0; font-size: 13px; color: #991b1b;">
                  <strong>⚠️ Important:</strong> Always test your assets in the Threekit platform to ensure optimal performance. Refer to the <a href="https://community.threekit.com/learn/workflows/best-practices/performance-guidelines" target="_blank" style="color: #dc2626; text-decoration: none;">official Performance Guidelines</a> for detailed specifications.
                </p>
              </div>
            </div>
          `;
          
        case 'Shadows with AO & SSAO':
          return `
            <div style="background: #f3e8ff; padding: 1rem; border-radius: 6px; margin-bottom: 1rem;">
              <h4 style="margin: 0 0 0.5rem 0; color: #7c3aed; font-size: 16px;">🌑 Advanced Shadow Setup</h4>
              <p style="margin: 0 0 1rem 0; color: #8b5cf6; font-size: 14px;">
                Set up realistic shadows and ambient occlusion for enhanced visual quality.
              </p>
              
              <div style="background: #f0f9ff; padding: 0.75rem; border-radius: 6px; border-left: 3px solid #0ea5e9; margin-bottom: 1rem;">
                <p style="margin: 0; font-size: 13px; color: #0c4a6e;">
                  <strong>📚 Reference:</strong> Based on <a href="https://community.threekit.com/learn/workflows/best-practices/usage-of-shadows-with-ao-ssao" target="_blank" style="color: #0ea5e9; text-decoration: none;">Threekit's Shadows with AO & SSAO Guide</a>
                </p>
              </div>
              
              <div style="display: grid; gap: 0.75rem;">
                <div style="background: white; padding: 0.75rem; border-radius: 6px; border-left: 3px solid #8b5cf6;">
                  <strong style="color: #7c3aed; font-size: 14px;">Ambient Occlusion (AO) Maps</strong>
                  <p style="margin: 0.5rem 0 0 0; color: #8b5cf6; font-size: 13px;">
                    Create AO maps to add realistic shadowing in crevices and contact areas. Use UV1 channel for AO maps in Threekit.
                  </p>
                  <div style="background: #f8fafc; padding: 0.5rem; border-radius: 4px; margin-top: 0.5rem; font-family: monospace; font-size: 12px; color: #6b7280;">
                    Naming: ProductName_AO_${config.textureSettings.resolution}.png
                  </div>
                </div>
                
                <div style="background: white; padding: 0.75rem; border-radius: 6px; border-left: 3px solid #8b5cf6;">
                  <strong style="color: #7c3aed; font-size: 14px;">Screen Space Ambient Occlusion (SSAO)</strong>
                  <p style="margin: 0.5rem 0 0 0; color: #8b5cf6; font-size: 13px;">
                    Enable SSAO in Threekit for real-time ambient occlusion effects. This adds depth and realism to your 3D scenes.
                  </p>
                </div>
                
              </div>
              
              <div style="background: #ecfdf5; padding: 0.75rem; border-radius: 6px; border-left: 3px solid #10b981; margin-top: 1rem;">
                <p style="margin: 0; font-size: 13px; color: #065f46;">
                  <strong>💡 Pro Tip:</strong> Combine AO maps with SSAO for the best visual quality. AO maps provide baked-in detail while SSAO adds real-time depth.
                </p>
              </div>
            </div>
          `;
          
        case 'Text Personalization':
          return `
            <div style="background: #f0fdf4; padding: 1rem; border-radius: 6px; margin-bottom: 1rem;">
              <h4 style="margin: 0 0 0.5rem 0; color: #166534; font-size: 16px;">✏️ Text Customization Setup</h4>
              <p style="margin: 0 0 1rem 0; color: #15803d; font-size: 14px;">
                Enable customers to add custom text, names, or messages to your products.
              </p>
              
              <div style="background: #f0f9ff; padding: 0.75rem; border-radius: 6px; border-left: 3px solid #0ea5e9; margin-bottom: 1rem;">
                <p style="margin: 0; font-size: 13px; color: #0c4a6e;">
                  <strong>📚 Reference:</strong> Based on <a href="https://community.threekit.com/learn/workflows/text-personalization" target="_blank" style="color: #0ea5e9; text-decoration: none;">Threekit's Text Personalization Workflow</a>
                </p>
              </div>
              
              <div style="display: grid; gap: 0.75rem;">
                <div style="background: white; padding: 0.75rem; border-radius: 6px; border-left: 3px solid #22c55e;">
                  <strong style="color: #166534; font-size: 14px;">Text Surface Preparation</strong>
                  <p style="margin: 0.5rem 0 0 0; color: #15803d; font-size: 13px;">
                    Create a flat surface on your 3D model where text will be applied. Ensure proper UV mapping for text placement.
                  </p>
                </div>
                
                <div style="background: white; padding: 0.75rem; border-radius: 6px; border-left: 3px solid #22c55e;">
                  <strong style="color: #166534; font-size: 14px;">Font Configuration</strong>
                  <ul style="margin: 0.5rem 0 0 0; padding-left: 1.5rem; color: #15803d; font-size: 13px;">
                    <li>Choose readable fonts for your brand</li>
                    <li>Set character limits based on surface size</li>
                    <li>Configure text positioning and alignment</li>
                    <li>Test with different text lengths</li>
                  </ul>
                </div>
                
                <div style="background: white; padding: 0.75rem; border-radius: 6px; border-left: 3px solid #22c55e;">
                  <strong style="color: #166534; font-size: 14px;">Material Setup</strong>
                  <p style="margin: 0.5rem 0 0 0; color: #15803d; font-size: 13px;">
                    Create a material that can accept text overlays. Use a base material with a text mask for realistic integration.
                  </p>
                </div>
              </div>
            </div>
          `;
          
        case 'Image Upload Personalization':
          return `
            <div style="background: #fef3c7; padding: 1rem; border-radius: 6px; margin-bottom: 1rem;">
              <h4 style="margin: 0 0 0.5rem 0; color: #92400e; font-size: 16px;">📸 Image Upload Setup</h4>
              <p style="margin: 0 0 1rem 0; color: #a16207; font-size: 14px;">
                Allow customers to upload and apply their own images to your products.
              </p>
              
              <div style="background: #f0f9ff; padding: 0.75rem; border-radius: 6px; border-left: 3px solid #0ea5e9; margin-bottom: 1rem;">
                <p style="margin: 0; font-size: 13px; color: #0c4a6e;">
                  <strong>📚 Reference:</strong> Based on <a href="https://community.threekit.com/learn/workflows/image-upload-personalization" target="_blank" style="color: #0ea5e9; text-decoration: none;">Threekit's Image Upload Personalization Workflow</a>
                </p>
              </div>
              
              <div style="display: grid; gap: 0.75rem;">
                <div style="background: white; padding: 0.75rem; border-radius: 6px; border-left: 3px solid #f59e0b;">
                  <strong style="color: #92400e; font-size: 14px;">Upload Surface Design</strong>
                  <p style="margin: 0.5rem 0 0 0; color: #a16207; font-size: 13px;">
                    Create designated areas on your 3D model where customers can upload images. Consider aspect ratios and sizing.
                  </p>
                </div>
                
                <div style="background: white; padding: 0.75rem; border-radius: 6px; border-left: 3px solid #f59e0b;">
                  <strong style="color: #92400e; font-size: 14px;">Image Processing</strong>
                  <ul style="margin: 0.5rem 0 0 0; padding-left: 1.5rem; color: #a16207; font-size: 13px;">
                    <li>Set maximum file size limits</li>
                    <li>Configure supported image formats (JPG, PNG)</li>
                    <li>Implement image resizing and cropping</li>
                    <li>Add image validation and filtering</li>
                  </ul>
                </div>
                
                <div style="background: white; padding: 0.75rem; border-radius: 6px; border-left: 3px solid #f59e0b;">
                  <strong style="color: #92400e; font-size: 14px;">Material Integration</strong>
                  <p style="margin: 0.5rem 0 0 0; color: #a16207; font-size: 13px;">
                    Set up materials that can dynamically accept uploaded images while maintaining realistic lighting and shading.
                  </p>
                </div>
              </div>
            </div>
          `;
          
        case 'Camera Set-up Best Practices':
          return `
            <div style="background: #f0f9ff; padding: 1rem; border-radius: 6px; margin-bottom: 1rem;">
              <h4 style="margin: 0 0 0.5rem 0; color: #1e40af; font-size: 16px;">📷 Professional Camera Setup</h4>
              <p style="margin: 0 0 1rem 0; color: #2563eb; font-size: 14px;">
                Configure cameras for optimal product presentation and photorealistic rendering.
              </p>
              
              <div style="background: #f0f9ff; padding: 0.75rem; border-radius: 6px; border-left: 3px solid #0ea5e9; margin-bottom: 1rem;">
                <p style="margin: 0; font-size: 13px; color: #0c4a6e;">
                  <strong>📚 Reference:</strong> Based on <a href="https://community.threekit.com/learn/workflows/best-practices/camera-set-up-best-practices" target="_blank" style="color: #0ea5e9; text-decoration: none;">Threekit's Camera Set-up Best Practices</a>
                </p>
              </div>
              
              <div style="display: grid; gap: 0.75rem;">
                <div style="background: white; padding: 0.75rem; border-radius: 6px; border-left: 3px solid #3b82f6;">
                  <strong style="color: #1e40af; font-size: 14px;">Camera Positioning</strong>
                  <ul style="margin: 0.5rem 0 0 0; padding-left: 1.5rem; color: #2563eb; font-size: 13px;">
                    <li>Position camera at eye level for natural viewing</li>
                    <li>Use rule of thirds for composition</li>
                    <li>Ensure product fills 70-80% of frame</li>
                    <li>Maintain consistent distance from subject</li>
                  </ul>
                </div>
                
                <div style="background: white; padding: 0.75rem; border-radius: 6px; border-left: 3px solid #3b82f6;">
                  <strong style="color: #1e40af; font-size: 14px;">Lighting Considerations</strong>
                  <p style="margin: 0.5rem 0 0 0; color: #2563eb; font-size: 13px;">
                    ${lightingSetup === 'pbr-hdr' ? 'Use HDR environment maps for realistic lighting and reflections.' : 
                      lightingSetup === 'hdr-only' ? 'Use HDR lighting for consistent illumination across all shots.' : 
                      'Set up consistent lighting that works well with your chosen approach.'}
                  </p>
                </div>
                
                <div style="background: white; padding: 0.75rem; border-radius: 6px; border-left: 3px solid #3b82f6;">
                  <strong style="color: #1e40af; font-size: 14px;">Multiple Angles</strong>
                  <ul style="margin: 0.5rem 0 0 0; padding-left: 1.5rem; color: #2563eb; font-size: 13px;">
                    <li>Front, side, and 3/4 views</li>
                    <li>Detail shots for important features</li>
                    <li>Context shots showing scale</li>
                    <li>Consistent lighting across all angles</li>
                  </ul>
                </div>
              </div>
            </div>
          `;
          
        default:
          return `
            <div style="background: #f8fafc; padding: 1rem; border-radius: 6px; margin-bottom: 1rem;">
              <p style="margin: 0; color: #6b7280; font-size: 14px;">
                Follow the specific workflow guidelines for ${workflowTitle} to ensure optimal results for your project.
              </p>
            </div>
          `;
      }
    }

    function generateTrainingRecommendations(config) {
      const selectedModules = config.trainingModules || [];
      
      const trainingModuleMap = {
        'basic-renders': {
          title: 'Basic Renders',
          description: 'Learn the fundamentals of creating renders in Threekit',
          link: 'https://community.threekit.com/learn/training/self-led-training/basic-renders',
          icon: '🎨',
          priority: 'high'
        },
        'catalog-setup': {
          title: 'Catalog Setup',
          description: 'Configure products and variants in your catalog',
          link: 'https://community.threekit.com/learn/training/self-led-training',
          icon: '📦',
          priority: 'high'
        },
        'pricing-configuration': {
          title: 'Adding Pricing',
          description: 'Configure dynamic pricing for your products',
          link: 'https://community.threekit.com/learn/training/self-led-training/adding-pricing',
          icon: '💰',
          priority: 'medium'
        },
        'rules-logic': {
          title: 'Rules & Logic',
          description: 'Set up conditional logic and rules for complex configurations',
          link: 'https://community.threekit.com/learn/training/self-led-training/rules',
          icon: '⚙️',
          priority: 'medium'
        },
        'data-tables': {
          title: 'Data Tables',
          description: 'Manage complex product data efficiently',
          link: 'https://community.threekit.com/learn/training/self-led-training/data-tables',
          icon: '📊',
          priority: 'medium'
        },
        'dimensions-annotations': {
          title: 'Dimensions & Annotations',
          description: 'Add measurement displays and interactive annotations',
          link: 'https://community.threekit.com/learn/training/self-led-training/dimension-annotations',
          icon: '📏',
          priority: 'low'
        },
        'stages-workflow': {
          title: 'Stages & Workflow',
          description: 'Organize your configuration workflow with stages',
          link: 'https://community.threekit.com/learn/training/self-led-training/stages',
          icon: '🔄',
          priority: 'low'
        },
        'metadata-management': {
          title: 'Metadata Management',
          description: 'Organize and manage product information',
          link: 'https://community.threekit.com/learn/training/self-led-training/metadata',
          icon: '📋',
          priority: 'low'
        },
        'proxy-materials': {
          title: 'Proxy Materials',
          description: 'Optimize material performance for better loading',
          link: 'https://community.threekit.com/learn/training/self-led-training/proxy-materials',
          icon: '⚡',
          priority: 'low'
        },
        'image-annotations': {
          title: 'Image Annotations',
          description: 'Add interactive image overlays and hotspots',
          link: 'https://community.threekit.com/learn/training/self-led-training/image-annotations',
          icon: '🖼️',
          priority: 'low'
        }
      };
      
      // Convert selected modules to training recommendations
      const trainingModules = selectedModules.map(moduleKey => {
        const module = trainingModuleMap[moduleKey];
        return module ? {
          ...module,
          selected: true
        } : null;
      }).filter(module => module !== null);
      
      if (trainingModules.length === 0) {
        return '';
      }
      
      // Sort by priority (high, medium, low)
      const priorityOrder = { 'high': 0, 'medium': 1, 'low': 2 };
      trainingModules.sort((a, b) => priorityOrder[a.priority] - priorityOrder[b.priority]);
      
      return `
        <div style="background: #f0fdf4; border: 1px solid #22c55e; border-radius: 8px; padding: 1rem; margin-top: 1rem;">
          <h4 style="margin: 0 0 0.5rem 0; color: #166534; display: flex; align-items: center;">
            <span style="margin-right: 0.5rem;">🎓</span>
            Selected Training Modules
          </h4>
          <p style="margin: 0 0 1rem 0; color: #15803d; font-size: 14px;">
            Based on your selections, these training modules will help you get the most out of Threekit:
          </p>
          <div class="workflow-grid">
            ${trainingModules.map((module, index) => `
              <div style="display: flex; align-items: center; padding: 0.75rem; background: white; border-radius: 6px; border-left: 3px solid #22c55e;">
                <div style="font-size: 20px; margin-right: 0.75rem;">${module.icon}</div>
                <div style="flex: 1;">
                  <div style="display: flex; align-items: center; gap: 0.5rem;">
                    <strong style="color: #166534; font-size: 14px;">${module.title}</strong>
                    <span style="background: ${module.priority === 'high' ? '#dc2626' : module.priority === 'medium' ? '#d97706' : '#6b7280'}; color: white; padding: 0.125rem 0.375rem; border-radius: 4px; font-size: 10px; font-weight: 500; text-transform: uppercase;">
                      ${module.priority}
                    </span>
                  </div>
                  <p style="margin: 0.25rem 0 0 0; color: #64748b; font-size: 13px;">${module.description}</p>
                </div>
                <a href="${module.link}" target="_blank" style="color: #22c55e; text-decoration: none; font-size: 12px; font-weight: 500;">
                  Start Training →
                </a>
              </div>
            `).join('')}
          </div>
          <div style="margin-top: 1rem; padding: 0.75rem; background: #ecfdf5; border-radius: 6px; border-left: 3px solid #10b981;">
            <p style="margin: 0; font-size: 13px; color: #065f46;">
              <strong>💡 Pro Tip:</strong> Start with high-priority modules and work your way through based on your project timeline. 
              <a href="https://community.threekit.com/learn/training/guided-training/training-outline" target="_blank" style="color: #059669; text-decoration: underline;">View complete training outline</a>
            </p>
          </div>
        </div>
      `;
    }

    function generateGuideContent(config) {
      console.log('🔍 generateGuideContent called with config:', config);
      
      const software = config.knownInfo['3dSoftware'];
      const exportFormat = config.knownInfo['exportFormat'];
      const organization = config.knownInfo['assetOrganization'];
      const materials = config.knownInfo['materialApproach'];
      const polygonLimit = config.setupGuide.exportSettings.polygonLimit;
      const textureSettings = config.textureSettings;
      const textureRequirements = textureSettings.requirements;
      const textureFormat = textureSettings.format;
      const textureResolution = textureSettings.resolution;
      const uvMapping = textureSettings.uvMapping;
      const lightingSetup = textureSettings.lightingSetup;
      
      console.log('📊 Extracted data:', {
        software,
        exportFormat,
        organization,
        materials,
        polygonLimit,
        textureRequirements,
        textureFormat,
        textureResolution,
        uvMapping,
        lightingSetup
      });

      // Generate texture format recommendations
      let textureFormatDetails = '';
      if (textureFormat === 'PNG') {
        textureFormatDetails = 'Use PNG format for all textures to preserve alpha channels and quality.';
      } else if (textureFormat === 'JPEG') {
        textureFormatDetails = 'Use JPEG format for smaller file sizes. Avoid for textures with transparency.';
      } else if (textureFormat === 'Mixed') {
        textureFormatDetails = 'Use PNG for textures with alpha channels (transparency), JPEG for standard textures.';
      }

      // Generate UV mapping instructions
      let uvMappingInstructions = '';
      if (uvMapping === 'uv0-uv1') {
        uvMappingInstructions = 'Set up UV0 for diffuse textures and UV1 for Ambient Occlusion (AO) maps. This is the recommended approach for Threekit.';
      } else if (uvMapping === 'uv0-uv1-uv2') {
        uvMappingInstructions = 'Use UV0 for diffuse, UV1 for AO maps, and UV2 for additional texture channels.';
      } else {
        uvMappingInstructions = 'Use UV0 for all texture mapping. Consider UV1 for AO maps if needed.';
      }

      return `
        <div class="info-box success">
          <h2 style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
            <img src="https://www.threekit.com/hubfs/Logos%20and%20Trademarks/threekit_logo_black.svg" alt="Threekit" style="height: 32px; width: auto;" />
            <span>Tech Spec</span>
          </h2>
          <p><strong>Company:</strong> ${config.clientName}</p>
          <p><strong>Project:</strong> ${config.setupGuide.focus}</p>
          <p><strong>3D Software:</strong> ${software}</p>
          <p><strong>Export Format:</strong> ${exportFormat}</p>
          <p><strong>Target Platform:</strong> ${config.knownInfo.targetPlatform}</p>
        </div>

        <div class="info-box success" style="background: linear-gradient(135deg, #2D3748, #4A5568); color: #E2E8F0; border: 2px solid #00D4AA; margin-bottom: 2rem;">
          <div style="display: flex; align-items: center; margin-bottom: 1rem;">
            <div style="width: 80px; height: 80px; background: rgba(0,212,170,0.2); border-radius: 12px; display: flex; align-items: center; justify-content: center; margin-right: 1.5rem; border: 2px solid #00D4AA;">
              <div style="font-size: 32px;">🎯</div>
            </div>
            <div>
              <h2 style="margin: 0; color: #F7FAFC; font-size: 28px; font-weight: 700;">Your Customized 3D Setup Guide</h2>
              <p style="margin: 0.5rem 0 0 0; color: #E2E8F0; font-size: 16px;">Based on your project requirements, here's your personalized guide for setting up 3D assets for Threekit.</p>
            </div>
          </div>
          <div style="background: rgba(0,212,170,0.1); padding: 1rem; border-radius: 8px; margin-top: 1rem; border: 1px solid rgba(0,212,170,0.3);">
            <p style="margin: 0; font-size: 14px; color: #E2E8F0;">
              <strong style="color: #00D4AA;">📋 Project:</strong> ${config.projectDescription || '3D Configuration Project'} | 
              <strong style="color: #00D4AA;">🛠️ Software:</strong> ${software} | 
              <strong style="color: #00D4AA;">📤 Export:</strong> ${exportFormat}
            </p>
            <p style="margin: 0.5rem 0 0 0; font-size: 12px; color: #CBD5E0;">
              📚 <strong style="color: #00D4AA;">Reference:</strong> <a href="https://community.threekit.com/learn/platform-overview" target="_blank" style="color: #FFD700; text-decoration: underline;">Threekit Community Platform Overview</a>
            </p>
          </div>
        </div>

        <div class="info-box info">
          <h3>📋 Project Overview</h3>
          <ul>
            <li><strong>Asset Organization:</strong> ${organization}</li>
            <li><strong>Material Strategy:</strong> ${materials}</li>
            <li><strong>Polygon Limit:</strong> ${polygonLimit.toLocaleString()} triangles per object</li>
            <li><strong>Lighting Approach:</strong> ${lightingSetup}</li>
            <li><strong>Naming Convention:</strong> ${config.setupGuide.materialGuidance.namingConvention}</li>
          </ul>
          
          ${generateWorkflowRecommendations(config)}
          ${generateTrainingRecommendations(config)}
        </div>
        
        ${getScreenshotsHTML()}

        <div class="info-box success">
          <h3>🔗 Part Reference Node Setup</h3>
          <p><strong>Important:</strong> Since you're using "${organization}", each configurable part must be modeled separately and positioned using part reference nodes in Threekit.</p>
          
          <div style="margin: 1rem 0;">
            <h4>📐 3D Software Setup (${software})</h4>
            <ol style="margin: 0.5rem 0; padding-left: 1.5rem;">
              <li><strong>Model each part separately:</strong> Weight Sets, Benches, Accessories, etc. as individual objects</li>
              <li><strong>Create positioning nulls:</strong> Add empty/null objects at the exact position where each part should be placed</li>
              <li><strong>Name nulls clearly:</strong> Use descriptive names like "WeightSet_Position", "Bench_Position", "Accessory_Position"</li>
              <li><strong>Parent parts to nulls:</strong> Make each part a child of its corresponding positioning null</li>
              <li><strong>Export with hierarchy:</strong> Ensure the null-parented structure is maintained in your ${exportFormat} export</li>
            </ol>
          </div>
          
          <div style="background: rgba(0,212,170,0.1); padding: 1rem; border-radius: 8px; margin: 1rem 0; border: 1px solid rgba(0,212,170,0.3);">
            <h4>🎯 Threekit Configuration</h4>
            <ol style="margin: 0.5rem 0; padding-left: 1.5rem;">
              <li><strong>Import your models:</strong> Upload each part as a separate asset in Threekit</li>
              <li><strong>Create Part Reference Nodes:</strong> In the Threekit scene, add Part Reference Nodes for each configurable part</li>
              <li><strong>Link to positioning nulls:</strong> Connect each Part Reference Node to the corresponding null object from your 3D software</li>
              <li><strong>Set up rules and attributes:</strong> Create attributes (size, color, material) that control which asset variant is displayed</li>
              <li><strong>Configure switching logic:</strong> Use Threekit's rules system to switch between different asset variants based on user selections</li>
            </ol>
          </div>
          
          <div style="background: #fef3c7; padding: 1rem; border-radius: 8px; margin: 1rem 0; border-left: 4px solid #f59e0b;">
            <p style="margin: 0; color: #92400e;"><strong>💡 Pro Tip:</strong> This approach allows you to easily swap out different variants (e.g., different weight stack sizes, bench styles) by simply changing which asset is linked to the Part Reference Node, without repositioning anything in the scene.</p>
          </div>
        </div>

        <div class="info-box info">
          <h3>🎯 Required Features</h3>
          <div class="features-grid" style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin-top: 1rem;">
            <style>
              @media (max-width: 768px) {
                .features-grid {
                  grid-template-columns: 1fr !important;
                  gap: 1rem !important;
                }
              }
            </style>
            <div>
              <h4 style="color: #00D4AA; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                🎨 3D Asset Requirements
              </h4>
              <ul style="margin: 0; padding-left: 1.5rem;">
                ${categorizeFeatures(config.setupGuide.keyRequirements).threeD.map(req => `<li>${req}</li>`).join('')}
              </ul>
            </div>
            <div>
              <h4 style="color: #667EEA; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                🌐 Frontend & Integration
              </h4>
              <ul style="margin: 0; padding-left: 1.5rem;">
                ${categorizeFeatures(config.setupGuide.keyRequirements).frontend.map(req => `<li>${req}</li>`).join('')}
              </ul>
            </div>
          </div>
        </div>

        <div class="info-box info">
          <h3>📤 Export Configuration for ${software}</h3>
          <div class="code">
            <strong>Export Settings:</strong><br>
            File → Export → ${exportFormat}<br>
            • Units: Centimeters<br>
            • Scale Factor: 1.0<br>
            • Materials: ✓<br>
            • Textures: ✓<br>
            • Animation: ✗ (unless needed)<br>
            • Cameras: ✗<br>
            • Lights: ✗<br>
            • Polygon Limit: ${polygonLimit.toLocaleString()} per object
          </div>
          <p><strong>Why ${exportFormat}?</strong> ${exportFormat === 'FBX' ? 'FBX provides the best compatibility with Threekit and supports all material types and animations.' : exportFormat === 'GLB/GLTF' ? 'GLB/GLTF is optimized for web delivery and provides good compression.' : 'USDZ is specifically designed for iOS AR experiences.'}</p>
        </div>

        <div class="info-box info">
          <h3>🎨 Texture Requirements & Setup</h3>
          <h4>Required Texture Maps:</h4>
          <ul>
            ${textureRequirements.map(req => `<li>${req}</li>`).join('')}
          </ul>
          
          <h4>Texture Format & Resolution:</h4>
          <ul>
            <li><strong>Format:</strong> ${textureFormatDetails}</li>
            <li><strong>Resolution:</strong> ${textureResolution}x${textureResolution} pixels</li>
            <li><strong>UV Mapping:</strong> ${uvMappingInstructions}</li>
          </ul>

          <h4>📝 Threekit Naming Conventions</h4>
          <p style="margin: 0 0 1rem 0; color: #6b7280; font-size: 14px;">
            Follow these official Threekit naming conventions for optimal platform compatibility:
          </p>
          
          <div class="naming-convention-grid">
            <div style="background: white; padding: 1rem; border-radius: 6px; border-left: 3px solid #3b82f6;">
              <h5 style="margin: 0 0 0.5rem 0; color: #1e40af; font-size: 14px;">🏷️ Asset Names (Files)</h5>
              <p style="margin: 0 0 0.5rem 0; color: #6b7280; font-size: 13px;">
                Use capitalization for first letter, separate elements with underscores '_'
              </p>
              <div style="background: #f8fafc; padding: 0.75rem; border-radius: 4px; font-family: monospace; font-size: 12px; color: #374151;">
                <strong>Model:</strong> ${config.setupGuide.materialGuidance.namingConvention}_MODEL.fbx<br>
                <strong>Material:</strong> ${config.setupGuide.materialGuidance.namingConvention}_MAT<br>
                <strong>Scene:</strong> ${config.setupGuide.materialGuidance.namingConvention}_SCENE<br>
                <strong>Lights:</strong> ${config.setupGuide.materialGuidance.namingConvention}_LIGHTS<br>
                <strong>Textures:</strong><br>
                • ${config.setupGuide.materialGuidance.namingConvention}_diffuse.${textureFormat === 'PNG' ? 'png' : 'jpg'}<br>
                • ${config.setupGuide.materialGuidance.namingConvention}_normal.${textureFormat === 'PNG' ? 'png' : 'jpg'}<br>
                • ${config.setupGuide.materialGuidance.namingConvention}_roughness.${textureFormat === 'PNG' ? 'png' : 'jpg'}<br>
                • ${config.setupGuide.materialGuidance.namingConvention}_AO.${textureFormat === 'PNG' ? 'png' : 'jpg'}
              </div>
            </div>
            
            <div style="background: white; padding: 1rem; border-radius: 6px; border-left: 3px solid #10b981;">
              <h5 style="margin: 0 0 0.5rem 0; color: #166534; font-size: 14px;">🔗 Node Names (3D Scene)</h5>
              <p style="margin: 0 0 0.5rem 0; color: #6b7280; font-size: 13px;">
                Use descriptive suffixes for different node types
              </p>
              <div style="background: #f0fdf4; padding: 0.75rem; border-radius: 4px; font-family: monospace; font-size: 12px; color: #374151;">
                <strong>Groups:</strong> ${config.setupGuide.materialGuidance.namingConvention}_GRP<br>
                <strong>Meshes:</strong> ${config.setupGuide.materialGuidance.namingConvention}_PartName<br>
                <strong>Curves:</strong> ${config.setupGuide.materialGuidance.namingConvention}_PartName_CRV<br>
                <strong>Joints:</strong> ${config.setupGuide.materialGuidance.namingConvention}_PartName_JNT<br>
                <strong>Lights:</strong> ${config.setupGuide.materialGuidance.namingConvention}_LIGHT<br>
                <strong>Cameras:</strong> ${config.setupGuide.materialGuidance.namingConvention}_CAM
              </div>
            </div>
            
            <div style="background: white; padding: 1rem; border-radius: 6px; border-left: 3px solid #f59e0b;">
              <h5 style="margin: 0 0 0.5rem 0; color: #92400e; font-size: 14px;">📦 Catalog Items</h5>
              <p style="margin: 0 0 0.5rem 0; color: #6b7280; font-size: 13px;">
                Match client naming system, avoid special characters in asset references
              </p>
              <div style="background: #fef3c7; padding: 0.75rem; border-radius: 4px; font-family: monospace; font-size: 12px; color: #374151;">
                <strong>Product:</strong> ${config.setupGuide.materialGuidance.namingConvention}<br>
                <strong>Configurator:</strong> ${config.setupGuide.materialGuidance.namingConvention}_Configurator
              </div>
            </div>
            
            <div style="background: white; padding: 1rem; border-radius: 6px; border-left: 3px solid #8b5cf6;">
              <h5 style="margin: 0 0 0.5rem 0; color: #7c3aed; font-size: 14px;">⚙️ Rules & Attributes</h5>
              <p style="margin: 0 0 0.5rem 0; color: #6b7280; font-size: 13px;">
                Use descriptive names that clearly identify purpose and usage
              </p>
              <div style="background: #f3e8ff; padding: 0.75rem; border-radius: 4px; font-family: monospace; font-size: 12px; color: #374151;">
                <strong>Attributes:</strong> Material, WoodChoice, Color, Size<br>
                <strong>Rules:</strong> Apply Material, Load Part for Option_ON, Apply Color Blue
              </div>
            </div>
          </div>
          
          <div style="background: #ecfdf5; padding: 0.75rem; border-radius: 6px; border-left: 3px solid #10b981; margin-top: 1rem;">
            <p style="margin: 0; font-size: 13px; color: #065f46;">
              <strong>💡 Pro Tip:</strong> Keep asset names consistent between files and platform assets for automatic updates when files are replaced.
            </p>
          </div>
          
          <div style="background: #e8f4fd; padding: 1rem; border-radius: 8px; margin-top: 1rem; border-left: 4px solid #2563eb;">
            <p style="margin: 0; font-size: 14px;"><strong>📚 Learn More:</strong> 
              <a href="https://community.threekit.com/learn/workflows/best-practices/3d-asset-naming-conventions" target="_blank">Official 3D Asset Naming Conventions</a> | 
              <a href="https://community.threekit.com/learn/workflows/best-practices/general-3d-content-creation" target="_blank">General 3D Content Creation</a>
            </p>
          </div>
        </div>

        <div class="info-box info">
          <h3>🔧 Software-Specific Setup Instructions</h3>
          ${generateSoftwareSpecificInstructions(software, exportFormat, textureSettings)}
          
          <div style="margin-top: 1.5rem; padding: 1rem; background: #f0f9ff; border-radius: 8px; border-left: 4px solid #0ea5e9;">
            <h4>📚 Additional Resources</h4>
            <p>For detailed step-by-step guides and advanced techniques, visit the <a href="https://developer.threekit.com/" target="_blank" style="color: #0ea5e9; font-weight: 600;">Threekit Developer Documentation</a>:</p>
            <ul style="margin: 0.5rem 0; padding-left: 1.5rem;">
              <li><a href="https://developer.threekit.com/docs/getting-started" target="_blank" style="color: #0ea5e9;">Getting Started Guide</a></li>
              <li><a href="https://developer.threekit.com/docs/materials-and-textures" target="_blank" style="color: #0ea5e9;">Materials and Textures</a></li>
              <li><a href="https://developer.threekit.com/docs/3d-asset-requirements" target="_blank" style="color: #0ea5e9;">3D Asset Requirements</a></li>
              <li><a href="https://developer.threekit.com/docs/exporting-from-3d-software" target="_blank" style="color: #0ea5e9;">Exporting from 3D Software</a></li>
            </ul>
          </div>
        </div>

        <div class="info-box info" style="background: linear-gradient(135deg, #667EEA, #764BA2); color: white; border: none;">
          <div style="display: flex; align-items: center; margin-bottom: 1rem;">
            <div style="width: 60px; height: 60px; background: rgba(255,255,255,0.2); border-radius: 12px; display: flex; align-items: center; justify-content: center; margin-right: 1rem;">
              <div style="font-size: 24px;">🌐</div>
            </div>
            <div>
              <h3 style="margin: 0; color: white;">Threekit Integration</h3>
              <p style="margin: 0.25rem 0 0 0; color: rgba(255,255,255,0.9);">Once your 3D model is ready, follow these steps to integrate with Threekit</p>
            </div>
          </div>
          
          <div style="background: rgba(255,255,255,0.1); border-radius: 8px; padding: 1.5rem;">
            <div style="display: grid; gap: 1.5rem;">
              <!-- Step 1: Upload -->
              <div style="display: flex; align-items: flex-start;">
                <div style="background: rgba(255,255,255,0.3); color: white; width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 1rem; font-size: 16px; font-weight: bold; flex-shrink: 0;">1</div>
                <div>
                  <strong style="color: white; font-size: 16px;">Upload Your 3D Model</strong>
                  <p style="margin: 0.5rem 0; color: rgba(255,255,255,0.9); font-size: 14px;">
                    Go to <a href="https://preview.threekit.com" target="_blank" style="color: #FFD700; text-decoration: underline;">preview.threekit.com</a> and upload your ${exportFormat} file. 
                    The model will be automatically processed and optimized for web delivery.
                  </p>
                </div>
              </div>
              
              <!-- Step 2: Material Creation -->
              <div style="display: flex; align-items: flex-start;">
                <div style="background: rgba(255,255,255,0.3); color: white; width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 1rem; font-size: 16px; font-weight: bold; flex-shrink: 0;">2</div>
                <div>
                  <strong style="color: white; font-size: 16px;">Create Materials in Threekit</strong>
                  <div style="margin: 0.5rem 0; color: rgba(255,255,255,0.9); font-size: 14px;">
                    <p style="margin: 0.5rem 0;"><strong>Creating a New Material:</strong></p>
                    <ol style="margin: 0.5rem 0; padding-left: 1.5rem;">
                      <li>In the Threekit platform, go to <strong>Materials</strong> section</li>
                      <li>Click <strong>"Create New Material"</strong></li>
                      <li>Name your material: <code style="background: rgba(0,0,0,0.3); padding: 0.2rem 0.4rem; border-radius: 3px;">${config.namingConvention || 'ProductType_PartName'}_MAT</code></li>
                      <li>Upload your texture files (Diffuse, Normal, AO, etc.)</li>
                      <li>Configure material properties (Roughness, Metallic, etc.)</li>
                    </ol>
                    
                    <p style="margin: 0.5rem 0;"><strong>Applying Material to 3D Mesh:</strong></p>
                    <ol style="margin: 0.5rem 0; padding-left: 1.5rem;">
                      <li>Select your 3D model in the scene</li>
                      <li>In the <strong>Properties</strong> panel, find the material slot</li>
                      <li>Drag and drop your created material onto the material slot</li>
                      <li>Adjust UV mapping if needed (UV0 for diffuse, UV1 for AO)</li>
                    </ol>
                  </div>
                </div>
              </div>
              
              <!-- Step 3: Threekit Operators -->
              <div style="display: flex; align-items: flex-start;">
                <div style="background: rgba(255,255,255,0.3); color: white; width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 1rem; font-size: 16px; font-weight: bold; flex-shrink: 0;">3</div>
                <div>
                  <strong style="color: white; font-size: 16px;">Set Up Threekit Operators (Scalable Approach)</strong>
                  <div style="margin: 0.5rem 0; color: rgba(255,255,255,0.9); font-size: 14px;">
                    <p style="margin: 0.5rem 0;"><strong>Why Use Operators?</strong> Think like game development - reuse textures across multiple materials for better performance and easier management.</p>
                    
                    <div style="background: rgba(0,0,0,0.2); border-radius: 6px; padding: 1rem; margin: 0.5rem 0;">
                      <p style="margin: 0 0 0.5rem 0; color: #FFD700;"><strong>🎯 AO Operator Setup:</strong></p>
                      <ol style="margin: 0; padding-left: 1.5rem;">
                        <li>Create an <strong>AO Operator</strong> in the platform</li>
                        <li>Upload your AO map texture once</li>
                        <li>Apply this operator to multiple materials</li>
                        <li>Each material can have different AO intensity settings</li>
                      </ol>
                    </div>
                    
                    <div style="background: rgba(0,0,0,0.2); border-radius: 6px; padding: 1rem; margin: 0.5rem 0;">
                      <p style="margin: 0 0 0.5rem 0; color: #FFD700;"><strong>🎯 Material Strategy for Scalability:</strong></p>
                      <ul style="margin: 0; padding-left: 1.5rem;">
                        <li>Create <strong>separate materials</strong> for each finish type (wood, metal, fabric, leather)</li>
                        <li>Each material should have its own <strong>complete texture set</strong> (diffuse, normal, roughness, metallic)</li>
                        <li>Use <strong>material variations</strong> for different colors/patterns of the same finish</li>
                        <li>Apply <strong>AO operators</strong> to meshes for consistent shadowing across all materials</li>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>
              
              <!-- Step 4: Configuration Setup -->
              <div style="display: flex; align-items: flex-start;">
                <div style="background: rgba(255,255,255,0.3); color: white; width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 1rem; font-size: 16px; font-weight: bold; flex-shrink: 0;">4</div>
                <div>
                  <strong style="color: white; font-size: 16px;">Configure Product Attributes</strong>
                  <div style="margin: 0.5rem 0; color: rgba(255,255,255,0.9); font-size: 14px;">
                    ${config.configurator === 'threekit-team' ? `
                      <p style="margin: 0.5rem 0;"><strong>Threekit Team Configuration:</strong> Our team will handle the platform setup, so focus on:</p>
                      <ul style="margin: 0.5rem 0; padding-left: 1.5rem;">
                        <li>Ensuring your 3D model has proper naming conventions</li>
                        <li>Separating configurable parts as individual objects</li>
                        <li>Providing clear material specifications</li>
                        <li>Testing the model loads correctly in Threekit</li>
                      </ul>
                    ` : config.configurator === 'customer-team' ? `
                      <p style="margin: 0.5rem 0;"><strong>Customer Team Configuration:</strong> You'll configure the platform, so you'll need to:</p>
                      <ol style="margin: 0.5rem 0; padding-left: 1.5rem;">
                        <li>Create <strong>catalog items</strong> with proper naming: <code style="background: rgba(0,0,0,0.3); padding: 0.2rem 0.4rem; border-radius: 3px;">ProductName_VariantName</code></li>
                        <li>Set up <strong>attributes</strong> for each configurable option (color, size, material)</li>
                        <li>Create <strong>rules</strong> to control which combinations are valid</li>
                        <li>Configure <strong>stages</strong> to organize the configuration workflow</li>
                        <li>Test all configuration combinations work correctly</li>
                      </ol>
                    ` : `
                      <p style="margin: 0.5rem 0;"><strong>Collaborative Configuration:</strong> We'll work together on:</p>
                      <ul style="margin: 0.5rem 0; padding-left: 1.5rem;">
                        <li>Initial platform setup and catalog structure</li>
                        <li>Training your team on Threekit platform features</li>
                        <li>Hands-on configuration sessions</li>
                        <li>Ongoing support and best practices</li>
                      </ul>
                    `}
                  </div>
                </div>
              </div>
              
              <!-- Step 5: Testing & Integration -->
              <div style="display: flex; align-items: flex-start;">
                <div style="background: rgba(255,255,255,0.3); color: white; width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 1rem; font-size: 16px; font-weight: bold; flex-shrink: 0;">5</div>
                <div>
                  <strong style="color: white; font-size: 16px;">Test & Embed</strong>
                  <div style="margin: 0.5rem 0; color: rgba(255,255,255,0.9); font-size: 14px;">
                    <p style="margin: 0.5rem 0;">Test all configuration options work correctly, then embed using the <a href="https://developer.threekit.com/docs/embedding-a-threekit-player" target="_blank" style="color: #FFD700; text-decoration: underline;">Threekit Player</a> for web integration.</p>
                  </div>
                </div>
              </div>
            </div>
            
            <div style="background: rgba(255,255,255,0.15); border-radius: 8px; padding: 1rem; margin-top: 1rem;">
              <h4 style="margin: 0 0 0.5rem 0; color: white; font-size: 16px;">📚 Additional Resources</h4>
              <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem; font-size: 14px;">
                <div>
                  <strong style="color: #FFD700;">Platform Overview:</strong><br>
                  <a href="https://community.threekit.com/learn/platform-overview" target="_blank" style="color: #FFD700; text-decoration: underline;">Virtual Photography, Interactive 3D & AR</a>
                </div>
                <div>
                  <strong style="color: #FFD700;">Best Practices:</strong><br>
                  <a href="https://community.threekit.com/learn/workflows/best-practices/general-3d-content-creation" target="_blank" style="color: #FFD700; text-decoration: underline;">3D Content Creation</a>
                </div>
                <div>
                  <strong style="color: #FFD700;">Performance:</strong><br>
                  <a href="https://community.threekit.com/learn/workflows/best-practices/performance-guidelines" target="_blank" style="color: #FFD700; text-decoration: underline;">Performance Guidelines</a>
                </div>
                <div>
                  <strong style="color: #FFD700;">Camera Setup:</strong><br>
                  <a href="https://community.threekit.com/learn/workflows/best-practices/camera-set-up-best-practices" target="_blank" style="color: #FFD700; text-decoration: underline;">Camera Best Practices</a>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="info-box info">
          <h4>💡 Lighting & Performance Guidelines</h4>
          <p><strong>Your Selected Approach:</strong> ${getLightingDisplayName(lightingSetup)}</p>
          <ul>
            ${getLightingDetails(lightingSetup)}
          </ul>
        </div>

        <div class="info-box warning">
          <h4>⚠️ Critical Quality Guidelines</h4>
          <ul>
            <li>Keep polygon count under ${polygonLimit.toLocaleString()} triangles per object for optimal performance</li>
            <li>Ensure all objects are properly centered at origin (0,0,0)</li>
            <li>Use consistent naming: ${config.setupGuide.materialGuidance.namingConvention}</li>
            <li>Test your export in <a href="https://preview.threekit.com" target="_blank">Threekit Preview</a> before finalizing</li>
            <li>Optimize textures for web delivery (compress without losing quality)</li>
            <li>Ensure proper UV unwrapping for all objects</li>
          </ul>
        </div>

        <div class="info-box success">
          <h4>🚀 Next Steps & Resources</h4>
          <ol>
            <li>Prepare your 3D model in ${software} following the guidelines above</li>
            <li>Export as ${exportFormat} with the specified settings</li>
            <li>Upload to <a href="https://preview.threekit.com" target="_blank">Threekit Preview</a> to test</li>
            <li>Configure materials and test all functionality</li>
            <li>Integrate with your website using <a href="https://developer.threekit.com/docs/embedding-a-threekit-player" target="_blank">Threekit Player</a></li>
            <li>For advanced features, refer to the <a href="https://developer.threekit.com/" target="_blank">Threekit Developer Documentation</a></li>
          </ol>
        </div>

        <div class="info-box info">
          <h4>📚 Additional Resources</h4>
          <ul>
            <li><a href="https://developer.threekit.com/docs/getting-started" target="_blank">Getting Started with Threekit</a></li>
            <li><a href="https://developer.threekit.com/docs/3d-asset-requirements" target="_blank">3D Asset Requirements</a></li>
            <li><a href="https://developer.threekit.com/docs/materials-and-textures" target="_blank">Materials and Textures Guide</a></li>
            <li><a href="https://developer.threekit.com/reference/player-api" target="_blank">Player API Reference</a></li>
            <li><a href="https://developer.threekit.com/reference/rest-api" target="_blank">REST API Reference</a></li>
          </ul>
        </div>

        ${config.setupGuide.specialInstructions ? `
          <div class="info-box info">
            <h4>💡 Project-Specific Notes</h4>
            <p>${config.setupGuide.specialInstructions}</p>
          </div>
        ` : ''}
      `;
    }

    function generateSoftwareSpecificInstructions(software, exportFormat, textureSettings) {
      const softwareLower = software.toLowerCase().replace(' ', '-').replace('autodesk-', '');
      const textureFormat = textureSettings.format;
      const textureResolution = textureSettings.resolution;
      const uvMapping = textureSettings.uvMapping;
      const lightingSetup = textureSettings.lightingSetup;

      function getLightingGuidance(lightingSetup) {
        const lightingOptions = {
          'pbr-hdr': 'Use PBR materials with HDR environment maps for realistic lighting and material accuracy (Recommended)',
          'hdr-only': 'Use HDR environment maps for lighting without full PBR workflow',
          'threekit-scene': 'Use Threekit scene lighting (only recommended for simple assets due to performance considerations)',
          'pbr': 'Use PBR (Physically Based Rendering) materials with standard lighting',
          'traditional': 'Use traditional diffuse + specular materials with standard lighting',
          'mixed': 'Use a combination of PBR and traditional materials based on asset complexity'
        };
        return lightingOptions[lightingSetup] || 'Use standard lighting setup';
      }

      const instructions = {
        '3ds-max': `
          <div style="display: flex; align-items: center; margin-bottom: 1rem; padding: 1rem; background: #f8fafc; border-radius: 8px; border-left: 4px solid #00D4AA;">
            <div style="margin-right: 1rem;">
              <div style="width: 60px; height: 60px; background: linear-gradient(135deg, #2D3748, #4A5568); border: 2px solid #00D4AA; border-radius: 8px; display: flex; align-items: center; justify-content: center; color: #00D4AA; font-weight: bold; font-size: 18px;">3D</div>
            </div>
            <div>
              <h4 style="margin: 0; color: #2D3748;">Autodesk 3ds Max Setup</h4>
              <p style="margin: 0.25rem 0 0 0; color: #6b7280; font-size: 14px;">Professional 3D modeling and animation software</p>
            </div>
          </div>
          
          <div style="background: #ffffff; border: 1px solid #e2e8f0; border-radius: 8px; padding: 1.5rem; margin-bottom: 1rem;">
            <h5 style="margin-top: 0; color: #2D3748; display: flex; align-items: center;">
              <span style="background: #2D3748; color: #00D4AA; border: 2px solid #00D4AA; width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 0.5rem; font-size: 12px; font-weight: bold;">1</span>
              Model Organization
            </h5>
            <p>Separate each configurable part into its own object. Use clear, descriptive names following your naming convention.</p>
            <div style="background: #f0fdf4; padding: 0.75rem; border-radius: 6px; border-left: 3px solid #22c55e; margin-top: 0.5rem;">
              <strong>💡 Pro Tip:</strong> Use 3ds Max layers to organize related objects (e.g., "Main_Structure", "Accessories", "Materials")
            </div>
          </div>

          <div style="background: #ffffff; border: 1px solid #e2e8f0; border-radius: 8px; padding: 1.5rem; margin-bottom: 1rem;">
            <h5 style="margin-top: 0; color: #2D3748; display: flex; align-items: center;">
              <span style="background: #2D3748; color: #00D4AA; border: 2px solid #00D4AA; width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 0.5rem; font-size: 12px; font-weight: bold;">2</span>
              Material Setup
            </h5>
            <p>Use Standard Materials for best Threekit compatibility. Avoid complex material setups that may not translate well.</p>
            <div style="background: #fef3c7; padding: 0.75rem; border-radius: 6px; border-left: 3px solid #f59e0b; margin-top: 0.5rem;">
              <strong>⚠️ Important:</strong> Avoid using V-Ray materials if you're not using V-Ray rendering, as they may not export correctly
            </div>
          </div>

          <div style="background: #ffffff; border: 1px solid #e2e8f0; border-radius: 8px; padding: 1.5rem; margin-bottom: 1rem;">
            <h5 style="margin-top: 0; color: #2D3748; display: flex; align-items: center;">
              <span style="background: #00D4AA; color: white; width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 0.5rem; font-size: 12px; font-weight: bold;">3</span>
              UV Mapping
            </h5>
            <p>${uvMapping === 'uv0-uv1' ? 'Set up UV0 for diffuse textures and UV1 for AO maps using the Unwrap UVW modifier' : 'Use UV0 for all texture mapping'}</p>
            <div style="background: #f0f9ff; padding: 0.75rem; border-radius: 6px; border-left: 3px solid #3b82f6; margin-top: 0.5rem;">
              <strong>📖 Learn More:</strong> <a href="https://developer.threekit.com/docs/uv-mapping-best-practices" target="_blank" style="color: #3b82f6;">UV Mapping Best Practices</a>
            </div>
          </div>

          <div style="background: #ffffff; border: 1px solid #e2e8f0; border-radius: 8px; padding: 1.5rem; margin-bottom: 1rem;">
            <h5 style="margin-top: 0; color: #2D3748; display: flex; align-items: center;">
              <span style="background: #00D4AA; color: white; width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 0.5rem; font-size: 12px; font-weight: bold;">4</span>
              Export Configuration
            </h5>
            <p>File → Export → ${exportFormat} with materials and textures enabled</p>
            <div style="background: #f0fdf4; padding: 0.75rem; border-radius: 6px; border-left: 3px solid #22c55e; margin-top: 0.5rem;">
              <strong>✅ Export Settings:</strong> Ensure "Embed Media" is checked and "Smooth Groups" is enabled for best results
            </div>
            <div style="margin-top: 1rem;">
              <a href="https://developer.threekit.com/docs/exporting-from-3ds-max" target="_blank" style="display: inline-flex; align-items: center; padding: 0.5rem 1rem; background: #00D4AA; color: white; text-decoration: none; border-radius: 6px; font-weight: 500; font-size: 14px;">
                📖 3ds Max Export Guide
              </a>
            </div>
          </div>
        `,
        'blender': `
          <div style="display: flex; align-items: center; margin-bottom: 1rem; padding: 1rem; background: #f8fafc; border-radius: 8px; border-left: 4px solid #f97316;">
            <div style="margin-right: 1rem;">
              <div style="width: 60px; height: 60px; background: linear-gradient(135deg, #f97316, #ea580c); border-radius: 8px; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 18px;">B</div>
            </div>
            <div>
              <h4 style="margin: 0; color: #2D3748;">Blender Setup</h4>
              <p style="margin: 0.25rem 0 0 0; color: #6b7280; font-size: 14px;">Free and open-source 3D creation suite</p>
            </div>
          </div>
          
          <div style="background: #ffffff; border: 1px solid #e2e8f0; border-radius: 8px; padding: 1.5rem; margin-bottom: 1rem;">
            <h5 style="margin-top: 0; color: #2D3748; display: flex; align-items: center;">
              <span style="background: #f97316; color: white; width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 0.5rem; font-size: 12px; font-weight: bold;">1</span>
              Model Organization
            </h5>
            <p>Separate each configurable part into its own object. Use collections to organize related objects.</p>
            <div style="background: #f0fdf4; padding: 0.75rem; border-radius: 6px; border-left: 3px solid #22c55e; margin-top: 0.5rem;">
              <strong>💡 Pro Tip:</strong> Use Blender's Outliner to organize objects into logical groups
            </div>
          </div>

          <div style="background: #ffffff; border: 1px solid #e2e8f0; border-radius: 8px; padding: 1.5rem; margin-bottom: 1rem;">
            <h5 style="margin-top: 0; color: #2D3748; display: flex; align-items: center;">
              <span style="background: #f97316; color: white; width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 0.5rem; font-size: 12px; font-weight: bold;">2</span>
              Material Setup
            </h5>
            <p>Use Principled BSDF shader for best Threekit compatibility. This provides the most accurate PBR material representation.</p>
            <div style="background: #fef3c7; padding: 0.75rem; border-radius: 6px; border-left: 3px solid #f59e0b; margin-top: 0.5rem;">
              <strong>⚠️ Important:</strong> Avoid using Eevee-specific nodes as they may not export correctly to Threekit
            </div>
          </div>

          <div style="background: #ffffff; border: 1px solid #e2e8f0; border-radius: 8px; padding: 1.5rem; margin-bottom: 1rem;">
            <h5 style="margin-top: 0; color: #2D3748; display: flex; align-items: center;">
              <span style="background: #f97316; color: white; width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 0.5rem; font-size: 12px; font-weight: bold;">3</span>
              UV Mapping
            </h5>
            <p>${uvMapping === 'uv0-uv1' ? 'Create UV0 for diffuse and UV1 for AO maps in the UV Editing workspace' : 'Use UV0 for all texture mapping'}</p>
            <div style="background: #f0f9ff; padding: 0.75rem; border-radius: 6px; border-left: 3px solid #3b82f6; margin-top: 0.5rem;">
              <strong>📖 Learn More:</strong> <a href="https://developer.threekit.com/docs/uv-mapping-best-practices" target="_blank" style="color: #3b82f6;">UV Mapping Best Practices</a>
            </div>
          </div>

          <div style="background: #ffffff; border: 1px solid #e2e8f0; border-radius: 8px; padding: 1.5rem; margin-bottom: 1rem;">
            <h5 style="margin-top: 0; color: #2D3748; display: flex; align-items: center;">
              <span style="background: #f97316; color: white; width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 0.5rem; font-size: 12px; font-weight: bold;">4</span>
              Export Configuration
            </h5>
            <p>File → Export → glTF 2.0 (.glb/.gltf) with materials and textures</p>
            <div style="background: #f0fdf4; padding: 0.75rem; border-radius: 6px; border-left: 3px solid #22c55e; margin-top: 0.5rem;">
              <strong>✅ Export Settings:</strong> Enable "Include Selected Objects" and "Materials" for best results
            </div>
            <div style="margin-top: 1rem;">
              <a href="https://developer.threekit.com/docs/exporting-from-blender" target="_blank" style="display: inline-flex; align-items: center; padding: 0.5rem 1rem; background: #f97316; color: white; text-decoration: none; border-radius: 6px; font-weight: 500; font-size: 14px;">
                📖 Blender Export Guide
              </a>
            </div>
          </div>
        `,
        'maya': `
          <h4>Maya Setup:</h4>
          <ol>
            <li><strong>Model Organization:</strong> Separate each configurable part into its own object</li>
            <li><strong>Material Setup:</strong> Use Standard Surface shader for best Threekit compatibility</li>
            <li><strong>UV Mapping:</strong> ${uvMapping === 'uv0-uv1' ? 'Create UV0 for diffuse and UV1 for AO maps using the UV Editor' : 'Use UV0 for all texture mapping'}</li>
            <li><strong>Texture Assignment:</strong> Connect textures to the appropriate material attributes</li>
            <li><strong>Lighting:</strong> ${getLightingGuidance(lightingSetup)}</li>
            <li><strong>Export:</strong> File → Export All → ${exportFormat} with materials and textures</li>
          </ol>
        `,
        'cinema-4d': `
          <h4>Cinema 4D Setup:</h4>
          <ol>
            <li><strong>Model Organization:</strong> Separate each configurable part into its own object</li>
            <li><strong>Material Setup:</strong> Use Standard Material for best Threekit compatibility</li>
            <li><strong>UV Mapping:</strong> ${uvMapping === 'uv0-uv1' ? 'Set up UV0 for diffuse and UV1 for AO maps using the UV Editor' : 'Use UV0 for all texture mapping'}</li>
            <li><strong>Texture Assignment:</strong> Assign textures to material channels</li>
            <li><strong>Lighting:</strong> ${getLightingGuidance(lightingSetup)}</li>
            <li><strong>Export:</strong> File → Export → ${exportFormat} with materials and textures</li>
          </ol>
        `
      };

      // Add V-Ray workflow if using V-Ray
      let vrayWorkflow = '';
      if (textureSettings.renderEngine === 'V-Ray') {
        vrayWorkflow = `
          <div style="background: #fef3c7; border: 1px solid #f59e0b; border-radius: 8px; padding: 1.5rem; margin-top: 1.5rem;">
            <h4 style="margin-top: 0; color: #92400e; display: flex; align-items: center;">
              <span style="background: #f59e0b; color: white; width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 0.5rem; font-size: 12px; font-weight: bold;">V</span>
              V-Ray Workflow for Threekit
            </h4>
            <p style="margin-bottom: 1rem; color: #92400e;">Since you're using V-Ray, follow these specific guidelines for optimal Threekit integration:</p>
            
            <div style="background: #ffffff; border: 1px solid #e2e8f0; border-radius: 6px; padding: 1rem; margin-bottom: 1rem;">
              <h5 style="margin-top: 0; color: #2D3748;">🎨 V-Ray Material Setup</h5>
              <p style="margin-bottom: 0.5rem;"><strong>Material Organization:</strong></p>
              <ul style="margin: 0.5rem 0; padding-left: 1.5rem;">
                <li>Divide model into separate geometry elements with dedicated materials</li>
                <li>Example: <strong>upper</strong>, <strong>sole</strong>, and <strong>laces</strong> should be distinct objects with individual V-Ray materials</li>
                <li>This enables rendering parts individually and recombining in the configurator</li>
                <li>Keep <strong>one material per part</strong> for flexible swapping and recoloring</li>
              </ul>
              <p style="margin-top: 1rem; margin-bottom: 0.5rem;"><strong>Material Import Process:</strong></p>
              <ul style="margin: 0.5rem 0; padding-left: 1.5rem;">
                <li>Keep all materials in a dedicated scene on separate objects</li>
                <li>Import into Threekit as individual V-Ray materials (as zip file or individually)</li>
                <li>Use V-Ray materials (VRayMtl) for best compatibility</li>
                <li>Set up proper PBR workflow with Diffuse, Roughness, and Metallic maps</li>
              </ul>
            </div>
            
            <div style="background: #ffffff; border: 1px solid #e2e8f0; border-radius: 6px; padding: 1rem; margin-bottom: 1rem;">
              <h5 style="margin-top: 0; color: #2D3748;">🏷️ Naming Conventions & Queries</h5>
              <p style="margin-bottom: 0.5rem;"><strong>Critical:</strong> Proper naming for objects, materials, cameras, and lights</p>
              <p style="margin-bottom: 0.5rem;">Use consistent naming to enable dynamic part recognition with Queries:</p>
              <ul style="margin: 0.5rem 0; padding-left: 1.5rem;">
                <li><strong>Wildcards:</strong> "?" for single character, "*" for multiple characters</li>
                <li><strong>Examples:</strong> Leg_Left, Leg_*, Leg_Le??</li>
                <li>Text search ignores case</li>
              </ul>
            </div>
            
            <div style="background: #ffffff; border: 1px solid #e2e8f0; border-radius: 6px; padding: 1rem; margin-bottom: 1rem;">
              <h5 style="margin-top: 0; color: #2D3748;">📷 Camera & Animation Setup</h5>
              <ul style="margin: 0.5rem 0; padding-left: 1.5rem;">
                <li><strong>Model Positioning:</strong> Center the model for turntable animations to prevent cropping</li>
                <li><strong>Camera Views:</strong> Each preset view needs a dedicated camera (no camera animations)</li>
                <li><strong>Major Changes:</strong> Prepare dedicated 3ds Max scenes for significantly different camera views</li>
                <li><strong>Visibility/Position:</strong> Use rules to hide/unhide elements instead of animating them</li>
                <li><strong>Light Control:</strong> Use inclusions/exclusions triggered by configurator rules</li>
              </ul>
            </div>
            
            <div style="background: #ffffff; border: 1px solid #e2e8f0; border-radius: 6px; padding: 1rem; margin-bottom: 1rem;">
              <h5 style="margin-top: 0; color: #2D3748;">🔧 Exposing Material Parameters</h5>
              <p style="margin-bottom: 0.5rem;"><strong>Make your configurators efficient by exposing material elements:</strong></p>
              <ul style="margin: 0.5rem 0; padding-left: 1.5rem;">
                <li>Add prefix <code style="background: #f1f5f9; padding: 2px 6px; border-radius: 3px;">TK_</code> to texture or material nodes you want to expose</li>
                <li>Example: <code style="background: #f1f5f9; padding: 2px 6px; border-radius: 3px;">TK_BaseColor</code></li>
                <li><strong>Supported Nodes:</strong> VrayUserColor, VrayUserInteger, VrayUserScalar</li>
                <li>Exposed nodes appear as parameters in Threekit after import</li>
                <li><strong>Use Case:</strong> Swap colors or materials parametrically during configuration</li>
              </ul>
              <p style="margin-top: 1rem; margin-bottom: 0.5rem;"><strong>Controllable Features:</strong></p>
              <ul style="margin: 0.5rem 0; padding-left: 1.5rem;">
                <li>V-Ray Displacement and Subdivision</li>
                <li>V-Ray Material Wrapper</li>
                <li>V-Ray Rounded Corners</li>
              </ul>
            </div>
            
            <div style="background: #ffffff; border: 1px solid #e2e8f0; border-radius: 6px; padding: 1rem; margin-bottom: 1rem;">
              <h5 style="margin-top: 0; color: #2D3748;">⚙️ V-Ray Settings & Compatibility</h5>
              <ul style="margin: 0.5rem 0; padding-left: 1.5rem;">
                <li><strong>Version:</strong> V-Ray 6.2 is currently the highest supported version</li>
                <li><strong>Not Supported:</strong> GPU rendering and Progressive rendering</li>
                <li><strong>Lighting:</strong> ${getLightingGuidance(lightingSetup)}</li>
                <li>Use V-Ray lights for consistent lighting</li>
                <li>Set up HDR environment maps for realistic reflections</li>
                <li>Configure V-Ray render settings for optimal export</li>
              </ul>
            </div>
            
            <div style="background: #e8f4fd; padding: 1rem; border-radius: 6px; border-left: 4px solid #2563eb;">
              <p style="margin: 0; font-size: 14px;"><strong>📚 V-Ray Documentation:</strong></p>
              <ul style="margin: 0.5rem 0; padding-left: 1.5rem; font-size: 14px;">
                <li><a href="https://community.threekit.com/learn/workflows/v-ray-workflow/1-vray-requirements" target="_blank">V-Ray Requirements</a></li>
                <li><a href="https://community.threekit.com/learn/workflows/v-ray-workflow/2-vray-asset-preparation" target="_blank">V-Ray Asset Preparation</a></li>
                <li><a href="https://community.threekit.com/learn/workflows/v-ray-workflow/3-vray-asset-export" target="_blank">V-Ray Asset Export</a></li>
                <li><a href="https://community.threekit.com/learn/workflows/v-ray-workflow/6-vray-materials" target="_blank">V-Ray Materials</a></li>
                <li><a href="https://community.threekit.com/learn/workflows/v-ray-workflow/11-vray-render-workflow" target="_blank">V-Ray Render Workflow</a></li>
              </ul>
            </div>
          </div>
        `;
      }

      return (instructions[softwareLower] || instructions['3ds-max']) + vrayWorkflow;
    }

    function downloadConfig() {
      const formData = collectFormData();
      const clientConfig = generateClientConfig(formData);
      
      // Download CSV for internal team
      downloadCSV(clientConfig.internalData);
      
      // Download JSON config for internal use
      const dataStr = JSON.stringify(clientConfig, null, 2);
      const dataBlob = new Blob([dataStr], {type: 'application/json'});
      const url = URL.createObjectURL(dataBlob);
      const link = document.createElement('a');
      link.href = url;
      link.download = `client-config-${clientConfig.internalData.clientId}.json`;
      link.click();
    }

    function downloadCSV(internalData) {
      const csvHeaders = [
        'Client ID', 'Company Name', 'Industry', 'Website', 'Existing Config', 'Project Description',
        'Contact Name', 'Contact Email', '3D Software', 'Render Engine', 'Experience Level',
        'Target Platform', 'Custom Requirements', 'Additional Notes', 'Submission Date'
      ];
      
      const csvRow = [
        internalData.clientId,
        internalData.clientName,
        internalData.industry,
        internalData.clientWebsite,
        internalData.existingConfig,
        internalData.projectDescription,
        internalData.contactName,
        internalData.contactEmail,
        internalData['3dSoftware'],
        internalData.renderEngine,
        internalData.experienceLevel,
        internalData.targetPlatform,
        internalData.customRequirements,
        internalData.additionalNotes,
        internalData.submissionDate
      ];
      
      const csvContent = [csvHeaders, csvRow].map(row => 
        row.map(field => `"${(field || '').toString().replace(/"/g, '""')}"`).join(',')
      ).join('\n');
      
      const csvBlob = new Blob([csvContent], {type: 'text/csv;charset=utf-8;'});
      const csvUrl = URL.createObjectURL(csvBlob);
      const csvLink = document.createElement('a');
      csvLink.href = csvUrl;
      csvLink.download = `threekit-leads-${new Date().toISOString().split('T')[0]}.csv`;
      csvLink.click();
    }

    function goToDocumentation() {
      console.log('🚀 Go to Documentation clicked');
      
      // Validate step 1 to ensure we have the minimum required data
      if (!validateStep(1)) {
        console.log('❌ Step 1 validation failed');
        return;
      }

      console.log('✅ Step 1 validation passed');

      // Fill in default values for missing steps to ensure we have complete data
      fillDefaultValuesForDocumentation();
      
      // Collect all form data
      const formData = collectFormData();
      console.log('📋 Form data collected:', formData);
      
      // Generate client configuration
      const clientConfig = generateClientConfig(formData);
      console.log('⚙️ Client config generated:', clientConfig);
      
      // Hide step 1 and show results in preview mode
      document.getElementById('step1-section').classList.add('hidden');
      console.log('👁️ Showing results in preview mode');
      showResults(clientConfig, true);
    }

    function regenerateGuide() {
      console.log('🔄 Regenerate Guide clicked');
      
      // Validate step 1 to ensure we have the minimum required data
      if (!validateStep(1)) {
        console.log('❌ Step 1 validation failed');
        alert('Please fill in all required fields in the Company Information section.');
        return;
      }

      console.log('✅ Step 1 validation passed');

      // Fill in default values for missing steps to ensure we have complete data
      fillDefaultValuesForDocumentation();
      
      // Collect all form data
      const formData = collectFormData();
      console.log('📋 Form data collected:', formData);
      
      // Generate client configuration
      const clientConfig = generateClientConfig(formData);
      console.log('⚙️ Client config generated:', clientConfig);
      
      // Hide customer loaded info and step 1
      document.getElementById('customerLoadedInfo').style.display = 'none';
      document.getElementById('step1-section').classList.add('hidden');
      
      // Update progress to 100%
      updateProgressBar(8);
      
      // Show results
      console.log('✅ Showing regenerated guide');
      showResults(clientConfig, false);
    }

    function fillDefaultValuesForDocumentation() {
      console.log('🔧 Filling default values for documentation generation');
      
      // Step 2: Configuration Type (default to interactive if not set)
      if (!document.querySelector('input[name="configType"]:checked')) {
        document.getElementById('config-interactive').checked = true;
        updateRenderEngineOptions();
      }
      
      // Step 3: 3D Software (default to 3ds Max if not set)
      if (!document.getElementById('3dSoftware').value) {
        document.getElementById('3dSoftware').value = 'Autodesk 3ds Max';
      }
      
      // Step 4: Project Requirements (select some default requirements)
      const defaultRequirements = ['Product configurator with multiple options', 'Material customization'];
      defaultRequirements.forEach(req => {
        const checkbox = document.querySelector(`input[value="${req}"]`);
        if (checkbox && !checkbox.checked) {
          checkbox.checked = true;
        }
      });
      
      // Target Platform (default to webgl)
      if (!document.getElementById('targetPlatform').value) {
        document.getElementById('targetPlatform').value = 'webgl';
      }
      
      // Step 5: Asset Organization (default to separated by component)
      if (!document.getElementById('assetOrganization').value) {
        document.getElementById('assetOrganization').value = 'Separated by component';
      }
      
      // Material Approach (default to create new materials in Threekit)
      if (!document.getElementById('materialApproach').value) {
        document.getElementById('materialApproach').value = 'Create new materials in Threekit';
      }
      
      // Naming Convention (default to Threekit recommended)
      if (!document.getElementById('namingConvention').value) {
        document.getElementById('namingConvention').value = 'ProductType_PartName';
      }
      
      // Step 6: Export & Texture Settings
      if (!document.getElementById('exportFormat').value) {
        document.getElementById('exportFormat').value = 'FBX';
      }
      
      if (!document.getElementById('textureFormat').value) {
        document.getElementById('textureFormat').value = 'PNG';
      }
      
      if (!document.getElementById('textureResolution').value) {
        document.getElementById('textureResolution').value = '2048';
      }
      
      if (!document.getElementById('uvMapping').value) {
        document.getElementById('uvMapping').value = 'uv0-uv1';
      }
      
      if (!document.getElementById('lightingSetup').value) {
        document.getElementById('lightingSetup').value = 'pbr-hdr';
      }
      
      // Step 7: Contact Information (use loaded data or defaults)
      if (!document.getElementById('contactName').value) {
        document.getElementById('contactName').value = document.getElementById('companyName').value || 'Customer';
      }
      
      if (!document.getElementById('contactEmail').value) {
        document.getElementById('contactEmail').value = 'contact@' + (document.getElementById('clientWebsite').value || 'company.com').replace(/^https?:\/\//, '').replace(/^www\./, '');
      }
      
      console.log('✅ Default values filled');
    }

    function goBackToStep1() {
      // Hide results section
      document.getElementById('results-section').classList.add('hidden');
      
      // Show step 1 (since we came from "Go to Documentation")
      document.getElementById('step1-section').classList.remove('hidden');
      
      // Update progress
      updateProgressBar(1);
      
      // Scroll to top
      window.scrollTo(0, 0);
    }

    function generateFinalGuide() {
      // Collect all form data
      const formData = collectFormData();
      
      // Generate client configuration
      const clientConfig = generateClientConfig(formData);
      
      // Show results in final mode (not preview)
      showResults(clientConfig, false);
    }

    function goBackToStep7() {
      // Hide results section
      document.getElementById('results-section').classList.add('hidden');
      
      // Show step 1 (since we came from "Go to Documentation")
      document.getElementById('step1-section').classList.remove('hidden');
      
      // Update progress
      updateProgressBar(1);
      
      // Scroll to top
      window.scrollTo(0, 0);
    }

    function printGuide() {
      const guideContent = document.getElementById('guideContent');
      console.log('Guide content element:', guideContent);
      console.log('Guide content HTML length:', guideContent ? guideContent.innerHTML.length : 'No element found');
      console.log('Guide content preview:', guideContent ? guideContent.innerHTML.substring(0, 500) : 'No content');
      
      if (!guideContent || guideContent.innerHTML.trim() === '') {
        alert('No guide content found. Please generate the guide first.');
        return;
      }
      
      // Method 1: Try direct print with style adjustments
      try {
        // Store original styles
        const originalBodyStyle = document.body.style.cssText;
        const originalMainStyle = document.querySelector('main').style.cssText;
        const originalGuideStyle = guideContent.style.cssText;
        
        // Prepare for printing with 140 DPI optimization and full width
        document.body.style.cssText = 'margin: 0; padding: 0; background: white; color: black; min-height: auto; transform: scale(1.0); font-size: 10px; line-height: 1.2; width: 100%; max-width: none;';
        document.querySelector('main').style.cssText = 'max-width: 100%; margin: 0; padding: 0; background: white; width: 100%;';
        guideContent.style.cssText = 'max-width: 100%; margin: 0; padding: 0; background: white; box-shadow: none; border: none; width: 100%;';
        
        // Add 140 DPI optimization meta tag
        const existingMeta = document.querySelector('meta[name="viewport"]');
        if (existingMeta) {
          existingMeta.setAttribute('content', 'width=device-width, initial-scale=1.0, user-scalable=no');
        }
        
        // Force 140 DPI styling
        document.body.classList.add('dpi-140');
        
        // Calculate exact content height to eliminate white space
        const contentHeight = guideContent.scrollHeight;
        const heightInInches = Math.ceil(contentHeight / 96) + 0.5; // Convert pixels to inches + small buffer
        
        // Inject CSS for continuous vertical document with exact height
        const hideHeadersFootersCSS = `
          @page { 
            size: 8.5in ${heightInInches}in;
            margin: 0 !important; 
          }
          @media print {
            @page { 
              size: 8.5in ${heightInInches}in;
              margin: 0 !important; 
            }
            body { 
              margin: 0 !important; 
              padding: 0 !important; 
              width: 100% !important;
              max-width: none !important;
            }
            * { 
              -webkit-print-color-adjust: exact !important;
              page-break-inside: avoid !important;
              page-break-after: avoid !important;
              page-break-before: avoid !important;
              break-inside: avoid !important;
              break-after: avoid !important;
              break-before: avoid !important;
            }
          }
        `;
        const style = document.createElement('style');
        style.textContent = hideHeadersFootersCSS;
        document.head.appendChild(style);
        
        // Hide elements that shouldn't print
        const elementsToHide = document.querySelectorAll('.questionnaire-step:not(#results-section), .progress-container, .nav-buttons, header');
        elementsToHide.forEach(el => {
          el.style.display = 'none';
        });
        
        // Show only the guide content
        document.getElementById('results-section').style.display = 'block';
        guideContent.style.display = 'block';
        
        // Add print-specific class
        document.body.classList.add('printing');
        
        // Debug: Check grid layout before printing
        const workflowGrids = document.querySelectorAll('.workflow-grid, .naming-convention-grid');
        console.log('Found grids:', workflowGrids.length);
        workflowGrids.forEach((grid, index) => {
          const items = grid.children.length;
          const computedStyle = window.getComputedStyle(grid);
          console.log(`Grid ${index}: ${items} items, grid-template-columns: ${computedStyle.gridTemplateColumns}`);
        });
        
        // Force appropriate column layout with JavaScript as backup - optimized for full PDF width
        workflowGrids.forEach(grid => {
          const items = grid.children.length;
          grid.style.maxWidth = 'none';
          grid.style.width = '100%';
          
          if (items === 1) {
            grid.style.gridTemplateColumns = '1fr';
          } else if (items === 2) {
            grid.style.gridTemplateColumns = 'repeat(2, 1fr)';
          } else if (items === 3) {
            grid.style.gridTemplateColumns = 'repeat(3, 1fr)';
          } else if (items === 4) {
            grid.style.gridTemplateColumns = 'repeat(4, 1fr)';
          } else if (items === 5) {
            grid.style.gridTemplateColumns = 'repeat(5, 1fr)';
          } else if (items >= 6) {
            // For 6+ items, use 4 columns with wrapping
            grid.style.gridTemplateColumns = 'repeat(4, 1fr)';
          }
          grid.style.display = 'grid';
        });
        
        // Trigger print
        window.print();
        
        // Restore original styles after printing
        setTimeout(() => {
          document.body.style.cssText = originalBodyStyle;
          document.querySelector('main').style.cssText = originalMainStyle;
          guideContent.style.cssText = originalGuideStyle;
          
          // Show hidden elements
          elementsToHide.forEach(el => {
            el.style.display = '';
          });
          
          // Remove print class
          document.body.classList.remove('printing');
        }, 1000);
        
      } catch (error) {
        console.error('Error with direct print method:', error);
        // Fallback: Open in new window
        printGuideInNewWindow();
      }
    }
    
    function printGuideInNewWindow() {
      const guideContent = document.getElementById('guideContent');
      if (!guideContent || guideContent.innerHTML.trim() === '') {
        alert('No guide content found. Please generate the guide first.');
        return;
      }
      
      // Create a new window with just the guide content
      const printWindow = window.open('', '_blank', 'width=800,height=600');
      
      const printHTML = `
        <!DOCTYPE html>
        <html lang="en">
        <head>
          <meta charset="UTF-8">
          <meta name="viewport" content="width=device-width, initial-scale=1.0">
          <title>3D Setup Guide - PDF Export</title>
          <style>
            body {
              font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
              line-height: 1.2;
              color: #333;
              max-width: none;
              margin: 0;
              padding: 0;
              background: white;
              min-height: auto;
              font-size: 10px;
              transform: scale(1.0);
              transform-origin: top left;
              width: 100%;
            }
            
            .info-box {
              margin: 8px 0;
              padding: 12px;
              border-radius: 6px;
              border-left: 3px solid;
            }
            
            .info-box.success {
              background: #f0f9ff;
              border-left-color: #00D4AA;
            }
            
            .info-box.info {
              background: #f8fafc;
              border-left-color: #3B82F6;
            }
            
            .info-box.warning {
              background: #fffbeb;
              border-left-color: #F59E0B;
            }
            
            h1, h2, h3, h4, h5, h6 {
              color: #1E293B;
              margin-top: 0;
            }
            
            h1 { font-size: 16px; }
            h2 { font-size: 14px; }
            h3 { font-size: 12px; }
            h4 { font-size: 11px; }
            
            ul, ol {
              margin: 10px 0;
              padding-left: 20px;
            }
            
            li {
              margin: 5px 0;
            }
            
            table {
              width: 100%;
              border-collapse: collapse;
              margin: 15px 0;
            }
            
            th, td {
              border: 1px solid #ddd;
              padding: 8px 12px;
              text-align: left;
            }
            
            th {
              background-color: #f5f5f5;
              font-weight: bold;
            }
            
            code {
              background: #f1f5f9;
              padding: 2px 6px;
              border-radius: 4px;
              font-family: 'Courier New', monospace;
            }
            
            pre {
              background: #f1f5f9;
              padding: 15px;
              border-radius: 8px;
              overflow-x: auto;
            }
            
            .gradient-header {
              background: linear-gradient(135deg, #00D4AA, #667EEA);
              color: white;
              padding: 20px;
              border-radius: 8px;
              margin: 20px 0;
            }
            
            .step-card {
              background: #f8fafc;
              border: 1px solid #e2e8f0;
              border-radius: 8px;
              padding: 15px;
              margin: 15px 0;
            }
            
            .pro-tip {
              background: #f0fdf4;
              border-left: 4px solid #22c55e;
              padding: 15px;
              margin: 15px 0;
            }
            
            .warning {
              background: #fef3c7;
              border-left: 4px solid #f59e0b;
              padding: 15px;
              margin: 15px 0;
            }
            
            .workflow-grid,
            .naming-convention-grid {
              display: grid !important;
              grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)) !important;
              gap: 15px !important;
              margin: 10px 0 !important;
              width: 100% !important;
              max-width: none !important;
            }
            
            .workflow-grid > div,
            .naming-convention-grid > div {
              break-inside: avoid !important;
              page-break-inside: avoid !important;
              margin-bottom: 0 !important;
              padding: 10px !important;
              border: 1px solid #ddd !important;
              border-radius: 4px !important;
              background: #f9f9f9 !important;
              min-height: 120px !important;
              display: flex !important;
              flex-direction: column !important;
            }
            
            @page {
              margin: 0 !important;
              size: 8.5in auto;
            }
            
            @media print {
              @page { margin: 0 !important; }
              body { margin: 0; padding: 0; width: 100%; max-width: none; }
              .info-box { break-inside: avoid; margin: 8px 0; padding: 12px; }
              h1, h2, h3, h4, h5, h6 { 
                margin: 5px 0;
                page-break-inside: avoid !important;
                page-break-after: avoid !important;
                page-break-before: avoid !important;
                break-inside: avoid !important;
                break-after: avoid !important;
                break-before: avoid !important;
              }
              
              * { 
                page-break-inside: avoid !important;
                page-break-after: avoid !important;
                page-break-before: avoid !important;
                break-inside: avoid !important;
                break-after: avoid !important;
                break-before: avoid !important;
              }
              
              .workflow-grid,
              .naming-convention-grid {
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)) !important;
                max-width: none !important;
                width: 100% !important;
              }
            }
          </style>
        </head>
        <body>
          ${guideContent.innerHTML}
        </body>
        </html>
      `;
      
      printWindow.document.write(printHTML);
      printWindow.document.close();
      
      // Wait for content to load, then print
      printWindow.onload = function() {
        // Debug: Check grid layout before printing
        const workflowGrids = printWindow.document.querySelectorAll('.workflow-grid, .naming-convention-grid');
        console.log('Found grids in print window:', workflowGrids.length);
        workflowGrids.forEach((grid, index) => {
          const items = grid.children.length;
          const computedStyle = printWindow.getComputedStyle(grid);
          console.log(`Print window grid ${index}: ${items} items, grid-template-columns: ${computedStyle.gridTemplateColumns}`);
        });
        
        // Force appropriate column layout with JavaScript as backup - full width
        workflowGrids.forEach(grid => {
          const items = grid.children.length;
          grid.style.maxWidth = 'none';
          grid.style.width = '100%';
          
          if (items === 1) {
            grid.style.gridTemplateColumns = '1fr';
          } else if (items === 2) {
            grid.style.gridTemplateColumns = 'repeat(2, 1fr)';
          } else if (items === 3) {
            grid.style.gridTemplateColumns = 'repeat(3, 1fr)';
          } else if (items === 4) {
            grid.style.gridTemplateColumns = 'repeat(4, 1fr)';
          } else if (items === 5) {
            grid.style.gridTemplateColumns = 'repeat(5, 1fr)';
          } else if (items >= 6) {
            grid.style.gridTemplateColumns = 'repeat(4, 1fr)';
          }
          grid.style.display = 'grid';
        });
        
        printWindow.focus();
        printWindow.print();
      };
    }

    function exportAsHTML() {
      const guideContent = document.getElementById('guideContent');
      if (!guideContent || guideContent.innerHTML.trim() === '') {
        alert('No guide content found. Please generate the guide first.');
        return;
      }

      // Get the current configuration data
      const formData = collectFormData();
      const clientConfig = generateClientConfig(formData);
      
      // Create complete HTML document
      const htmlContent = `<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>3D Setup Guide - ${clientConfig.clientData.clientName}</title>
  <style>
    /* Reset and Base Styles */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      line-height: 1.6;
      color: #1E293B;
      background: #FFFFFF;
      padding: 20px;
      max-width: 1200px;
      margin: 0 auto;
    }

    /* Header */
    .guide-header {
      background: linear-gradient(135deg, #00D4AA, #667EEA);
      color: white;
      padding: 30px;
      border-radius: 12px;
      margin-bottom: 30px;
      text-align: center;
    }

    .guide-header h1 {
      font-size: 2.5rem;
      margin-bottom: 10px;
      font-weight: 700;
    }

    .guide-header p {
      font-size: 1.1rem;
      opacity: 0.9;
    }

    /* Info Boxes */
    .info-box {
      margin: 20px 0;
      padding: 20px;
      border-radius: 8px;
      border-left: 4px solid;
    }

    .info-box.success {
      background: #f0f9ff;
      border-left-color: #00D4AA;
    }

    .info-box.info {
      background: #f8fafc;
      border-left-color: #3B82F6;
    }

    .info-box.warning {
      background: #fffbeb;
      border-left-color: #F59E0B;
    }

    /* Typography */
    h1, h2, h3, h4, h5, h6 {
      color: #1E293B;
      margin: 20px 0 10px 0;
      font-weight: 600;
    }

    h1 { font-size: 2rem; }
    h2 { font-size: 1.75rem; }
    h3 { font-size: 1.5rem; }
    h4 { font-size: 1.25rem; }
    h5 { font-size: 1.1rem; }
    h6 { font-size: 1rem; }

    /* Lists */
    ul, ol {
      margin: 10px 0;
      padding-left: 20px;
    }

    li {
      margin: 5px 0;
    }

    /* Links */
    a {
      color: #3B82F6;
      text-decoration: none;
      font-weight: 500;
    }

    a:hover {
      color: #1D4ED8;
      text-decoration: underline;
    }

    /* Grid Layouts */
    .workflow-grid,
    .naming-convention-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin: 20px 0;
    }

    .workflow-grid > div,
    .naming-convention-grid > div {
      background: #f8fafc;
      padding: 20px;
      border-radius: 8px;
      border: 1px solid #e2e8f0;
    }

    /* Tables */
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 15px 0;
    }

    th, td {
      border: 1px solid #e2e8f0;
      padding: 12px;
      text-align: left;
    }

    th {
      background-color: #f1f5f9;
      font-weight: 600;
    }

    /* Code */
    code {
      background: #f1f5f9;
      padding: 2px 6px;
      border-radius: 4px;
      font-family: 'Courier New', monospace;
      font-size: 0.9em;
    }

    pre {
      background: #f1f5f9;
      padding: 15px;
      border-radius: 8px;
      overflow-x: auto;
      margin: 15px 0;
    }

    /* Pro Tips and Warnings */
    .pro-tip {
      background: #f0fdf4;
      border-left: 4px solid #22c55e;
      padding: 15px;
      margin: 15px 0;
      border-radius: 4px;
    }

    .warning {
      background: #fef3c7;
      border-left: 4px solid #f59e0b;
      padding: 15px;
      margin: 15px 0;
      border-radius: 4px;
    }

    /* Responsive Design */
    @media (max-width: 768px) {
      body {
        padding: 10px;
      }
      
      .workflow-grid,
      .naming-convention-grid {
        grid-template-columns: 1fr;
      }
      
      .guide-header h1 {
        font-size: 2rem;
      }
    }

    /* Print Styles */
    @media print {
      body {
        padding: 0;
        max-width: none;
      }
      
      .guide-header {
        background: #f8fafc !important;
        color: #1E293B !important;
        border: 2px solid #e2e8f0;
      }
      
      a {
        color: #1E293B !important;
        text-decoration: underline !important;
      }
    }
  </style>
</head>
<body>
  <div class="guide-header">
    <h1>3D Setup Guide</h1>
    <p>Customized for ${clientConfig.clientData.clientName}</p>
    <p>Generated on ${new Date().toLocaleDateString()}</p>
  </div>
  
  ${guideContent.innerHTML}
  
  <div style="margin-top: 40px; padding: 20px; background: #f8fafc; border-radius: 8px; text-align: center;">
    <p><strong>Need Help?</strong></p>
    <p>Visit the <a href="https://community.threekit.com" target="_blank">Threekit Community</a> for additional resources and support.</p>
  </div>
</body>
</html>`;

      // Create and download the file
      const blob = new Blob([htmlContent], { type: 'text/html;charset=utf-8' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `3d-setup-guide-${clientConfig.clientData.clientName.replace(/[^a-zA-Z0-9]/g, '-').toLowerCase()}.html`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }

    function debugGuideContent() {
      const guideContent = document.getElementById('guideContent');
      console.log('=== DEBUG GUIDE CONTENT ===');
      console.log('Element found:', !!guideContent);
      console.log('Element display:', guideContent ? window.getComputedStyle(guideContent).display : 'N/A');
      console.log('Element visibility:', guideContent ? window.getComputedStyle(guideContent).visibility : 'N/A');
      console.log('Element opacity:', guideContent ? window.getComputedStyle(guideContent).opacity : 'N/A');
      console.log('InnerHTML length:', guideContent ? guideContent.innerHTML.length : 'N/A');
      console.log('Text content length:', guideContent ? guideContent.textContent.length : 'N/A');
      console.log('First 1000 chars of HTML:', guideContent ? guideContent.innerHTML.substring(0, 1000) : 'N/A');
      console.log('First 500 chars of text:', guideContent ? guideContent.textContent.substring(0, 500) : 'N/A');
      
      // Show in alert for quick debugging
      const summary = `
Guide Content Debug:
- Element exists: ${!!guideContent}
- HTML length: ${guideContent ? guideContent.innerHTML.length : 0}
- Text length: ${guideContent ? guideContent.textContent.length : 0}
- Display: ${guideContent ? window.getComputedStyle(guideContent).display : 'N/A'}
- Visibility: ${guideContent ? window.getComputedStyle(guideContent).visibility : 'N/A'}
- Opacity: ${guideContent ? window.getComputedStyle(guideContent).opacity : 'N/A'}

Check console for full details.
      `;
      alert(summary);
    }

    function startOver() {
      // Reset form
      document.querySelectorAll('input, select, textarea').forEach(input => {
        if (input.type === 'checkbox') {
          input.checked = false;
        } else {
          input.value = '';
        }
      });
      
      // Hide the info message
      document.getElementById('customerLoadedInfo').style.display = 'none';
      
      // Hide results, show step 1
      document.getElementById('results-section').classList.add('hidden');
      document.getElementById('step1-section').classList.remove('hidden');
      
      // Reset progress
      updateProgressBar(1);
      
      // Scroll to top
      window.scrollTo(0, 0);
    }

    // Global variables to store analysis results
    let detectedFeatures = [];
    let detectedConfigType = '';
    let detectedComplexity = '';

    // Customer database
    let customerDatabase = JSON.parse(localStorage.getItem('threekitCustomers') || '[]');
    let selectedCustomerId = null;

    // Website analysis and project suggestions
    const industryProjectTemplates = {
      'fitness-equipment': [
        'Interactive 3D configurator for gym equipment with material customization and real-time visualization',
        'Product configurator for fitness machines with color options, size variations, and equipment combinations',
        '3D viewer for gym equipment showcasing different models, materials, and configurations',
        'Interactive showroom for fitness equipment with AR try-on capabilities'
      ],
      'furniture': [
        '3D furniture configurator with material selection, color options, and room visualization',
        'Interactive furniture showroom with customization options and real-time pricing',
        '3D product viewer for furniture with different finishes, sizes, and configurations',
        'Virtual furniture placement tool with AR integration for home visualization'
      ],
      'automotive': [
        '3D car configurator with exterior colors, interior options, and trim levels',
        'Interactive vehicle showroom with 360° views and customization options',
        '3D parts catalog with exploded views and assembly instructions',
        'Virtual test drive experience with different vehicle configurations'
      ],
      'jewelry': [
        '3D jewelry configurator with gemstone selection, metal options, and engraving',
        'Interactive jewelry designer with custom ring sizing and stone arrangements',
        '3D jewelry viewer with different angles, lighting, and material options',
        'Virtual try-on experience for jewelry with AR integration'
      ],
      'electronics': [
        '3D product configurator for electronics with color options and feature selections',
        'Interactive tech showroom with product comparisons and specifications',
        '3D viewer for electronic devices with different models and accessories',
        'Virtual product demonstration with interactive features and AR integration'
      ],
      'fashion': [
        '3D fashion configurator with size options, color variations, and style combinations',
        'Interactive clothing showroom with virtual try-on and customization',
        '3D product viewer for fashion items with different materials and fits',
        'Virtual wardrobe with outfit combinations and styling options'
      ],
      'home-garden': [
        '3D home and garden configurator with outdoor furniture and landscaping options',
        'Interactive garden design tool with plant selection and layout visualization',
        '3D outdoor furniture showroom with material and color customization',
        'Virtual patio and garden planning with AR placement capabilities'
      ],
      'beauty-cosmetics': [
        '3D beauty configurator with makeup application and color matching',
        'Interactive cosmetics showroom with virtual try-on and skin tone matching',
        '3D product viewer for beauty items with different shades and finishes',
        'Virtual beauty consultation with personalized product recommendations'
      ],
      'sports-recreation': [
        '3D sports equipment configurator with gear customization and sizing',
        'Interactive recreation showroom with equipment selection and configuration',
        '3D product viewer for sports gear with different models and features',
        'Virtual sports equipment fitting with performance optimization'
      ],
      'industrial-machinery': [
        '3D industrial equipment configurator with technical specifications and customization',
        'Interactive machinery showroom with component selection and assembly options',
        '3D parts catalog with exploded views and technical documentation',
        'Virtual equipment demonstration with performance metrics and specifications'
      ],
      'medical-devices': [
        '3D medical device configurator with technical specifications and compliance options',
        'Interactive healthcare equipment showroom with device selection and configuration',
        '3D product viewer for medical devices with detailed technical information',
        'Virtual device demonstration with safety features and usage instructions'
      ],
      'other': [
        '3D product configurator with customization options and real-time visualization',
        'Interactive product showroom with different models and specifications',
        '3D viewer for products with material options and configuration choices',
        'Virtual product experience with AR integration and customization'
      ]
    };

    async function analyzeWebsite() {
      const websiteUrl = document.getElementById('clientWebsite').value;
      if (!websiteUrl) return;

      const analysisDiv = document.getElementById('websiteAnalysis');
      const contentDiv = document.getElementById('analysisContent');
      
      // Show loading state
      analysisDiv.style.display = 'block';
      contentDiv.innerHTML = '<p>🔍 Analyzing website...</p>';

      try {
        // Simulate website analysis (in real implementation, this would call an API)
        const analysis = await simulateWebsiteAnalysis(websiteUrl);
        
        // Format detected keywords for display
        const keywordsHtml = analysis.detectedKeywords.length > 0 
          ? analysis.detectedKeywords.map(kw => 
              `<span style="display: inline-block; background: ${kw.source === 'domain' ? '#dbeafe' : '#f0f9ff'}; color: ${kw.source === 'domain' ? '#1e40af' : '#0369a1'}; padding: 0.25rem 0.5rem; margin: 0.125rem; border-radius: 0.375rem; font-size: 0.75rem; font-weight: 500; border: 1px solid ${kw.source === 'domain' ? '#93c5fd' : '#7dd3fc'};">
                ${kw.keyword} ${kw.source === 'domain' ? '🌐' : '📄'}
              </span>`
            ).join('')
          : '<span style="color: #6b7280; font-style: italic;">No specific keywords detected</span>';

        contentDiv.innerHTML = `
          <p><strong>Detected Company:</strong> ${analysis.companyName}</p>
          <p><strong>Detected Industry:</strong> ${analysis.industry} <span style="color: #10b981; font-weight: bold;">(${analysis.confidence}% confidence)</span></p>
          <p><strong>Business Type:</strong> ${analysis.businessType}</p>
          <p><strong>Suggested Project:</strong> ${analysis.suggestedProject}</p>
          
          <div style="margin: 1rem 0; padding: 1rem; background: #f8fafc; border-radius: 0.5rem; border: 1px solid #e2e8f0;">
            <h4 style="margin: 0 0 0.75rem 0; color: #374151; font-size: 0.875rem; font-weight: 600;">🔍 Detected Keywords</h4>
            <div style="display: flex; flex-wrap: wrap; gap: 0.25rem;">
              ${keywordsHtml}
            </div>
            <p style="margin: 0.5rem 0 0 0; color: #6b7280; font-size: 0.75rem;">
              <span style="color: #1e40af;">🌐</span> Domain keywords (higher weight) | 
              <span style="color: #0369a1;">📄</span> Content keywords
            </p>
          </div>
          
          <button class="next-btn" onclick="applyWebsiteAnalysis('${analysis.companyName}', '${analysis.industry}', '${analysis.suggestedProject}')" style="background: #22c55e; margin-top: 0.5rem; padding: 0.5rem 1rem; font-size: 0.875rem;">Apply All Suggestions</button>
        `;
      } catch (error) {
        contentDiv.innerHTML = '<p>❌ Unable to analyze website. Please fill in the details manually.</p>';
      }
    }

    function generateSimulatedWebsiteContent(domain, mainDomain) {
      // Comprehensive content templates with realistic industry-specific content
      const contentTemplates = {
        'fitness': 'Welcome to our premium fitness equipment store. We offer state-of-the-art gym equipment, workout machines, weights, and training accessories for home and commercial use. Our extensive product range includes dumbbells, barbells, treadmills, exercise bikes, elliptical machines, rowing machines, and strength training equipment. Whether you\'re setting up a home gym or outfitting a fitness center, we provide professional-grade equipment for cardio, strength training, and rehabilitation. Our products are designed for durability, performance, and user safety.',
        'furniture': 'Discover our curated collection of modern furniture for home and office environments. We specialize in chairs, tables, sofas, beds, cabinets, and storage solutions. Our products feature high-quality materials including solid wood, premium leather, and designer fabrics. We offer contemporary and traditional designs for living rooms, bedrooms, dining areas, and commercial spaces. Our interior design services help create cohesive spaces that reflect your style and meet your functional needs.',
        'auto': 'Your trusted automotive partner for cars, trucks, motorcycles, and vehicle accessories. We offer comprehensive automotive services including parts, engine components, tires, wheels, and modification services. Our dealership features new and used vehicles from top manufacturers. We provide maintenance, repair, and customization services for all vehicle types. Our expert technicians ensure your vehicle performs at its best with genuine parts and professional service.',
        'jewelry': 'Exquisite jewelry collection featuring rings, necklaces, bracelets, earrings, and luxury watches. Our pieces showcase diamonds, gold, silver, and precious stones in both classic and contemporary designs. We offer engagement rings, wedding jewelry, designer pieces, and handmade accessories. Our certified gemologists ensure authenticity and quality. We provide custom design services and jewelry repair to create and maintain your most precious pieces.',
        'tech': 'Cutting-edge electronics and technology products for modern living. We offer computers, smartphones, tablets, gadgets, and smart home devices. Our inventory includes laptops, gaming consoles, headphones, speakers, cameras, drones, and digital accessories. We provide technical support, warranty services, and product recommendations. Our team stays current with the latest technology trends to help you find the perfect solutions for work, entertainment, and connectivity.',
        'fashion': 'Trendy fashion and clothing store featuring the latest apparel trends. Discover our collection of dresses, shirts, pants, shoes, and accessories for men, women, and children. We carry designer brands, boutique styles, and contemporary fashion pieces. Our stylists help you create complete looks for any occasion. We offer seasonal collections, formal wear, casual clothing, and statement accessories to express your unique style.',
        'home': 'Home and garden solutions for creating your perfect outdoor living space. We offer patio furniture, landscaping tools, plants, flowers, outdoor decor, and garden equipment. Our products help you design beautiful outdoor areas for relaxation and entertainment. We provide landscaping services, plant care advice, and seasonal decorating ideas. Create your ideal outdoor oasis with our quality products and expert guidance.',
        'beauty': 'Premium beauty and cosmetics products for your daily routine. Our collection includes makeup, skincare, hair care, perfumes, and beauty accessories. We offer professional-grade cosmetics, anti-aging treatments, and beauty tools. Our beauty experts provide personalized recommendations and application tips. We carry both drugstore and high-end brands to suit every budget and preference.',
        'sports': 'Sports and recreation equipment for active lifestyles. We provide gear for camping, hiking, fishing, hunting, golf, tennis, and team sports. Our products include outdoor equipment, sports accessories, and recreational gear. We support athletes of all levels with quality equipment and expert advice. Whether you\'re a weekend warrior or professional athlete, we have the gear you need to perform your best.',
        'industrial': 'Industrial machinery and manufacturing equipment solutions. We supply production tools, automation systems, robotics, and industrial components. Our products include pumps, motors, generators, conveyors, valves, and manufacturing equipment. We provide installation, maintenance, and technical support services. Our solutions help improve efficiency and productivity in manufacturing and industrial operations.',
        'medical': 'Medical devices and healthcare equipment for professional use. We provide diagnostic tools, therapeutic devices, surgical equipment, and patient care products. Our solutions support hospitals, clinics, dental practices, and healthcare professionals. We offer training, maintenance, and technical support for all our medical equipment. Our products meet strict quality and safety standards for healthcare environments.',
        'food': 'Culinary excellence with our restaurant and food service solutions. We offer cooking equipment, ingredients, recipes, and dining experiences. Our services include catering, meal planning, and culinary education. We source fresh, organic, and locally-produced ingredients. Our chefs create memorable dining experiences for special occasions and everyday meals.',
        'education': 'Educational resources and learning solutions for students and professionals. We offer courses, training programs, certifications, and educational materials. Our programs cover academic subjects, professional development, and skill-building. We provide online learning platforms, textbooks, and educational technology. Our instructors are experts in their fields, committed to student success and lifelong learning.',
        'real-estate': 'Real estate services for buying, selling, and investing in property. We offer residential and commercial real estate solutions, property management, and investment consulting. Our agents help you find the perfect home, office, or investment property. We provide market analysis, property valuations, and transaction support. Our expertise covers all aspects of real estate from first-time buyers to commercial investors.'
      };
      
      // Enhanced keyword matching for better content selection
      const keywordMappings = {
        'fitness': ['gym', 'fitness', 'workout', 'exercise', 'training', 'sport', 'athletic'],
        'furniture': ['furniture', 'chair', 'table', 'sofa', 'bed', 'home', 'office', 'decor'],
        'auto': ['car', 'auto', 'vehicle', 'motor', 'truck', 'automotive', 'dealership'],
        'jewelry': ['jewelry', 'jewellery', 'ring', 'necklace', 'bracelet', 'diamond', 'gold'],
        'tech': ['tech', 'electronic', 'computer', 'phone', 'gadget', 'device', 'digital'],
        'fashion': ['fashion', 'clothing', 'apparel', 'dress', 'shirt', 'shoes', 'style'],
        'home': ['home', 'garden', 'outdoor', 'patio', 'landscaping', 'plants', 'decor'],
        'beauty': ['beauty', 'cosmetics', 'makeup', 'skincare', 'hair', 'perfume'],
        'sports': ['sports', 'recreation', 'outdoor', 'camping', 'hiking', 'fishing'],
        'industrial': ['industrial', 'machinery', 'equipment', 'manufacturing', 'factory'],
        'medical': ['medical', 'healthcare', 'device', 'hospital', 'clinic', 'health'],
        'food': ['food', 'restaurant', 'cafe', 'coffee', 'cooking', 'dining'],
        'education': ['education', 'school', 'university', 'learning', 'course', 'training'],
        'real-estate': ['real estate', 'property', 'house', 'apartment', 'rent', 'buy']
      };
      
      // Special cases for known domains
      if (domain.includes('atletica') || mainDomain.includes('atletica')) {
        return contentTemplates['fitness'];
      }
      
      // Find the best matching template based on domain keywords
      let bestMatch = { category: 'default', score: 0 };
      
      for (const [category, keywords] of Object.entries(keywordMappings)) {
        let score = 0;
        for (const keyword of keywords) {
          if (domain.includes(keyword) || mainDomain.includes(keyword)) {
            score += 1;
          }
        }
        if (score > bestMatch.score) {
          bestMatch = { category, score };
        }
      }
      
      // Return the best matching content or default
      if (bestMatch.score > 0 && contentTemplates[bestMatch.category]) {
        return contentTemplates[bestMatch.category];
      }
      
      // Default content for unknown industries
      return `Welcome to ${mainDomain}. We provide quality products and services for our customers. Our company specializes in innovative solutions, customer satisfaction, and professional service. We are committed to excellence and building long-term relationships with our clients.`;
    }

    function getExpandedIndustryLibrary() {
      return {
        'fitness-equipment': {
          primary: ['gym', 'fitness', 'workout', 'exercise', 'training', 'equipment', 'weights', 'cardio', 'strength', 'gymnasium', 'fitness center', 'health club', 'sports club', 'athletic club', 'wellness center', 'training facility', 'exercise studio', 'fitness studio', 'gym equipment', 'fitness equipment', 'workout equipment', 'exercise equipment', 'training equipment', 'strength training', 'cardio training', 'fitness training', 'personal training', 'group training', 'fitness class', 'exercise class', 'workout class', 'training class', 'fitness program', 'exercise program', 'workout program', 'training program', 'fitness routine', 'exercise routine', 'workout routine', 'training routine'],
          secondary: ['studio', 'home gym', 'fitness center', 'personal training', 'crossfit', 'yoga', 'pilates', 'spinning', 'aerobics', 'zumba', 'boxing', 'martial arts', 'kickboxing', 'taekwondo', 'karate', 'judo', 'wrestling', 'bodybuilding', 'powerlifting', 'weightlifting', 'strongman', 'functional fitness', 'hiit', 'high intensity', 'interval training', 'circuit training', 'resistance training', 'flexibility training', 'balance training', 'coordination training', 'endurance training', 'speed training', 'agility training', 'plyometric training', 'isometric training', 'isotonic training', 'isokinetic training', 'rehabilitation', 'physical therapy', 'physiotherapy', 'sports therapy', 'injury prevention', 'recovery', 'rehabilitation equipment', 'therapeutic equipment', 'medical fitness', 'clinical fitness', 'adaptive fitness', 'inclusive fitness', 'senior fitness', 'youth fitness', 'kids fitness', 'family fitness', 'corporate fitness', 'workplace fitness', 'office fitness', 'employee wellness', 'corporate wellness', 'workplace wellness', 'employee fitness', 'corporate fitness program', 'workplace fitness program', 'employee wellness program', 'corporate wellness program'],
          tertiary: ['treadmill', 'exercise bike', 'stationary bike', 'recumbent bike', 'upright bike', 'spin bike', 'indoor cycling', 'elliptical trainer', 'cross trainer', 'stepper', 'step machine', 'stair climber', 'rowing machine', 'ergometer', 'rowing erg', 'concept2', 'water rower', 'dumbbells', 'barbells', 'kettlebells', 'medicine balls', 'resistance bands', 'resistance tubes', 'cables', 'pulleys', 'weight plates', 'bumper plates', 'olympic plates', 'standard plates', 'weight stack', 'selectorized', 'pin loaded', 'plate loaded', 'free weights', 'machines', 'weight machines', 'strength machines', 'cardio machines', 'functional trainers', 'cable machines', 'multi gym', 'home gym', 'all in one', 'power rack', 'squat rack', 'cage', 'half rack', 'smith machine', 'leg press', 'chest press', 'shoulder press', 'lat pulldown', 'seated row', 'cable crossover', 'functional trainer', 'cable machine', 'pulley system', 'adjustable bench', 'incline bench', 'decline bench', 'flat bench', 'preacher bench', 'dip station', 'pull up bar', 'chin up bar', 'parallel bars', 'dip bars', 'push up bars', 'ab bench', 'ab board', 'ab roller', 'ab wheel', 'crunch machine', 'back extension', 'hyperextension', 'glute ham raise', 'reverse hyper', 'gymnastic rings', 'trx', 'suspension trainer', 'battle ropes', 'agility ladder', 'cones', 'plyometric boxes', 'jump boxes', 'plyo boxes', 'step platforms', 'aerobic steps', 'balance boards', 'bosu ball', 'stability ball', 'exercise ball', 'yoga ball', 'medicine ball', 'wall ball', 'sandbag', 'foam roller', 'massage roller', 'lacrosse ball', 'tennis ball', 'golf ball', 'trigger point', 'myofascial release', 'stretching', 'flexibility', 'mobility', 'yoga mat', 'pilates mat', 'exercise mat', 'gym mat', 'floor mat', 'rubber mat', 'interlocking tiles', 'gym flooring', 'rubber flooring', 'sport flooring', 'synthetic flooring', 'vinyl flooring', 'carpet tiles', 'turf', 'artificial turf', 'field turf', 'sport turf', 'outdoor equipment', 'functional fitness', 'crossfit', 'hiit', 'tabata', 'amrap', 'emom', 'for time', 'rounds', 'reps', 'sets', 'circuit', 'station', 'workout station', 'exercise station', 'training station', 'fitness station', 'gym station', 'equipment station', 'workout area', 'exercise area', 'training area', 'fitness area', 'gym area', 'equipment area', 'workout space', 'exercise space', 'training space', 'fitness space', 'gym space', 'equipment space', 'home gym', 'garage gym', 'basement gym', 'spare room', 'dedicated space', 'workout room', 'exercise room', 'training room', 'fitness room', 'gym room', 'equipment room', 'studio', 'fitness studio', 'exercise studio', 'training studio', 'workout studio', 'yoga studio', 'pilates studio', 'dance studio', 'martial arts studio', 'boxing gym', 'crossfit box', 'crossfit gym', 'crossfit affiliate'],
          business: ['fitness', 'gym', 'training', 'wellness', 'health', 'sport', 'athletic', 'exercise', 'fitness center', 'gym', 'health club', 'sports club', 'athletic club', 'wellness center', 'training facility', 'exercise studio', 'fitness studio', 'gym equipment', 'fitness equipment', 'workout equipment', 'exercise equipment', 'training equipment', 'strength training', 'cardio training', 'fitness training', 'personal training', 'group training', 'fitness class', 'exercise class', 'workout class', 'training class', 'fitness program', 'exercise program', 'workout program', 'training program', 'fitness routine', 'exercise routine', 'workout routine', 'training routine']
        },
        'furniture': {
          primary: ['furniture', 'chair', 'table', 'sofa', 'desk', 'bed', 'cabinet', 'storage', 'furnishing', 'furnishings', 'home furniture', 'office furniture', 'living room furniture', 'bedroom furniture', 'dining room furniture', 'kitchen furniture', 'bathroom furniture', 'outdoor furniture', 'garden furniture', 'patio furniture', 'commercial furniture', 'contract furniture', 'hospitality furniture', 'hotel furniture', 'restaurant furniture', 'retail furniture', 'corporate furniture', 'workplace furniture', 'educational furniture', 'school furniture', 'university furniture', 'healthcare furniture', 'medical furniture', 'dental furniture', 'clinic furniture', 'hospital furniture', 'senior living furniture', 'assisted living furniture', 'residential furniture', 'apartment furniture', 'condo furniture', 'house furniture', 'home decor', 'interior design', 'interior decorating', 'room design', 'space planning', 'furniture design', 'furniture manufacturing', 'furniture retail', 'furniture store', 'furniture shop', 'furniture showroom', 'furniture gallery', 'furniture warehouse', 'furniture outlet', 'furniture clearance', 'furniture sale', 'furniture discount', 'furniture deals', 'furniture specials', 'furniture promotions', 'furniture offers', 'furniture clearance sale', 'furniture liquidation', 'furniture closeout', 'furniture overstock', 'furniture surplus', 'furniture inventory', 'furniture stock', 'furniture supply', 'furniture wholesale', 'furniture distributor', 'furniture dealer', 'furniture retailer', 'furniture vendor', 'furniture supplier', 'furniture manufacturer', 'furniture maker', 'furniture craftsman', 'furniture artisan', 'furniture designer', 'furniture architect', 'furniture engineer', 'furniture specialist', 'furniture expert', 'furniture consultant', 'furniture advisor', 'furniture planner', 'furniture coordinator', 'furniture manager', 'furniture director', 'furniture buyer', 'furniture purchaser', 'furniture procurement', 'furniture sourcing', 'furniture acquisition', 'furniture investment', 'furniture purchase', 'furniture buying', 'furniture shopping', 'furniture selection', 'furniture choice', 'furniture decision', 'furniture preference', 'furniture taste', 'furniture style', 'furniture fashion', 'furniture trend', 'furniture latest', 'furniture new', 'furniture modern', 'furniture contemporary', 'furniture traditional', 'furniture classic', 'furniture vintage', 'furniture antique', 'furniture retro', 'furniture mid century', 'furniture industrial', 'furniture rustic', 'furniture farmhouse', 'furniture shabby chic', 'furniture bohemian', 'furniture minimalist', 'furniture maximalist', 'furniture eclectic', 'furniture transitional', 'furniture scandinavian', 'furniture mediterranean', 'furniture asian', 'furniture oriental', 'furniture western', 'furniture european', 'furniture american', 'furniture canadian', 'furniture british', 'furniture french', 'furniture italian', 'furniture german', 'furniture spanish', 'furniture portuguese', 'furniture dutch', 'furniture belgian', 'furniture swiss', 'furniture austrian', 'furniture polish', 'furniture czech', 'furniture hungarian', 'furniture romanian', 'furniture bulgarian', 'furniture croatian', 'furniture serbian', 'furniture slovenian', 'furniture slovak', 'furniture lithuanian', 'furniture latvian', 'furniture estonian', 'furniture finnish', 'furniture swedish', 'furniture norwegian', 'furniture danish', 'furniture icelandic', 'furniture irish', 'furniture scottish', 'furniture welsh', 'furniture english', 'furniture canadian', 'furniture australian', 'furniture new zealand', 'furniture south african', 'furniture brazilian', 'furniture argentinian', 'furniture chilean', 'furniture colombian', 'furniture peruvian', 'furniture venezuelan', 'furniture ecuadorian', 'furniture bolivian', 'furniture paraguayan', 'furniture uruguayan', 'furniture guyanese', 'furniture surinamese', 'furniture trinidadian', 'furniture jamaican', 'furniture cuban', 'furniture dominican', 'furniture haitian', 'furniture puerto rican', 'furniture mexican', 'furniture guatemalan', 'furniture belizean', 'furniture honduran', 'furniture salvadoran', 'furniture nicaraguan', 'furniture costa rican', 'furniture panamanian', 'furniture colombian', 'furniture venezuelan', 'furniture guyana', 'furniture suriname', 'furniture trinidad', 'furniture tobago', 'furniture jamaica', 'furniture cuba', 'furniture dominican republic', 'furniture haiti', 'furniture puerto rico', 'furniture mexico', 'furniture guatemala', 'furniture belize', 'furniture honduras', 'furniture el salvador', 'furniture nicaragua', 'furniture costa rica', 'furniture panama'],
          secondary: ['office', 'home', 'living', 'dining', 'bedroom', 'kitchen', 'modern', 'contemporary', 'seating', 'dining', 'upholstery', 'outdoor', 'garden', 'patio', 'commercial', 'contract', 'wood', 'leather', 'fabric', 'design', 'interior', 'decor', 'furnishing', 'seating', 'dining', 'upholstery', 'outdoor', 'garden', 'patio', 'commercial', 'contract'],
          tertiary: ['wood', 'leather', 'fabric', 'design', 'interior', 'decor', 'furnishing', 'seating', 'dining', 'upholstery', 'outdoor', 'garden', 'patio', 'commercial', 'contract'],
          business: ['furniture', 'furnishing', 'interior', 'design', 'home', 'office', 'decor']
        }
      };
    }

    async function simulateWebsiteAnalysis(url) {
      // Simulate API delay
      await new Promise(resolve => setTimeout(resolve, 1500));
      
      // Extract domain for analysis
      const domain = url.replace(/^https?:\/\//, '').replace(/^www\./, '').split('/')[0].toLowerCase();
      
      // Use expanded industry keyword library and merge with additional industries
      const expandedLibrary = getExpandedIndustryLibrary();
      const additionalIndustries = {
        'automotive': {
          primary: ['car', 'auto', 'vehicle', 'truck', 'motorcycle', 'parts', 'accessories'],
          secondary: ['tires', 'wheels', 'engine', 'transmission', 'brake', 'exhaust', 'interior', 'exterior'],
          tertiary: ['performance', 'racing', 'luxury', 'sport', 'electric', 'hybrid', 'fuel', 'oil', 'maintenance', 'dealership', 'garage', 'modification', 'tuning', 'SUV', 'sedan', 'coupe'],
          business: ['automotive', 'auto', 'vehicle', 'car', 'motor', 'transport', 'mobility']
        },
        'electronics': {
          primary: ['electronics', 'computer', 'laptop', 'phone', 'tablet', 'camera', 'audio'],
          secondary: ['speaker', 'headphone', 'gaming', 'tech', 'software', 'hardware', 'digital'],
          tertiary: ['smart', 'wireless', 'bluetooth', 'wifi', 'battery', 'charger', 'usb', 'hdmi', 'display', 'gadget', 'device', 'console', 'accessory', 'component', 'circuit', 'drone'],
          business: ['electronics', 'technology', 'tech', 'digital', 'computer', 'electronic', 'device']
        },
        'fashion': {
          primary: ['fashion', 'clothing', 'apparel', 'shirt', 'dress', 'pants', 'shoes'],
          secondary: ['accessories', 'jewelry', 'watch', 'bag', 'hat', 'jacket', 'coat', 'suit'],
          tertiary: ['casual', 'formal', 'designer', 'brand', 'style', 'trend', 'outfit', 'wear', 'garment', 'boutique', 'handbag', 'purse', 'jeans', 'skirt', 'blouse', 'sweater', 'boots', 'sneakers'],
          business: ['fashion', 'clothing', 'apparel', 'fashion', 'style', 'garment', 'textile']
        },
        'home-garden': {
          primary: ['garden', 'outdoor', 'patio', 'lawn', 'plants', 'flowers', 'tools'],
          secondary: ['decor', 'lighting', 'furniture', 'bbq', 'grill', 'pool', 'spa', 'landscaping'],
          tertiary: ['irrigation', 'seeds', 'soil', 'pots', 'planters', 'outdoor', 'yard', 'greenhouse', 'nursery', 'hot tub', 'shed', 'equipment'],
          business: ['garden', 'outdoor', 'landscaping', 'nursery', 'horticulture', 'green', 'plant']
        },
        'beauty-cosmetics': {
          primary: ['beauty', 'cosmetics', 'makeup', 'skincare', 'hair', 'nail', 'perfume'],
          secondary: ['fragrance', 'lotion', 'cream', 'serum', 'cleanser', 'toner', 'moisturizer'],
          tertiary: ['lipstick', 'foundation', 'mascara', 'eyeshadow', 'blush', 'bronzer', 'concealer', 'primer'],
          business: ['beauty', 'cosmetics', 'skincare', 'makeup', 'beauty', 'cosmetic', 'aesthetic']
        },
        'food-beverage': {
          primary: ['food', 'restaurant', 'cafe', 'coffee', 'tea', 'wine', 'beer'],
          secondary: ['cooking', 'recipe', 'ingredients', 'organic', 'natural', 'healthy', 'diet'],
          tertiary: ['nutrition', 'beverage', 'drink', 'snack', 'meal', 'dining', 'cuisine', 'chef', 'kitchen'],
          business: ['food', 'restaurant', 'cafe', 'dining', 'culinary', 'beverage', 'foodservice']
        },
        'healthcare': {
          primary: ['health', 'medical', 'pharmacy', 'doctor', 'clinic', 'hospital', 'medicine'],
          secondary: ['drug', 'treatment', 'therapy', 'wellness', 'dental', 'vision', 'mental'],
          tertiary: ['counseling', 'rehabilitation', 'surgery', 'diagnosis', 'prescription', 'care', 'patient', 'nurse', 'device', 'equipment', 'diagnostic', 'therapeutic', 'surgical', 'orthopedic', 'monitoring'],
          business: ['healthcare', 'medical', 'health', 'medical', 'clinical', 'therapeutic', 'wellness']
        },
        'education': {
          primary: ['education', 'school', 'university', 'college', 'learning', 'course', 'training'],
          secondary: ['certification', 'degree', 'student', 'teacher', 'academic', 'research', 'study'],
          tertiary: ['book', 'textbook', 'online', 'e-learning', 'tutoring', 'workshop', 'seminar', 'lecture'],
          business: ['education', 'learning', 'academic', 'educational', 'training', 'school', 'university']
        },
        'real-estate': {
          primary: ['real estate', 'property', 'house', 'apartment', 'condo', 'rent', 'buy', 'sell'],
          secondary: ['mortgage', 'investment', 'commercial', 'residential', 'land', 'development'],
          tertiary: ['construction', 'home', 'office', 'retail', 'warehouse', 'hotel', 'building', 'realtor'],
          business: ['real estate', 'property', 'realty', 'housing', 'development', 'construction', 'property']
        },
        'jewelry': {
          primary: ['jewelry', 'jewellery', 'ring', 'necklace', 'bracelet', 'diamond', 'gold', 'silver'],
          secondary: ['gem', 'watch', 'earring', 'pendant', 'chain', 'crystal', 'pearl'],
          tertiary: ['engagement', 'wedding', 'luxury', 'precious', 'stones', 'designer', 'handmade'],
          business: ['jewelry', 'jewellery', 'luxury', 'precious', 'gem', 'diamond', 'gold']
        },
        'sports-recreation': {
          primary: ['sports', 'recreation', 'outdoor', 'camping', 'hiking', 'fishing', 'hunting'],
          secondary: ['golf', 'tennis', 'soccer', 'basketball', 'football', 'baseball', 'hockey'],
          tertiary: ['swimming', 'cycling', 'running', 'marathon', 'triathlon', 'equipment', 'gear'],
          business: ['sports', 'recreation', 'outdoor', 'athletic', 'sporting', 'fitness']
        },
        'industrial-machinery': {
          primary: ['industrial', 'machinery', 'equipment', 'manufacturing', 'factory', 'production'],
          secondary: ['tools', 'machines', 'automation', 'robotics', 'conveyor', 'pump', 'motor'],
          tertiary: ['generator', 'compressor', 'valve', 'pipeline', 'construction', 'engineering'],
          business: ['industrial', 'machinery', 'manufacturing', 'equipment', 'industrial', 'machinery']
        }
      };
      
      // Merge expanded library with additional industries
      const industryLibrary = { ...expandedLibrary, ...additionalIndustries };

      let detectedIndustry = 'other';
      let businessType = 'E-commerce';
      let suggestedProject = '3D product configurator with customization options';
      let companyName = '';
      let confidence = 0;

      // Extract company name from domain
      const domainParts = domain.split('.');
      const mainDomain = domainParts[0];
      
      // Clean up company name
      companyName = mainDomain
        .replace(/[-_]/g, ' ')  // Replace hyphens and underscores with spaces
        .split(' ')
        .map(word => word.charAt(0).toUpperCase() + word.slice(1))  // Capitalize each word
        .join(' ');

      // Simulate website content analysis (in real implementation, this would fetch and analyze actual content)
      const simulatedContent = generateSimulatedWebsiteContent(domain, mainDomain);
      console.log('🔍 Generated content for', domain, ':', simulatedContent.substring(0, 100) + '...');
      
      // Analyze both domain and simulated content using weighted keyword system
      let bestMatch = { industry: 'other', score: 0, detectedKeywords: [] };
      let allDetectedKeywords = [];
      
      for (const [industry, categories] of Object.entries(industryLibrary)) {
        let score = 0;
        let industryKeywords = [];
        
        // Check domain for business terms (highest weight)
        for (const keyword of categories.business) {
          if (domain.includes(keyword)) {
            score += 5;
            industryKeywords.push({ keyword, source: 'domain', weight: 5, category: 'business' });
          }
        }
        
        // Check domain for primary terms
        for (const keyword of categories.primary) {
          if (domain.includes(keyword)) {
            score += 3;
            industryKeywords.push({ keyword, source: 'domain', weight: 3, category: 'primary' });
          }
        }
        
        // Check simulated content for all categories
        const contentText = simulatedContent.toLowerCase();
        for (const [category, keywords] of Object.entries(categories)) {
          if (category === 'business') continue; // Skip business terms in content analysis
          
          for (const keyword of keywords) {
            if (contentText.includes(keyword)) {
              const weight = category === 'primary' ? 3 : category === 'secondary' ? 2 : 1;
              score += weight;
              industryKeywords.push({ 
                keyword, 
                source: 'content', 
                weight, 
                category 
              });
              console.log('🎯 Found keyword:', keyword, 'in', industry, 'category:', category, 'weight:', weight);
            }
          }
        }
        
        if (score > bestMatch.score) {
          bestMatch = { industry, score, detectedKeywords: industryKeywords };
        }
        
        // Collect all detected keywords for display
        allDetectedKeywords = allDetectedKeywords.concat(industryKeywords);
      }
      
      detectedIndustry = bestMatch.industry;
      confidence = Math.min(100, (bestMatch.score / 5) * 100); // Convert to percentage
      
      // Remove duplicates and sort by weight
      const uniqueKeywords = allDetectedKeywords.reduce((acc, current) => {
        const existing = acc.find(item => item.keyword === current.keyword);
        if (!existing) {
          acc.push(current);
        } else if (current.weight > existing.weight) {
          acc[acc.findIndex(item => item.keyword === current.keyword)] = current;
        }
        return acc;
      }, []);
      
      const detectedKeywords = uniqueKeywords
        .sort((a, b) => b.weight - a.weight)
        .slice(0, 10); // Show top 10 keywords

      // Get suggested project based on detected industry
      const suggestions = industryProjectTemplates[detectedIndustry] || industryProjectTemplates['other'];
      suggestedProject = suggestions[0];

      // Determine business type based on common patterns
      if (domain.includes('shop') || domain.includes('store') || domain.includes('buy') || domain.includes('ecommerce')) {
        businessType = 'E-commerce';
      } else if (domain.includes('b2b') || domain.includes('business') || domain.includes('corporate')) {
        businessType = 'B2B';
      } else if (domain.includes('showroom') || domain.includes('gallery') || domain.includes('exhibition')) {
        businessType = 'Showroom';
      } else if (domain.includes('configurator') || domain.includes('customize') || domain.includes('3d')) {
        businessType = '3D Configurator';
      }

      return {
        companyName: companyName,
        industry: detectedIndustry,
        businessType: businessType,
        suggestedProject: suggestedProject,
        confidence: Math.round(confidence),
        detectedKeywords: detectedKeywords
      };
    }

    function applyWebsiteAnalysis(companyName, industry, projectDescription) {
      document.getElementById('companyName').value = companyName;
      document.getElementById('industry').value = industry;
      document.getElementById('projectDescription').value = projectDescription;
      updateProjectSuggestions();
    }

    function updateProjectSuggestions() {
      const industry = document.getElementById('industry').value;
      const suggestionsDiv = document.getElementById('projectSuggestions');
      const contentDiv = document.getElementById('suggestionsContent');
      
      if (!industry) {
        suggestionsDiv.style.display = 'none';
        return;
      }

      const suggestions = industryProjectTemplates[industry] || industryProjectTemplates['other'];
      
      contentDiv.innerHTML = suggestions.map((suggestion, index) => 
        `<div class="checkbox-item" style="margin-bottom: 0.5rem;">
          <input type="radio" name="projectSuggestion" id="suggestion${index}" value="${suggestion}" onchange="selectProjectSuggestion('${suggestion}')">
          <label for="suggestion${index}" style="cursor: pointer;">${suggestion}</label>
        </div>`
      ).join('');
      
      suggestionsDiv.style.display = 'block';
    }

    function selectProjectSuggestion(suggestion) {
      document.getElementById('projectDescription').value = suggestion;
    }

    // Existing configuration analysis
    async function analyzeExistingConfig() {
      const configUrl = document.getElementById('existingConfig').value;
      if (!configUrl) return;

      const analysisDiv = document.getElementById('configAnalysis');
      const contentDiv = document.getElementById('configAnalysisContent');
      
      // Show loading state
      analysisDiv.style.display = 'block';
      contentDiv.innerHTML = '<p>🔧 Analyzing existing configuration...</p>';

      try {
        // Simulate configuration analysis
        const analysis = await simulateConfigAnalysis(configUrl);
        
        contentDiv.innerHTML = `
          <p><strong>Configuration Type:</strong> ${analysis.configType}</p>
          <p><strong>Detected Features:</strong> ${analysis.features.join(', ')}</p>
          <p><strong>Complexity Level:</strong> ${analysis.complexity}</p>
          <p><strong>Recommendations:</strong> ${analysis.recommendations}</p>
          <button class="next-btn" onclick="applyConfigAnalysis('${analysis.configType}', '${analysis.features.join('|')}', '${analysis.complexity}')" style="background: #22c55e; margin-top: 0.5rem; padding: 0.5rem 1rem; font-size: 0.875rem;">Apply Configuration Insights</button>
        `;
      } catch (error) {
        contentDiv.innerHTML = '<p>❌ Unable to analyze configuration. Please describe your current setup manually.</p>';
      }
    }

    async function simulateConfigAnalysis(url) {
      // Simulate API delay
      await new Promise(resolve => setTimeout(resolve, 2000));
      
      // Extract domain and analyze URL patterns
      const domain = url.replace(/^https?:\/\//, '').replace(/^www\./, '').split('/')[0].toLowerCase();
      const pathSegments = url.split('/').filter(segment => segment.length > 0);
      
      // Analyze URL patterns for configuration features
      const configFeatures = [];
      const complexityLevels = {
        'basic': 'Simple product viewer with basic options',
        'intermediate': 'Configurator with multiple options and materials',
        'advanced': 'Complex configurator with multiple product lines and advanced features'
      };
      
      let configType = 'Product Configurator';
      let complexity = 'intermediate';
      let features = [];
      
      // Analyze URL for configuration patterns
      if (url.includes('configurator') || url.includes('configure')) {
        configType = 'Interactive Configurator';
        features.push('Interactive Options');
      }
      
      if (url.includes('variant=') || url.includes('options=')) {
        features.push('Variant Selection');
        complexity = 'advanced';
      }
      
      if (url.includes('material') || url.includes('color') || url.includes('finish')) {
        features.push('Material Customization');
      }
      
      if (url.includes('size') || url.includes('dimension')) {
        features.push('Size Options');
      }
      
      if (url.includes('3d') || url.includes('viewer') || url.includes('preview')) {
        features.push('3D Visualization');
      }
      
      // Analyze specific domains for known patterns
      if (domain.includes('atletica')) {
        configType = 'Fitness Equipment Configurator';
        features = ['Size Selection', 'Weight Stack Options', 'Accessory Combinations', 'Color Variants', 'Modular Components'];
        complexity = 'advanced';
      } else if (domain.includes('furniture') || domain.includes('chair') || domain.includes('sofa')) {
        configType = 'Furniture Configurator';
        features = ['Material Selection', 'Color Options', 'Size Variations', 'Fabric Choices'];
        complexity = 'intermediate';
      } else if (domain.includes('car') || domain.includes('auto') || domain.includes('vehicle')) {
        configType = 'Automotive Configurator';
        features = ['Exterior Colors', 'Interior Options', 'Trim Levels', 'Accessories'];
        complexity = 'advanced';
      }
      
      // Generate recommendations based on analysis
      let recommendations = '';
      if (complexity === 'advanced') {
        recommendations = 'Consider using Threekit\'s advanced configurator features with multiple product lines and complex option dependencies.';
      } else if (complexity === 'intermediate') {
        recommendations = 'Threekit\'s standard configurator will work well for your current setup with room for expansion.';
      } else {
        recommendations = 'Start with Threekit\'s basic viewer and gradually add configuration options.';
      }
      
      // Store detected features globally
      detectedFeatures = features.length > 0 ? features : ['Basic Product Display'];
      detectedConfigType = configType;
      detectedComplexity = complexityLevels[complexity];

      return {
        configType: configType,
        features: detectedFeatures,
        complexity: complexityLevels[complexity],
        recommendations: recommendations
      };
    }

    function applyConfigAnalysis(configType, features, complexity) {
      // Store detected features globally
      detectedFeatures = Array.isArray(features) ? features : features.split('|');
      detectedConfigType = configType;
      detectedComplexity = complexity;
      
      // Update project description based on configuration analysis
      const projectDescription = document.getElementById('projectDescription');
      const companyName = document.getElementById('companyName').value;
      const industry = document.getElementById('industry').value;
      
      // Generate a comprehensive description with detected features
      let newDescription = '';
      
      if (companyName && industry) {
        newDescription = `Interactive 3D configurator for ${companyName.toLowerCase()} ${industry.replace('-', ' ')} products`;
      } else if (industry) {
        newDescription = `Interactive 3D configurator for ${industry.replace('-', ' ')} products`;
      } else {
        newDescription = 'Interactive 3D product configurator';
      }
      
      // Add existing configuration context
      newDescription += ' to upgrade existing configuration system';
      
      // Add detected features (business-focused only)
      if (detectedFeatures.length > 0 && detectedFeatures[0] !== 'Basic Product Display') {
        // Filter out technical terms and keep only business features
        const businessFeatures = detectedFeatures.filter(feature => 
          !feature.toLowerCase().includes('texture') && 
          !feature.toLowerCase().includes('uv') &&
          !feature.toLowerCase().includes('export') &&
          !feature.toLowerCase().includes('material') &&
          !feature.toLowerCase().includes('diffuse') &&
          !feature.toLowerCase().includes('albedo') &&
          !feature.toLowerCase().includes('normal') &&
          !feature.toLowerCase().includes('bump') &&
          !feature.toLowerCase().includes('roughness') &&
          !feature.toLowerCase().includes('metallic') &&
          !feature.toLowerCase().includes('occlusion') &&
          !feature.toLowerCase().includes('emission') &&
          !feature.toLowerCase().includes('alpha')
        );
        
        if (businessFeatures.length > 0) {
          const detectedFeatureText = businessFeatures.join(', ').toLowerCase();
          newDescription += ` featuring ${detectedFeatureText}`;
        }
      }
      
      // Add additional context based on complexity (business-focused)
      if (complexity.includes('advanced')) {
        newDescription += ' with advanced customization options and real-time visualization';
      } else if (complexity.includes('intermediate')) {
        newDescription += ' with material selection and configuration options';
      }
      
      projectDescription.value = newDescription;
      
      // Show success message
      const analysisDiv = document.getElementById('configAnalysis');
      const contentDiv = document.getElementById('configAnalysisContent');
      contentDiv.innerHTML = `
        <div style="background: #f0fdf4; padding: 1rem; border-radius: 8px; border-left: 4px solid #22c55e;">
          <p>✅ Configuration insights applied! Your project description has been updated based on your existing setup.</p>
          <p><strong>Detected Features:</strong> ${detectedFeatures.join(', ')}</p>
          <p><strong>Generated Description:</strong> "${newDescription}"</p>
        </div>
      `;
    }

    // Smart description generation using all collected data
    function generateSmartDescription() {
      const companyName = document.getElementById('companyName').value;
      const industry = document.getElementById('industry').value;
      const existingConfig = document.getElementById('existingConfig').value;
      const requirements = [];
      const targetPlatform = document.getElementById('targetPlatform').value;
      const assetOrganization = document.getElementById('assetOrganization').value;
      const materialApproach = document.getElementById('materialApproach').value;
      const exportFormat = document.getElementById('exportFormat').value;
      const textureRequirements = [];
      
      // Collect requirements
      document.querySelectorAll('#step3-section input[type="checkbox"]:checked').forEach(checkbox => {
        requirements.push(checkbox.value);
      });
      
      // Collect texture requirements
      document.querySelectorAll('#step5-section input[type="checkbox"]:checked').forEach(checkbox => {
        textureRequirements.push(checkbox.value);
      });
      
      // Generate smart description based on all collected data
      let description = '';
      
      // Start with company/industry context
      if (companyName && industry) {
        description += `Interactive 3D configurator for ${companyName.toLowerCase()} ${industry.replace('-', ' ')} products`;
      } else if (industry) {
        description += `Interactive 3D configurator for ${industry.replace('-', ' ')} products`;
      } else {
        description += 'Interactive 3D product configurator';
      }
      
      // Add existing configuration context
      if (existingConfig) {
        description += ' to upgrade existing configuration system';
      }
      
      // Add detected features from configuration analysis (business-focused only)
      if (detectedFeatures.length > 0 && detectedFeatures[0] !== 'Basic Product Display') {
        // Filter out technical terms and keep only business features
        const businessFeatures = detectedFeatures.filter(feature => 
          !feature.toLowerCase().includes('texture') && 
          !feature.toLowerCase().includes('uv') &&
          !feature.toLowerCase().includes('export') &&
          !feature.toLowerCase().includes('material') &&
          !feature.toLowerCase().includes('diffuse') &&
          !feature.toLowerCase().includes('albedo') &&
          !feature.toLowerCase().includes('normal') &&
          !feature.toLowerCase().includes('bump') &&
          !feature.toLowerCase().includes('roughness') &&
          !feature.toLowerCase().includes('metallic') &&
          !feature.toLowerCase().includes('occlusion') &&
          !feature.toLowerCase().includes('emission') &&
          !feature.toLowerCase().includes('alpha')
        );
        
        if (businessFeatures.length > 0) {
          const detectedFeatureText = businessFeatures.join(', ').toLowerCase();
          description += ` featuring ${detectedFeatureText}`;
        }
      }
      
      // Add key features based on requirements (business-focused only)
      const featureDescriptions = [];
      
      if (requirements.includes('Product configurator with multiple options')) {
        featureDescriptions.push('multiple customization options');
      }
      if (requirements.includes('Material customization')) {
        featureDescriptions.push('material and color selection');
      }
      if (requirements.includes('Interactive animations')) {
        featureDescriptions.push('interactive animations');
      }
      if (requirements.includes('Mobile optimization')) {
        featureDescriptions.push('mobile-responsive design');
      }
      if (requirements.includes('AR compatibility')) {
        featureDescriptions.push('AR capabilities');
      }
      if (requirements.includes('VR experience')) {
        featureDescriptions.push('VR experience');
      }
      if (requirements.includes('High performance requirements')) {
        featureDescriptions.push('high-performance optimization');
      }
      if (requirements.includes('E-commerce integration')) {
        featureDescriptions.push('e-commerce integration');
      }
      
      // Combine features (no technical details)
      if (featureDescriptions.length > 0) {
        if (featureDescriptions.length === 1) {
          description += ` with ${featureDescriptions[0]}`;
        } else if (featureDescriptions.length === 2) {
          description += ` with ${featureDescriptions[0]} and ${featureDescriptions[1]}`;
        } else {
          const lastFeature = featureDescriptions.pop();
          description += ` with ${featureDescriptions.join(', ')}, and ${lastFeature}`;
        }
      }
      
      // Set the generated description
      document.getElementById('projectDescription').value = description;
      
      // Show success message
      const projectSuggestions = document.getElementById('projectSuggestions');
      const suggestionsContent = document.getElementById('suggestionsContent');
      
      suggestionsContent.innerHTML = `
        <div style="background: #f0fdf4; padding: 1rem; border-radius: 8px; border-left: 4px solid #22c55e;">
          <p>✅ Smart description generated based on your questionnaire answers!</p>
          <p><strong>Generated:</strong> "${description}"</p>
        </div>
      `;
      projectSuggestions.style.display = 'block';
    }

    // Naming convention functions
    function applyNamingConvention() {
      const select = document.getElementById('namingConventionSelect');
      const input = document.getElementById('namingConvention');
      
      if (select.value && select.value !== 'custom') {
        input.value = select.value;
        input.style.backgroundColor = '#f0fdf4';
        input.style.borderColor = '#22c55e';
        setTimeout(() => {
          input.style.backgroundColor = '';
          input.style.borderColor = '';
        }, 2000);
      } else if (select.value === 'custom') {
        input.value = '';
        input.focus();
        input.placeholder = 'Enter your custom naming convention...';
      }
    }

    function showNamingExamples() {
      const examplesDiv = document.getElementById('namingExamples');
      const contentDiv = document.getElementById('examplesContent');
      
      if (examplesDiv.style.display === 'none') {
        contentDiv.innerHTML = `
          <div style="margin-bottom: 1rem;">
            <h5>🏆 Threekit Recommended (ProductType_PartName):</h5>
            <div class="code">
              Chair_Seat<br>
              Table_Leg<br>
              Car_Door<br>
              Ring_Band
            </div>
          </div>
          
          <div style="margin-bottom: 1rem;">
            <h5>📝 Simple (Product_Part_Material):</h5>
            <div class="code">
              Sofa_Cushion_Fabric<br>
              Desk_Drawer_Wood<br>
              Phone_Case_Plastic
            </div>
          </div>
          
          <div style="margin-bottom: 1rem;">
            <h5>🏗️ Hierarchical (Category_Component_Material):</h5>
            <div class="code">
              Furniture_Chair_Seat_Leather<br>
              Electronics_Phone_Case_Silicone<br>
              Jewelry_Ring_Band_Platinum
            </div>
          </div>
          
          <div style="margin-bottom: 1rem;">
            <h5>🏢 Brand-focused (Brand_Product_Part):</h5>
            <div class="code">
              Nike_Shoe_Upper_Leather<br>
              Apple_Phone_Case_Silicone<br>
              Tesla_Car_Door_Aluminum
            </div>
          </div>
          
          <div style="background: #fef3c7; padding: 1rem; border-radius: 8px; border-left: 4px solid #f59e0b;">
            <h5>💡 Best Practices from <a href="https://developer.threekit.com/" target="_blank">Threekit Documentation</a>:</h5>
            <ul style="margin: 0.5rem 0; padding-left: 1.5rem;">
              <li>Use underscores (_) to separate words</li>
              <li>Keep names descriptive but concise</li>
              <li>Be consistent across all assets</li>
              <li>Avoid spaces and special characters</li>
              <li>Use PascalCase for the first letter of each word</li>
            </ul>
          </div>
        `;
        examplesDiv.style.display = 'block';
      } else {
        examplesDiv.style.display = 'none';
      }
    }

    // Auto-fill naming convention based on industry
    function autoFillNamingConvention() {
      const industry = document.getElementById('industry').value;
      const namingInput = document.getElementById('namingConvention');
      const namingSelect = document.getElementById('namingConventionSelect');
      
      if (industry && !namingInput.value) {
        // Set default based on industry
        let defaultConvention = 'ProductType_PartName';
        
        if (industry === 'furniture') {
          defaultConvention = 'Furniture_Component_Material';
        } else if (industry === 'automotive') {
          defaultConvention = 'Vehicle_Part_Material';
        } else if (industry === 'jewelry') {
          defaultConvention = 'Jewelry_Type_Metal';
        } else if (industry === 'fashion') {
          defaultConvention = 'Garment_Component_Fabric';
        } else if (industry === 'electronics') {
          defaultConvention = 'Device_Component_Material';
        } else if (industry === 'fitness-equipment') {
          defaultConvention = 'Equipment_Part_Material';
        }
        
        namingInput.value = defaultConvention;
        namingSelect.value = defaultConvention;
      }
    }

    // Update render engine options based on configuration type
    function updateRenderEngineOptions() {
      const configType = document.querySelector('input[name="configType"]:checked');
      const renderEngineSection = document.getElementById('renderEngineSection');
      const renderEngineSelect = document.getElementById('renderEngine');
      
      if (configType) {
        if (configType.value === 'photorealistic' || configType.value === 'mixed') {
          renderEngineSection.style.display = 'block';
          renderEngineSelect.required = true;
          // Pre-select V-Ray for photorealistic
          if (configType.value === 'photorealistic') {
            renderEngineSelect.value = 'V-Ray';
          }
        } else {
          renderEngineSection.style.display = 'none';
          renderEngineSelect.required = false;
          renderEngineSelect.value = '';
        }
      }
    }

    // Customer Database Functions
    function showCustomerDatabase() {
      const modal = document.getElementById('customerDatabaseModal');
      modal.style.display = 'block';
      loadCustomerList();
    }

    function closeCustomerDatabase() {
      const modal = document.getElementById('customerDatabaseModal');
      modal.style.display = 'none';
      selectedCustomerId = null;
    }

    function loadCustomerList() {
      const customerList = document.getElementById('customerList');
      const searchTerm = document.getElementById('customerSearch').value.toLowerCase();
      
      let filteredCustomers = customerDatabase;
      if (searchTerm) {
        filteredCustomers = customerDatabase.filter(customer => 
          customer.companyName.toLowerCase().includes(searchTerm) ||
          customer.clientWebsite.toLowerCase().includes(searchTerm) ||
          customer.industry.toLowerCase().includes(searchTerm)
        );
      }
      
      if (filteredCustomers.length === 0) {
        customerList.innerHTML = '<div style="padding: 2rem; text-align: center; color: var(--gray-500);">No customers found. Complete a questionnaire to save your first customer.</div>';
        return;
      }
      
      // Sort by date (most recent first)
      const sortedCustomers = [...filteredCustomers].sort((a, b) => 
        new Date(b.submissionDate) - new Date(a.submissionDate)
      );
      
      customerList.innerHTML = sortedCustomers.map((customer, index) => {
        const hasScreenshots = customer.screenshots && Object.keys(customer.screenshots).length > 0;
        const screenshotCount = hasScreenshots ? Object.keys(customer.screenshots).length : 0;
        const isRecent = index === 0; // First item is most recent
        
        return `
        <div class="customer-item ${isRecent ? 'recent-customer' : ''}" onclick="selectCustomer('${customer.id}')" data-customer-id="${customer.id}">
          <div class="customer-info">
            <h4>
              ${customer.companyName}
              ${isRecent ? '<span style="background: #00D4AA; color: white; font-size: 0.7rem; padding: 2px 6px; border-radius: 4px; margin-left: 0.5rem; font-weight: normal;">NEW</span>' : ''}
              ${hasScreenshots ? `<span style="color: #667EEA; margin-left: 0.5rem;" title="${screenshotCount} screenshot(s) included">📸 ${screenshotCount}</span>` : ''}
            </h4>
            <p>${customer.industry} • ${customer.clientWebsite}</p>
            <p style="margin-top: 0.25rem; font-size: 0.75rem; color: var(--gray-500);">${customer.projectDescription}</p>
          </div>
          <div class="customer-date">
            ${new Date(customer.submissionDate).toLocaleDateString()}
            <br>
            <span style="font-size: 0.65rem; color: #9ca3af;">${new Date(customer.submissionDate).toLocaleTimeString()}</span>
          </div>
        </div>
      `;
      }).join('');
    }

    function selectCustomer(customerId) {
      // Remove previous selection
      document.querySelectorAll('.customer-item').forEach(item => {
        item.classList.remove('selected');
      });
      
      // Add selection to clicked item
      const selectedItem = document.querySelector(`[data-customer-id="${customerId}"]`);
      if (selectedItem) {
        selectedItem.classList.add('selected');
        selectedCustomerId = customerId;
      }
    }

    function loadSelectedCustomer() {
      if (!selectedCustomerId) {
        alert('Please select a customer first.');
        return;
      }
      
      const customer = customerDatabase.find(c => c.id === selectedCustomerId);
      if (!customer) {
        alert('Customer not found.');
        return;
      }
      
      // Load customer data into form
      document.getElementById('companyName').value = customer.companyName || '';
      document.getElementById('industry').value = customer.industry || '';
      document.getElementById('clientWebsite').value = customer.clientWebsite || '';
      document.getElementById('existingConfig').value = customer.existingConfig || '';
      document.getElementById('projectDescription').value = customer.projectDescription || '';
      
      // Load configuration type
      if (customer.configType) {
        const configRadio = document.querySelector(`input[name="configType"][value="${customer.configType}"]`);
        if (configRadio) {
          configRadio.checked = true;
          updateRenderEngineOptions();
        }
      }
      
      // Load 3D software
      if (customer['3dSoftware']) {
        document.getElementById('3dSoftware').value = customer['3dSoftware'];
      }
      
      // Load render engine
      if (customer.renderEngine) {
        document.getElementById('renderEngine').value = customer.renderEngine;
      }
      
      // Load experience level
      if (customer.experienceLevel) {
        document.getElementById('experienceLevel').value = customer.experienceLevel;
      }
      
      // Load requirements
      if (customer.requirements) {
        customer.requirements.forEach(req => {
          const checkbox = document.querySelector(`input[value="${req}"]`);
          if (checkbox) checkbox.checked = true;
        });
      }
      
      // Load other fields...
      if (customer.targetPlatform) {
        document.getElementById('targetPlatform').value = customer.targetPlatform;
      }
      if (customer.customRequirements) {
        document.getElementById('customRequirements').value = customer.customRequirements;
      }
      if (customer.assetOrganization) {
        document.getElementById('assetOrganization').value = customer.assetOrganization;
      }
      if (customer.materialApproach) {
        document.getElementById('materialApproach').value = customer.materialApproach;
      }
      if (customer.namingConvention) {
        document.getElementById('namingConvention').value = customer.namingConvention;
      }
      if (customer.polygonCount) {
        document.getElementById('polygonCount').value = customer.polygonCount;
      }
      if (customer.exportFormat) {
        document.getElementById('exportFormat').value = customer.exportFormat;
      }
      if (customer.textureFormat) {
        document.getElementById('textureFormat').value = customer.textureFormat;
      }
      if (customer.textureResolution) {
        document.getElementById('textureResolution').value = customer.textureResolution;
      }
      if (customer.uvMapping) {
        document.getElementById('uvMapping').value = customer.uvMapping;
      }
      if (customer.lightingSetup) {
        document.getElementById('lightingSetup').value = customer.lightingSetup;
      }
      if (customer.contactName) {
        document.getElementById('contactName').value = customer.contactName;
      }
      if (customer.contactEmail) {
        document.getElementById('contactEmail').value = customer.contactEmail;
      }
      if (customer.additionalNotes) {
        document.getElementById('additionalNotes').value = customer.additionalNotes;
      }
      
      // Load training modules
      if (customer.trainingModules) {
        customer.trainingModules.forEach(module => {
          const checkbox = document.querySelector(`input[name="trainingModules"][value="${module}"]`);
          if (checkbox) checkbox.checked = true;
        });
      }
      
      // Load texture requirements
      if (customer.textureRequirements) {
        customer.textureRequirements.forEach(req => {
          const checkbox = document.querySelector(`input[value="${req}"]`);
          if (checkbox) checkbox.checked = true;
        });
      }
      
      // Load screenshots
      if (customer.screenshots && Object.keys(customer.screenshots).length > 0) {
        // Clear current screenshots
        Object.keys(screenshots).forEach(key => delete screenshots[key]);
        
        // Restore saved screenshots
        Object.assign(screenshots, customer.screenshots);
        
        // Check the include screenshots checkbox
        if (customer.includeScreenshots) {
          document.getElementById('includeScreenshots').checked = true;
          toggleScreenshotSection();
        }
        
        // Restore screenshot previews - only show slots with images
        // First, hide all slots except slot1
        for (let i = 2; i <= 12; i++) {
          const slot = document.getElementById(`slot${i}`);
          if (slot) slot.style.display = 'none';
        }
        
        // Then show only slots that have saved images
        for (let i = 1; i <= 12; i++) {
          if (screenshots[i]) {
            const img = document.getElementById(`preview${i}`);
            const pasteArea = document.getElementById(`pasteArea${i}`);
            const caption = document.getElementById(`caption${i}`);
            const removeBtn = document.getElementById(`removeBtn${i}`);
            
            // Show this slot
            const slot = document.getElementById(`slot${i}`);
            if (slot) slot.style.display = 'block';
            
            if (img && screenshots[i].data) {
              img.src = screenshots[i].data;
              img.style.display = 'block';
            }
            if (pasteArea) pasteArea.style.display = 'none';
            if (caption) {
              caption.value = screenshots[i].caption || '';
              caption.style.display = 'block';
            }
            if (removeBtn) removeBtn.style.display = 'inline-block';
          }
        }
        
        console.log('📸 Screenshots restored from customer data');
      }
      
      // Ensure we're on Step 1 and hide all other steps
      document.querySelectorAll('.questionnaire-step').forEach(step => {
        step.classList.add('hidden');
      });
      document.getElementById('step1-section').classList.remove('hidden');
      
      // Show the info message since we have loaded customer data
      document.getElementById('customerLoadedInfo').style.display = 'block';
      
      // Reset progress to Step 1
      updateProgressBar(1);
      
      closeCustomerDatabase();
      alert('Customer data loaded successfully! You can now choose to go to documentation preview or continue through the questionnaire.');
    }

    function deleteSelectedCustomer() {
      if (!selectedCustomerId) {
        alert('Please select a customer to delete.');
        return;
      }
      
      if (confirm('Are you sure you want to delete this customer? This action cannot be undone.')) {
        customerDatabase = customerDatabase.filter(c => c.id !== selectedCustomerId);
        localStorage.setItem('threekitCustomers', JSON.stringify(customerDatabase));
        selectedCustomerId = null;
        loadCustomerList();
      }
    }

    function filterCustomers() {
      loadCustomerList();
    }

    function saveCustomerToDatabase(formData) {
      const customerId = 'customer_' + Date.now();
      const customer = {
        id: customerId,
        ...formData,
        submissionDate: new Date().toISOString()
      };
      
      customerDatabase.push(customer);
      localStorage.setItem('threekitCustomers', JSON.stringify(customerDatabase));
    }

    function exportAllCustomers() {
      if (customerDatabase.length === 0) {
        alert('No customers to export.');
        return;
      }
      
      const csvHeaders = [
        'ID', 'Company Name', 'Industry', 'Website', 'Existing Config', 'Project Description',
        'Config Type', '3D Software', 'Render Engine', 'Experience Level', 'Target Platform',
        'Custom Requirements', 'Asset Organization', 'Material Approach', 'Naming Convention',
        'Polygon Count', 'Export Format', 'Texture Format', 'Texture Resolution', 'UV Mapping',
        'Lighting Setup', 'Contact Name', 'Contact Email', 'Additional Notes', 'Submission Date'
      ];
      
      const csvRows = customerDatabase.map(customer => [
        customer.id,
        customer.companyName || '',
        customer.industry || '',
        customer.clientWebsite || '',
        customer.existingConfig || '',
        customer.projectDescription || '',
        customer.configType || '',
        customer['3dSoftware'] || '',
        customer.renderEngine || '',
        customer.experienceLevel || '',
        customer.targetPlatform || '',
        customer.customRequirements || '',
        customer.assetOrganization || '',
        customer.materialApproach || '',
        customer.namingConvention || '',
        customer.polygonCount || '',
        customer.exportFormat || '',
        customer.textureFormat || '',
        customer.textureResolution || '',
        customer.uvMapping || '',
        customer.lightingSetup || '',
        customer.contactName || '',
        customer.contactEmail || '',
        customer.additionalNotes || '',
        customer.submissionDate || ''
      ]);
      
      const csvContent = [csvHeaders, ...csvRows].map(row => 
        row.map(field => `"${(field || '').toString().replace(/"/g, '""')}"`).join(',')
      ).join('\n');
      
      const blob = new Blob([csvContent], { type: 'text/csv' });
      const url = window.URL.createObjectURL(blob);
      const link = document.createElement('a');
      link.href = url;
      link.download = `threekit-customers-${new Date().toISOString().split('T')[0]}.csv`;
      link.click();
      window.URL.revokeObjectURL(url);
    }

    // Initialize when page loads
    document.addEventListener('DOMContentLoaded', function() {
      console.log('🚀 Page loaded, initializing...');
      updateProgressBar(1);
      
      // Debug: Check if all step sections exist
      for (let i = 1; i <= totalSteps; i++) {
        const section = document.getElementById(`step${i}-section`);
        console.log(`Step ${i} section:`, section ? 'EXISTS' : 'MISSING');
      }
      
      // Auto-fill naming convention when industry changes
      document.getElementById('industry').addEventListener('change', autoFillNamingConvention);
      
      // Initialize screenshot paste functionality
      setupScreenshotPaste();
      
      console.log('✅ Initialization complete');
    });

    // ==================== SCREENSHOT HANDLING FUNCTIONS ====================
    
    // Store screenshots in memory
    const screenshots = {};

    // Toggle screenshot section visibility
    function toggleScreenshotSection() {
      const checked = document.getElementById('includeScreenshots').checked;
      const section = document.getElementById('screenshotSection');
      const addMoreBtn = document.getElementById('addMoreImagesBtn');
      
      section.style.display = checked ? 'block' : 'none';
      
      // Show "Add More Images" button when section is opened
      if (checked) {
        addMoreBtn.style.display = 'block';
        
        setTimeout(() => {
          const firstPasteArea = document.getElementById('pasteArea1');
          if (firstPasteArea) {
            firstPasteArea.focus();
            console.log('📸 Screenshot section opened and first paste area focused');
          }
        }, 100);
      } else {
        addMoreBtn.style.display = 'none';
      }
    }
    
    // Show next available image slot
    function showNextImageSlot() {
      console.log('🔍 Looking for next hidden slot...');
      
      // Find the highest visible slot number
      let highestVisible = 1;
      for (let i = 1; i <= 12; i++) {
        const slot = document.getElementById(`slot${i}`);
        if (slot && window.getComputedStyle(slot).display !== 'none') {
          highestVisible = i;
        }
      }
      
      console.log(`Highest visible slot: ${highestVisible}`);
      
      // Show the next slot after the highest visible one
      if (highestVisible < 12) {
        const nextSlot = document.getElementById(`slot${highestVisible + 1}`);
        if (nextSlot) {
          nextSlot.style.display = 'block';
          
          // Focus on the newly shown paste area
          const pasteArea = document.getElementById(`pasteArea${highestVisible + 1}`);
          if (pasteArea) {
            setTimeout(() => pasteArea.focus(), 100);
          }
          
          // Hide button if we've shown all 12 slots
          if (highestVisible + 1 === 12) {
            document.getElementById('addMoreImagesBtn').style.display = 'none';
          }
          
          console.log(`✅ Showing slot ${highestVisible + 1}`);
          return;
        }
      }
      
      // All 12 slots already visible - hide the button
      document.getElementById('addMoreImagesBtn').style.display = 'none';
      console.log('⚠️ All 12 slots already visible, hiding button');
    }

    // Setup screenshot paste functionality
    function setupScreenshotPaste() {
      for (let i = 1; i <= 12; i++) {
        const pasteArea = document.getElementById(`pasteArea${i}`);
        const caption = document.getElementById(`caption${i}`);
        
        if (!pasteArea) continue;
        
        // Handle paste event
        pasteArea.addEventListener('paste', function(e) {
          e.preventDefault();
          const items = e.clipboardData.items;
          
          for (let item of items) {
            if (item.type.indexOf('image') !== -1) {
              const blob = item.getAsFile();
              handleScreenshot(i, blob);
              break;
            }
          }
        });
        
        // Handle drag & drop
        pasteArea.addEventListener('dragover', (e) => {
          e.preventDefault();
          pasteArea.style.background = '#f0f9ff';
          pasteArea.style.borderColor = '#667EEA';
        });
        
        pasteArea.addEventListener('dragleave', (e) => {
          pasteArea.style.background = '';
          pasteArea.style.borderColor = '';
        });
        
        pasteArea.addEventListener('drop', (e) => {
          e.preventDefault();
          pasteArea.style.background = '';
          pasteArea.style.borderColor = '';
          
          const file = e.dataTransfer.files[0];
          if (file && file.type.indexOf('image') !== -1) {
            handleScreenshot(i, file);
          }
        });
        
        // Update caption when typing
        if (caption) {
          caption.addEventListener('input', function(e) {
            if (screenshots[i]) {
              screenshots[i].caption = e.target.value;
            }
          });
        }
      }
      
      console.log('📸 Screenshot paste functionality initialized');
    }

    // Handle screenshot upload/paste
    function handleScreenshot(slotNum, file) {
      const reader = new FileReader();
      
      reader.onload = function(e) {
        const img = document.getElementById(`preview${slotNum}`);
        const pasteArea = document.getElementById(`pasteArea${slotNum}`);
        const caption = document.getElementById(`caption${slotNum}`);
        const removeBtn = document.getElementById(`removeBtn${slotNum}`);
        
        // Store the image data
        screenshots[slotNum] = {
          data: e.target.result,
          caption: caption ? caption.value : '',
          filename: file.name || `screenshot-${slotNum}.png`
        };
        
        // Show preview
        if (img) {
          img.src = e.target.result;
          img.style.display = 'block';
        }
        if (pasteArea) pasteArea.style.display = 'none';
        if (caption) caption.style.display = 'block';
        if (removeBtn) removeBtn.style.display = 'inline-block';
        
        console.log(`✅ Screenshot ${slotNum} uploaded successfully`);
      };
      
      reader.readAsDataURL(file);
    }

    // Remove screenshot
    function removeScreenshot(slotNum) {
      delete screenshots[slotNum];
      
      const img = document.getElementById(`preview${slotNum}`);
      const pasteArea = document.getElementById(`pasteArea${slotNum}`);
      const caption = document.getElementById(`caption${slotNum}`);
      const removeBtn = document.getElementById(`removeBtn${slotNum}`);
      
      if (img) {
        img.style.display = 'none';
        img.src = '';
      }
      if (pasteArea) pasteArea.style.display = 'block';
      if (caption) {
        caption.style.display = 'none';
        caption.value = '';
      }
      if (removeBtn) removeBtn.style.display = 'none';
      
      console.log(`🗑️ Screenshot ${slotNum} removed`);
    }
    
    // Hide an entire screenshot slot (for slots 2-12)
    function hideSlot(slotNum) {
      if (slotNum === 1) {
        console.log('⚠️ Cannot hide slot 1');
        return; // Can't hide slot 1
      }
      
      // Remove the screenshot if it exists
      if (screenshots[slotNum]) {
        delete screenshots[slotNum];
      }
      
      // Hide the entire slot
      const slot = document.getElementById(`slot${slotNum}`);
      if (slot) {
        slot.style.display = 'none';
        
        // Reset the slot content
        const img = document.getElementById(`preview${slotNum}`);
        const pasteArea = document.getElementById(`pasteArea${slotNum}`);
        const caption = document.getElementById(`caption${slotNum}`);
        const removeBtn = document.getElementById(`removeBtn${slotNum}`);
        
        if (img) {
          img.style.display = 'none';
          img.src = '';
        }
        if (pasteArea) pasteArea.style.display = 'block';
        if (caption) {
          caption.style.display = 'none';
          caption.value = '';
        }
        if (removeBtn) removeBtn.style.display = 'none';
      }
      
      // Show the Add More Images button again if it was hidden
      const addMoreBtn = document.getElementById('addMoreImagesBtn');
      if (addMoreBtn) {
        addMoreBtn.style.display = 'block';
      }
      
      console.log(`✅ Slot ${slotNum} hidden`);
    }

    // Get screenshots for inclusion in documentation
    function getScreenshotsHTML() {
      if (Object.keys(screenshots).length === 0) {
        return '';
      }
      
      let html = '<div style="margin-top: 2rem; padding: 1.5rem; background: #f8fafc; border-radius: 12px; border: 2px solid #e2e8f0;">';
      html += '<h3 style="color: #1e293b; margin-bottom: 1rem;">📸 Reference Images</h3>';
      html += '<p style="color: #64748b; margin-bottom: 1rem;">Screenshots provided by the client showing their 3D model organization:</p>';
      
      for (let i = 1; i <= 12; i++) {
        if (screenshots[i]) {
          html += `<div style="margin-bottom: 1.5rem;">`;
          html += `<img src="${screenshots[i].data}" style="max-width: 100%; border-radius: 8px; border: 2px solid #e2e8f0; box-shadow: 0 4px 6px rgba(0,0,0,0.1);" alt="Reference Screenshot ${i}">`;
          if (screenshots[i].caption) {
            html += `<p style="margin-top: 0.5rem; font-style: italic; color: #64748b;">${screenshots[i].caption}</p>`;
          }
          html += `</div>`;
        }
      }
      
      html += '</div>';
      return html;
    }
    
    // ==================== END SCREENSHOT HANDLING ====================
  </script>
</body>
</html>
